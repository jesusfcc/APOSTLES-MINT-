{"version":3,"sources":["../../../../node_modules/thirdweb/src/transaction/transaction-store.ts","../../../../node_modules/thirdweb/src/insight/get-transactions.ts","../../../../node_modules/thirdweb/src/transaction/actions/gasless/send-gasless-transaction.ts"],"sourcesContent":["import type { Chain } from \"../chains/types.js\";\nimport type { ThirdwebClient } from \"../client/client.js\";\nimport { getTransactions } from \"../insight/get-transactions.js\";\nimport { createStore, type Store } from \"../reactive/store.js\";\nimport type { Hex } from \"../utils/encoding/hex.js\";\n\nexport type StoredTransaction = {\n  transactionHash: Hex;\n  chainId: number;\n  receipt?: {\n    status: \"success\" | \"failed\";\n    to: string;\n  };\n  decoded?: {\n    name: string;\n    signature: string;\n    inputs?: {\n      [key: string]: unknown;\n    };\n  };\n};\n\nconst transactionsByAddress = new Map<string, Store<StoredTransaction[]>>();\n\n/**\n * Retrieve the transaction store for a given address.\n * @param address - The address to retrieve the transaction store for.\n * @returns A store of transactions for the given account to subscribe to.\n * @transaction\n * @example\n * ```ts\n * import { getTransactionStore } from \"thirdweb/transaction\";\n *\n * const store = getTransactionStore(\"0x...\");\n * store.subscribe((transactions) => {\n *   console.log(transactions);\n * });\n * ```\n */\nexport function getTransactionStore(\n  address: string,\n): Store<StoredTransaction[]> {\n  const existingStore = transactionsByAddress.get(address);\n  if (existingStore) {\n    return existingStore;\n  }\n\n  const newStore = createStore<StoredTransaction[]>([]);\n  transactionsByAddress.set(address, newStore);\n\n  return newStore;\n}\n\n/**\n * @internal\n */\nexport function addTransactionToStore(options: {\n  address: string;\n  transactionHash: Hex;\n  chainId: number;\n}) {\n  const { address, transactionHash, chainId } = options;\n  const tranasctionStore = getTransactionStore(address);\n\n  tranasctionStore.setValue([\n    ...tranasctionStore.getValue(),\n    { chainId, transactionHash },\n  ]);\n\n  transactionsByAddress.set(address, tranasctionStore);\n}\n\n/**\n * @internal for now\n */\nexport async function getPastTransactions(options: {\n  walletAddress: string;\n  chain: Chain;\n  client: ThirdwebClient;\n}): Promise<StoredTransaction[]> {\n  const { walletAddress, chain, client } = options;\n  const oneMonthsAgoInSeconds = Math.floor(\n    (Date.now() - 1 * 30 * 24 * 60 * 60 * 1000) / 1000,\n  );\n  const result = await getTransactions({\n    chains: [chain],\n    client,\n    queryOptions: {\n      filter_block_timestamp_gte: oneMonthsAgoInSeconds,\n      limit: 20,\n      decode: true,\n    },\n    walletAddress,\n  });\n  return result.map((tx) => ({\n    chainId:\n      typeof tx.chain_id === \"string\"\n        ? Number(tx.chain_id)\n        : (tx.chain_id as number),\n    receipt: {\n      status: tx.status === 0 ? \"failed\" : \"success\",\n      to: tx.to_address,\n    },\n    transactionHash: tx.hash as Hex,\n    decoded: tx.decoded,\n  }));\n}\n","import type {\n  GetV1WalletsByWalletAddressTransactionsData,\n  GetV1WalletsByWalletAddressTransactionsResponse,\n} from \"@thirdweb-dev/insight\";\nimport type { Chain } from \"../chains/types.js\";\nimport type { ThirdwebClient } from \"../client/client.js\";\n\nexport type Transaction = NonNullable<\n  GetV1WalletsByWalletAddressTransactionsResponse[\"data\"]\n>[number];\n\n/**\n * Get transactions for a wallet\n * @example\n * ```ts\n * import { Insight } from \"thirdweb\";\n *\n * const transactions = await Insight.getTransactions({\n *   client,\n *   walletAddress: \"0x1234567890123456789012345678901234567890\",\n *   chains: [sepolia],\n * });\n * ```\n * @insight\n */\nexport async function getTransactions(args: {\n  client: ThirdwebClient;\n  walletAddress: string;\n  chains: Chain[];\n  queryOptions?: GetV1WalletsByWalletAddressTransactionsData[\"query\"];\n}): Promise<Transaction[]> {\n  const [\n    { getV1WalletsByWalletAddressTransactions },\n    { getThirdwebDomains },\n    { getClientFetch },\n    { assertInsightEnabled },\n    { stringify },\n  ] = await Promise.all([\n    import(\"@thirdweb-dev/insight\"),\n    import(\"../utils/domains.js\"),\n    import(\"../utils/fetch.js\"),\n    import(\"./common.js\"),\n    import(\"../utils/json.js\"),\n  ]);\n\n  await assertInsightEnabled(args.chains);\n  const threeMonthsAgoInSeconds = Math.floor(\n    (Date.now() - 3 * 30 * 24 * 60 * 60 * 1000) / 1000,\n  );\n  const { client, walletAddress, chains, queryOptions } = args;\n\n  const defaultQueryOptions: GetV1WalletsByWalletAddressTransactionsData[\"query\"] =\n    {\n      chain: chains.map((chain) => chain.id),\n      filter_block_timestamp_gte: threeMonthsAgoInSeconds,\n      limit: 100,\n    };\n\n  const result = await getV1WalletsByWalletAddressTransactions({\n    baseUrl: `https://${getThirdwebDomains().insight}`,\n    fetch: getClientFetch(client),\n    path: {\n      wallet_address: walletAddress,\n    },\n    query: {\n      ...defaultQueryOptions,\n      ...queryOptions,\n    },\n  });\n  if (result.error) {\n    throw new Error(\n      `${result.response.status} ${result.response.statusText} - ${result.error ? stringify(result.error) : \"Unknown error\"}`,\n    );\n  }\n  return result.data.data || [];\n}\n","import type { Account } from \"../../../wallets/interfaces/wallet.js\";\nimport type { PreparedTransaction } from \"../../prepare-transaction.js\";\nimport type { SerializableTransaction } from \"../../serialize-transaction.js\";\nimport { addTransactionToStore } from \"../../transaction-store.js\";\nimport type { WaitForReceiptOptions } from \"../wait-for-tx-receipt.js\";\nimport type { GaslessOptions } from \"./types.js\";\n\ntype SendGaslessTransactionOptions = {\n  account: Account;\n  // TODO: update this to `Transaction<\"prepared\">` once the type is available to ensure only prepared transactions are accepted\n  // biome-ignore lint/suspicious/noExplicitAny: library function that accepts any prepared transaction type\n  transaction: PreparedTransaction<any>;\n  serializableTransaction: SerializableTransaction;\n  gasless: GaslessOptions;\n};\n\nexport async function sendGaslessTransaction({\n  account,\n  transaction,\n  serializableTransaction,\n  gasless,\n}: SendGaslessTransactionOptions): Promise<WaitForReceiptOptions> {\n  // TODO: handle special case for mutlicall transactions!\n  // Steps:\n  // 1. check if the method is `multicall` by comparing the 4bytes data with the `multicall` selector\n  // 2. split the rest of the data into its \"parts\"\n  // 3. solidityPack the parts with the part data + the `account.address`\n  // see v4: `core/classes/transactions.ts>Transaction>prepareGasless:L551`\n\n  if (serializableTransaction.value && serializableTransaction.value > 0n) {\n    throw new Error(\"Gasless transactions cannot have a value\");\n  }\n\n  // TODO: multiply gas by 2 for some reason(?) - we do in v4, *should* we?\n\n  let result: WaitForReceiptOptions | undefined;\n\n  // biconomy\n  if (gasless.provider === \"biconomy\") {\n    const { relayBiconomyTransaction } = await import(\n      \"./providers/biconomy.js\"\n    );\n    result = await relayBiconomyTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  // openzeppelin\n  if (gasless.provider === \"openzeppelin\") {\n    const { relayOpenZeppelinTransaction } = await import(\n      \"./providers/openzeppelin.js\"\n    );\n    result = await relayOpenZeppelinTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  if (gasless.provider === \"engine\") {\n    const { relayEngineTransaction } = await import(\"./providers/engine.js\");\n    result = await relayEngineTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  if (!result) {\n    throw new Error(\"Unsupported gasless provider\");\n  }\n  addTransactionToStore({\n    address: account.address,\n    chainId: transaction.chain.id,\n    transactionHash: result.transactionHash,\n  });\n  return result;\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}