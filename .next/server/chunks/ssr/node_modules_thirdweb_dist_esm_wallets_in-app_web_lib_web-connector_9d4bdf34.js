module.exports=[460594,a=>{"use strict";var b=a.i(371323);let c=new Map,d={getItem:async a=>c.get(a)??null,removeItem:async a=>{c.delete(a)},setItem:async(a,b)=>{c.set(a,b)}};var e=a.i(317218);async function f({authToken:a,client:c,ecosystem:d}){let f=(0,e.getClientFetch)(c,d),g=await f(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/accounts`,{headers:{Authorization:`Bearer embedded-wallet-token:${a}`,"Content-Type":"application/json"},method:"GET"});if(!g.ok){let a=await g.text().catch(()=>"Unknown error");throw Error(`Failed to get user info: ${a}`)}return await g.json()}var g=a.i(380167);let h=(0,b.getThirdwebBaseUrl)("inAppWallet"),i=`${h}/`,j=`${i}api/2023-10-20`,k=`${j}/embedded-wallet/validate-custom-jwt`,l=`${j}/embedded-wallet/validate-custom-auth-endpoint`,m=(a,b)=>b instanceof Error?`${a}: ${b.message}`:`${a}: ${(0,g.stringify)(b)}`;async function n(a){let b=(0,e.getClientFetch)(a.client,a.ecosystem),c=await b(l,{body:(0,g.stringify)({developerClientId:a.client.clientId,payload:a.payload}),headers:{"Content-Type":"application/json"},method:"POST"});if(!c.ok){let a=await c.json();throw Error(`Custom auth endpoint authentication error: ${a.message}`)}try{let{verifiedToken:a}=await c.json();return{storedToken:a}}catch(a){throw Error(m("Malformed response from post auth_endpoint authentication",a))}}var o=a.i(333207);async function p(a){let b=(0,e.getClientFetch)(a.client,a.ecosystem),c=(0,o.getLoginUrl)({authOption:"backend",client:a.client,ecosystem:a.ecosystem}),d=await b(`${c}`,{body:(0,g.stringify)({walletSecret:a.walletSecret}),headers:{"Content-Type":"application/json"},method:"POST"});if(!d.ok){let a=await d.text();throw Error(`Failed to generate backend account: ${a}`)}return await d.json()}var q=a.i(573350),r=a.i(258826);async function s(a){let b=await a.storage.getGuestSessionId();b||(b=(0,r.randomBytesHex)(32),a.storage.saveGuestSessionId(b));let c=(0,e.getClientFetch)(a.client,a.ecosystem),d=(0,o.getLoginCallbackUrl)({authOption:"guest",client:a.client,ecosystem:a.ecosystem}),f=await c(`${d}`,{body:(0,g.stringify)({sessionId:b}),headers:{"Content-Type":"application/json"},method:"POST"});if(!f.ok){let a=await f.text();throw Error(`Failed to generate guest account: ${f.status} ${f.statusText} ${a}`)}return await f.json()}async function t(a){let b=(0,e.getClientFetch)(a.client,a.ecosystem),c=await b(k,{body:(0,g.stringify)({developerClientId:a.client.clientId,jwt:a.jwt}),headers:{"Content-Type":"application/json"},method:"POST"});if(!c.ok){let a=await c.json();throw Error(`JWT authentication error: ${a.message}`)}try{let{verifiedToken:a}=await c.json();return{storedToken:a}}catch(a){throw Error(m("Malformed response from post jwt authentication",a))}}async function u({client:a,ecosystem:c,tokenToLink:d,storage:f}){let h=(0,e.getClientFetch)(a,c),i=(0,b.getThirdwebBaseUrl)("inAppWallet"),j=await f.getAuthCookie();if(!j)throw Error("Failed to link account, no user logged in");let k={Authorization:`Bearer iaw-auth-token:${j}`,"Content-Type":"application/json"},l=await h(`${i}/api/2024-05-05/account/connect`,{body:(0,g.stringify)({accountAuthTokenToConnect:d}),headers:k,method:"POST"});if(!l.ok)throw Error((await l.json()).message||"Failed to link account.");let{linkedAccounts:m}=await l.json();return m??[]}async function v({client:a,ecosystem:c,profileToUnlink:d,allowAccountDeletion:f=!1,storage:h}){let i=(0,e.getClientFetch)(a,c),j=(0,b.getThirdwebBaseUrl)("inAppWallet"),k=await h.getAuthCookie();if(!k)throw Error("Failed to unlink account, no user logged in");let l={Authorization:`Bearer iaw-auth-token:${k}`,"Content-Type":"application/json"},m=await i(`${j}/api/2024-05-05/account/disconnect`,{body:(0,g.stringify)({allowAccountDeletion:f,details:d.details,type:d.type}),headers:l,method:"POST"});if(!m.ok)throw Error((await m.json()).message||"Failed to unlink account.");let{linkedAccounts:n}=await m.json();return n??[]}async function w({client:a,ecosystem:c,storage:d}){let f=(0,e.getClientFetch)(a,c),g=(0,b.getThirdwebBaseUrl)("inAppWallet"),h=await d.getAuthCookie();if(!h)throw Error("Failed to get linked accounts, no user logged in");let i={Authorization:`Bearer iaw-auth-token:${h}`,"Content-Type":"application/json"},j=await f(`${g}/api/2024-05-05/accounts`,{headers:i,method:"GET"});if(!j.ok)throw Error((await j.json()).message||"Failed to get linked accounts.");let{linkedAccounts:k}=await j.json();return k??[]}function x(){return`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function y(a,c){return`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey?type=${a}${c?`&username=${c}`:""}`}async function z(a){var b;if(!a.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let c=(0,e.getClientFetch)(a.client,a.ecosystem),d=a.username??(b=a.ecosystem,`${b?.id??"wallet"}-${new Date().toISOString()}`),f=await c(y("sign-up",d)),h=await f.json();if(!h.challenge)throw Error("No challenge received");let i=h.challenge,j=await a.passkeyClient.register({challenge:i,name:d,rp:a.rp}),k={};a.ecosystem?.partnerId&&(k["x-ecosystem-partner-id"]=a.ecosystem.partnerId),a.ecosystem?.id&&(k["x-ecosystem-id"]=a.ecosystem.id);let l=await c(x(),{body:(0,g.stringify)({authenticatorData:j.authenticatorData,clientData:j.clientData,credential:{algorithm:j.credential.algorithm,publicKey:j.credential.publicKey},credentialId:j.credentialId,origin:j.origin,rpId:a.rp.id,serverVerificationId:h.serverVerificationId,type:"sign-up",username:d}),headers:{"Content-Type":"application/json",...k},method:"POST"}),m=await l.json();if(!m||!m.storedToken)throw Error(`Error verifying passkey: ${m.message??"unknown error"}`);return await a.storage?.savePasskeyCredentialId(j.credentialId),m}async function A(a){if(!a.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let b=(0,e.getClientFetch)(a.client,a.ecosystem),[c,d]=await Promise.all([b(y("sign-in")).then(a=>a.json()),a.storage?.getPasskeyCredentialId()]);if(!c.challenge)throw Error("No challenge received");let f=c.challenge,h=await a.passkeyClient.authenticate({challenge:f,credentialId:d??void 0,rp:a.rp}),i={};a.ecosystem?.partnerId&&(i["x-ecosystem-partner-id"]=a.ecosystem.partnerId),a.ecosystem?.id&&(i["x-ecosystem-id"]=a.ecosystem.id);let j=await b(x(),{body:(0,g.stringify)({authenticatorData:h.authenticatorData,clientData:h.clientData,credentialId:h.credentialId,origin:h.origin,rpId:a.rp.id,serverVerificationId:c.serverVerificationId,signature:h.signature,type:"sign-in"}),headers:{"Content-Type":"application/json",...i},method:"POST"}),k=await j.json();if(!k||!k.storedToken)throw Error(`Error verifying passkey: ${k.message??"unknown error"}`);return await a.storage?.savePasskeyCredentialId(h.credentialId),k}var B=a.i(734356),C=a.i(638181);let D=["xyz.abs"];async function E(a){let{wallet:b,client:c,ecosystem:d,chain:f}=a,h=D.includes(b.id)&&f||(0,C.getCachedChain)(1),i=b.getAccount()||await b.connect({chain:h,client:c}),j=(0,e.getClientFetch)(c,d),k=await (async()=>{let b=(0,o.getLoginUrl)({authOption:"wallet",client:a.client,ecosystem:a.ecosystem}),c=await j(`${b}&address=${i.address}&chainId=${h.id}`);if(!c.ok)throw Error("Failed to generate SIWE login payload");return await c.json()})(),{signature:l}=await (0,B.signLoginPayload)({account:i,payload:k});return await (async()=>{let b=(0,o.getLoginCallbackUrl)({authOption:"wallet",client:a.client,ecosystem:a.ecosystem}),c=await j(`${b}&signature=${l}&payload=${encodeURIComponent(k)}`,{body:(0,g.stringify)({payload:k,signature:l}),headers:{"Content-Type":"application/json"},method:"POST"});if(!c.ok)throw Error("Failed to verify SIWE signature");return await c.json()})()}var F=a.i(221570),G=a.i(71932),H=a.i(60268),I=a.i(615526),J=a.i(770529),K=a.i(726654),L=a.i(707014),M=a.i(841997);async function N({client:a,payload:c,storage:d}){let f=await d.getAuthCookie(),h=d.ecosystem,i=(0,e.getClientFetch)(a,h);if(!f)throw Error("No auth token found when signing message");let j={address:c.address,chainId:c.chainId,nonce:Number(c.nonce)},k=await i(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-authorization`,{body:(0,g.stringify)(j),headers:{Authorization:`Bearer embedded-wallet-token:${f}`,"Content-Type":"application/json","x-thirdweb-client-id":a.clientId},method:"POST"});if(!k.ok)throw Error(`Failed to sign message - ${k.status} ${k.statusText}`);return await k.json()}async function O({client:a,payload:{message:c,isRaw:d,originalMessage:f,chainId:h},storage:i}){let j=await i.getAuthCookie(),k=i.ecosystem,l=(0,e.getClientFetch)(a,k);if(!j)throw Error("No auth token found when signing message");let m=await l(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-message`,{body:(0,g.stringify)({messagePayload:{chainId:h,isRaw:d,message:c,originalMessage:f}}),headers:{Authorization:`Bearer embedded-wallet-token:${j}`,"Content-Type":"application/json","x-thirdweb-client-id":a.clientId},method:"POST"});if(!m.ok)throw Error(`Failed to sign message - ${m.status} ${m.statusText}`);return await m.json()}async function P({client:a,payload:c,storage:d}){let f=await d.getAuthCookie(),h=d.ecosystem,i=(0,e.getClientFetch)(a,h);if(!f)throw Error("No auth token found when signing transaction");let j=await i(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-transaction`,{body:(0,g.stringify)({transactionPayload:c}),headers:{Authorization:`Bearer embedded-wallet-token:${f}`,"Content-Type":"application/json","x-thirdweb-client-id":a.clientId},method:"POST"});if(!j.ok)throw Error(`Failed to sign transaction - ${j.status} ${j.statusText}`);return(await j.json()).signature}async function Q({client:a,payload:c,storage:d}){let f=await d.getAuthCookie(),h=d.ecosystem,i=(0,e.getClientFetch)(a,h);if(!f)throw Error("No auth token found when signing typed data");let j=await i(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-typed-data`,{body:(0,g.stringify)({...c}),headers:{Authorization:`Bearer embedded-wallet-token:${f}`,"Content-Type":"application/json","x-thirdweb-client-id":a.clientId},method:"POST"});if(!j.ok)throw Error(`Failed to sign typed data - ${j.status} ${j.statusText}`);return await j.json()}class R{constructor({client:a,ecosystem:b,address:c,storage:d}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=a,this.ecosystem=b,this.address=c,this.localStorage=d}async postWalletSetUp(a){await this.localStorage.saveAuthCookie(a.storedToken.cookieString)}async getUserWalletStatus(){let a=await this.localStorage.getAuthCookie();if(!a)return{status:"Logged Out"};let b=await f({authToken:a,client:this.client,ecosystem:this.ecosystem});if(!b)return{status:"Logged Out"};let c=b.wallets[0],d={email:b.linkedAccounts.find(a=>void 0!==a.details.email)?.details.email,phoneNumber:b.linkedAccounts.find(a=>void 0!==a.details.phone)?.details.phone,recoveryShareManagement:"ENCLAVE",userWalletId:b.id||""};return c?{account:await this.getAccount(),authDetails:d,status:"Logged In, Wallet Initialized",walletAddress:c.address}:{authDetails:d,status:"Logged In, Wallet Uninitialized"}}async getAccount(){let b=this.client,c=this.localStorage,d=this.address,e=this.ecosystem,f=async d=>{let e=(0,I.getRpcClient)({chain:(0,C.getCachedChain)(d.chainId),client:b}),f={chainId:(0,L.toHex)(d.chainId),data:d.data,gas:S(d.gas),nonce:S(d.nonce)||(0,L.toHex)(await a.A(464260).then(({eth_getTransactionCount:a})=>a(e,{address:(0,J.getAddress)(this.address),blockTag:"pending"}))),to:d.to?(0,J.getAddress)(d.to):void 0,value:S(d.value)};return d.authorizationList&&d.authorizationList.length>0?(f.type=4,f.authorizationList=d.authorizationList,f.maxFeePerGas=S(d.maxFeePerGas),f.maxPriorityFeePerGas=S(d.maxPriorityFeePerGas)):S(d.maxFeePerGas)?(f.maxFeePerGas=S(d.maxFeePerGas),f.maxPriorityFeePerGas=S(d.maxPriorityFeePerGas),f.type=2):(f.gasPrice=S(d.gasPrice),f.type=0),P({client:b,payload:f,storage:c})},g={address:(0,J.getAddress)(d),async sendTransaction(a){let c=(0,I.getRpcClient)({chain:(0,C.getCachedChain)(a.chainId),client:b}),g=await f(a),h=await (0,H.eth_sendRawTransaction)(c,g);return(0,G.trackTransaction)({chainId:a.chainId,client:b,contractAddress:a.to??void 0,ecosystem:e,gasPrice:a.gasPrice,transactionHash:h,walletAddress:d,walletType:"inApp"}),{transactionHash:h}},async signAuthorization(a){let d=await N({client:b,payload:a,storage:c});return{address:(0,J.getAddress)(d.address),chainId:Number.parseInt(d.chainId),nonce:BigInt(d.nonce),r:BigInt(d.r),s:BigInt(d.s),yParity:Number.parseInt(d.yParity)}},async signMessage({message:a,originalMessage:d,chainId:e}){let f="string"==typeof a?{chainId:e,isRaw:!1,message:a,originalMessage:d}:{chainId:e,isRaw:!0,message:"string"==typeof a.raw?a.raw:(0,F.bytesToHex)(a.raw),originalMessage:d},{signature:g}=await O({client:b,payload:f,storage:c});return g},async signTransaction(a){if(!a.chainId)throw Error("chainId required in tx to sign");return f({chainId:a.chainId,...a})},async signTypedData(a){let d=(0,M.parseTypedData)(a),{signature:e}=await Q({client:b,payload:d,storage:c});return e},sendCalls:async b=>{let{inAppWalletSendCalls:c}=await a.A(824623),d=b.calls[0];if(!d)throw Error("No calls to send");let e=d.client,f=d.chain||b.chain,h=await c({account:g,calls:b.calls,chain:f});return{chain:f,client:e,id:h}},getCallsStatus:async b=>{let{inAppWalletGetCallsStatus:c}=await a.A(824623);return c(b)},getCapabilities:async a=>({[a.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:!1}}})};return g}}function S(a){return void 0===a||(0,K.isHex)(a)?a:(0,L.toHex)(a)}var T=a.i(85671),U=a.i(878581),V=a.i(695690);let W={backgroundColor:"transparent",border:"none",colorScheme:"light",display:"none",height:"100%",pointerEvents:"all",position:"fixed",right:"0px",top:"0px",width:"100%",zIndex:"2147483646"},X=new Map;class Y{constructor({link:a,baseUrl:b,iframeId:c,container:d,onIframeInitialize:e,localStorage:f,clientId:g,ecosystem:h}){if(Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=f,this.clientId=g,this.ecosystem=h,this.iframeBaseUrl=b,"undefined"==typeof document)return;d=d??document.body;let i=document.getElementById(c);const j=new URL(a);if(!i||i.src!==j.href){i=document.createElement("iframe");const a={...W};Object.assign(i.style,a),i.setAttribute("id",c),i.setAttribute("fetchpriority","high"),d.appendChild(i),i.src=j.href;const b=a=>{if("ewsIframeLoaded"===a.data.eventType){if(window.removeEventListener("message",b),!i)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(i,e)()}};window.addEventListener("message",b)}this.iframe=i}async onIframeLoadedInitVariables(){return{authCookie:await this.localStorage.getAuthCookie(),clientId:this.clientId,deviceShareStored:await this.localStorage.getDeviceShare(),ecosystemId:this.ecosystem?.id,partnerId:this.ecosystem?.partnerId,walletUserId:await this.localStorage.getWalletUserId()}}onIframeLoadHandler(a,b){return async()=>{let c=new MessageChannel,d=new Promise((d,e)=>{c.port1.onmessage=f=>{let{data:g}=f;c.port1.close(),g.success||e(Error(g.error)),X.set(a.src,!0),b&&b(),d(!0)}});a?.contentWindow?.postMessage({data:await this.onIframeLoadedInitVariables(),eventType:"initIframe"},this.iframeBaseUrl,[c.port2]),await d}}async call({procedureName:a,params:b,showIframe:c=!1}){if(!this.iframe)throw Error("Iframe not found. You are likely calling this from the backend where the DOM is not available.");for(;!X.get(this.iframe.src);)await (0,V.sleep)(1e3*this.POLLING_INTERVAL_SECONDS);c&&(this.iframe.style.display="block",await (0,V.sleep)(5));let d=new MessageChannel,e=new Promise((a,b)=>{d.port1.onmessage=async e=>{let{data:f}=e;d.port1.close(),c&&(await (0,V.sleep)(100),this.iframe&&(this.iframe.style.display="none")),f.success?a(f.data):b(Error(f.error))}});return this.iframe.contentWindow?.postMessage({data:{...b,...await this.onIframeLoadedInitVariables()},eventType:a},this.iframeBaseUrl,[d.port2]),e}destroy(){this.iframe&&X.delete(this.iframe.src)}}class Z extends Y{constructor({clientId:a,baseUrl:b,ecosystem:c}){super({baseUrl:b,clientId:a,container:"undefined"==typeof document?void 0:document.body,ecosystem:c,iframeId:$+(c?.id||""),link:function({clientId:a,baseUrl:b,path:c,ecosystem:d,queryParams:e}){let f=new URL(`${c}`,b);if(e)for(let a of Object.keys(e))f.searchParams.set(a,e[a]?.toString()||"");return f.searchParams.set("clientId",a),d?.partnerId!==void 0&&f.searchParams.set("partnerId",d.partnerId),d?.id!==void 0&&f.searchParams.set("ecosystemId",d.id),f}({baseUrl:b,clientId:a,ecosystem:c,path:U.IN_APP_WALLET_PATH}).href,localStorage:new q.ClientScopedStorage({clientId:a,ecosystem:c,storage:T.webLocalStorage})}),this.clientId=a,this.ecosystem=c}}let $="thirdweb-in-app-wallet-iframe";async function _({client:a,ecosystem:c,authToken:d}){let f=(0,e.getClientFetch)(a,c),g=await f(`${(0,b.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/generate`,{headers:{Authorization:`Bearer embedded-wallet-token:${d}`,"Content-Type":"application/json","x-thirdweb-client-id":a.clientId},method:"POST"});if(!g.ok)throw Error(`Failed to generate wallet - ${g.status} ${g.statusText}`);let{wallet:h}=await g.json();return h}class aa{constructor({baseUrl:a,querier:b,preLogin:c,postLogin:d,client:e,ecosystem:f}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=a,this.LoginQuerier=b,this.preLogin=c,this.postLogin=d,this.client=e,this.ecosystem=f}async sendEmailLoginOtp({email:a}){return await this.LoginQuerier.call({params:{email:a},procedureName:"sendThirdwebEmailLoginOtp"})}async sendSmsLoginOtp({phoneNumber:a}){return await this.LoginQuerier.call({params:{phoneNumber:a},procedureName:"sendThirdwebSmsLoginOtp"})}}class ab extends aa{async authenticateWithModal(){return this.LoginQuerier.call({params:void 0,procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithModal(){await this.preLogin();let a=await this.authenticateWithModal();return this.postLogin(a)}async authenticateWithIframe({email:a}){return this.LoginQuerier.call({params:{email:a},procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithIframe({email:a}){await this.preLogin();let b=await this.authenticateWithIframe({email:a});return this.postLogin(b)}async authenticateWithCustomJwt({encryptionKey:a,jwt:b}){if(!a||0===a.length)throw Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({params:{encryptionKey:a,jwt:b},procedureName:"loginWithCustomJwt"})}async loginWithCustomJwt({encryptionKey:a,jwt:b}){if(!a||0===a.length)throw Error("Encryption key is required for custom jwt auth");await this.preLogin();let c=await this.authenticateWithCustomJwt({encryptionKey:a,jwt:b});return this.postLogin(c)}async authenticateWithCustomAuthEndpoint({encryptionKey:a,payload:b}){return this.LoginQuerier.call({params:{encryptionKey:a,payload:b},procedureName:"loginWithCustomAuthEndpoint"})}async loginWithCustomAuthEndpoint({encryptionKey:a,payload:b}){if(!a||0===a.length)throw Error("Encryption key is required for custom auth");await this.preLogin();let c=await this.authenticateWithCustomAuthEndpoint({encryptionKey:a,payload:b});return this.postLogin(c)}async authenticateWithEmailOtp({email:a,otp:b,recoveryCode:c}){return this.LoginQuerier.call({params:{email:a,otp:b,recoveryCode:c},procedureName:"verifyThirdwebEmailLoginOtp"})}async loginWithEmailOtp({email:a,otp:b,recoveryCode:c}){let d=await this.authenticateWithEmailOtp({email:a,otp:b,recoveryCode:c});return this.postLogin(d)}async authenticateWithSmsOtp({phoneNumber:a,otp:b,recoveryCode:c}){return this.LoginQuerier.call({params:{otp:b,phoneNumber:a,recoveryCode:c},procedureName:"verifyThirdwebSmsLoginOtp"})}async loginWithSmsOtp({phoneNumber:a,otp:b,recoveryCode:c}){let d=await this.authenticateWithSmsOtp({otp:b,phoneNumber:a,recoveryCode:c});return this.postLogin(d)}}class ac{constructor({client:a,querier:b,onAuthSuccess:c,ecosystem:d,baseUrl:e,localStorage:f}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=a,this.ecosystem=d,this.AuthQuerier=b,this.localStorage=f,this.onAuthSuccess=c,this.BaseLogin=new ab({baseUrl:e,client:a,ecosystem:d,postLogin:async a=>this.postLogin(a),preLogin:async()=>{await this.preLogin()},querier:b})}async preLogin(){await this.logout()}async postLogin({storedToken:a,walletDetails:b}){return a.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(a.cookieString),await this.onAuthSuccess({storedToken:a,walletDetails:b})}async loginWithAuthToken(a,b){"Backend"!==a.storedToken.authProvider&&await this.preLogin();let c=await f({authToken:a.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!c)throw Error("Cannot login, no user found for auth token");if(c.wallets.length>0&&c.wallets[0]?.type==="enclave")return this.postLogin({storedToken:a.storedToken,walletDetails:{walletAddress:c.wallets[0].address}});if(0===c.wallets.length){let b=await _({authToken:a.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:a.storedToken,walletDetails:{walletAddress:b.address}})}let d=await this.AuthQuerier.call({params:{recoveryCode:b,storedToken:a.storedToken},procedureName:"loginWithStoredTokenDetails"});return this.postLogin(d)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(a){return this.BaseLogin.loginWithIframe(a)}async authenticateWithIframe(a){return this.BaseLogin.authenticateWithIframe(a)}async loginWithCustomJwt(a){return this.BaseLogin.loginWithCustomJwt(a)}async authenticateWithCustomJwt(a){return this.BaseLogin.authenticateWithCustomJwt(a)}async loginWithCustomAuthEndpoint(a){return this.BaseLogin.loginWithCustomAuthEndpoint(a)}async authenticateWithCustomAuthEndpoint(a){return this.BaseLogin.authenticateWithCustomAuthEndpoint(a)}async sendEmailLoginOtp({email:a}){return this.BaseLogin.sendEmailLoginOtp({email:a})}async sendSmsLoginOtp({phoneNumber:a}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:a})}async loginWithEmailOtp(a){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(a)}async authenticateWithEmailOtp(a){return this.BaseLogin.authenticateWithEmailOtp(a)}async loginWithSmsOtp(a){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(a)}async authenticateWithSmsOtp(a){return this.BaseLogin.authenticateWithSmsOtp(a)}async logout(){let a=await this.localStorage.removeAuthCookie(),b=await this.localStorage.removeWalletUserId();return{success:a||b}}}var ad=a.i(813760);let ae=async a=>{let{client:b,ecosystem:c}=a,d=(0,o.getLoginUrl)({authOption:a.strategy,client:b,ecosystem:c}),e={"Content-Type":"application/json","x-client-id":b.clientId};c?.id&&(e["x-ecosystem-id"]=c.id),c?.partnerId&&(e["x-ecosystem-partner-id"]=c.partnerId);let f=(()=>{switch(a.strategy){case"email":return{email:a.email};case"phone":return{phone:a.phoneNumber}}})(),h=await fetch(d,{body:(0,g.stringify)(f),headers:e,method:"POST"});if(!h.ok)throw Error("Failed to send verification code");return await h.json()},af=async a=>{let{client:b,ecosystem:c}=a,d=(0,o.getLoginCallbackUrl)({authOption:a.strategy,client:a.client,ecosystem:a.ecosystem}),e={"Content-Type":"application/json","x-client-id":b.clientId};c?.id&&(e["x-ecosystem-id"]=c.id),c?.partnerId&&(e["x-ecosystem-partner-id"]=c.partnerId);let f=(()=>{switch(a.strategy){case"email":return{code:a.verificationCode,email:a.email};case"phone":return{code:a.verificationCode,phone:a.phoneNumber}}})(),h=await fetch(d,{body:(0,g.stringify)(f),headers:e,method:"POST"});if(!h.ok)throw Error("Failed to verify verification code");return await h.json()};class ag{constructor({client:a,ecosystem:b,querier:c,localStorage:d}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=a,this.ecosystem=b,this.walletManagerQuerier=c,this.localStorage=d}async postWalletSetUp(a){a.deviceShareStored&&await this.localStorage.saveDeviceShare(a.deviceShareStored,a.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){let a=await this.walletManagerQuerier.call({params:void 0,procedureName:"getUserStatus"});return"Logged In, Wallet Initialized"===a.status?{status:"Logged In, Wallet Initialized",...a.user,account:await this.getAccount()}:"Logged In, New Device"===a.status?{status:"Logged In, New Device",...a.user}:"Logged In, Wallet Uninitialized"===a.status?{status:"Logged In, Wallet Uninitialized",...a.user}:{status:a.status}}async getAccount(){let a=this.walletManagerQuerier,c=this.client,d=this.ecosystem?.partnerId,{address:e}=await a.call({params:void 0,procedureName:"getAddress"}),f=async c=>{let e={chainId:c.chainId,data:c.data,gasLimit:c.gas,nonce:c.nonce,to:c.to??void 0,value:c.value};c.maxFeePerGas?(e.accessList=c.accessList,e.maxFeePerGas=c.maxFeePerGas,e.maxPriorityFeePerGas=c.maxPriorityFeePerGas,e.type=2):(e.gasPrice=c.gasPrice,e.type=0);let f=(0,b.getThirdwebDomains)().rpc,{signedTransaction:g}=await a.call({params:{chainId:c.chainId,partnerId:d,rpcEndpoint:`https://${c.chainId}.${f}`,transaction:e},procedureName:"signTransaction"});return g};return{address:(0,J.getAddress)(e),async sendTransaction(a){let b=(0,I.getRpcClient)({chain:(0,C.getCachedChain)(a.chainId),client:c}),d=await f(a),g=await (0,H.eth_sendRawTransaction)(b,d);return(0,G.trackTransaction)({chainId:a.chainId,client:c,contractAddress:a.to??void 0,gasPrice:a.gasPrice,transactionHash:g,walletAddress:e,walletType:"inApp"}),{transactionHash:g}},async signMessage({message:b}){let c="string"==typeof b?b:b.raw instanceof Uint8Array?b.raw:(0,L.hexToString)(b.raw),{signedMessage:e}=await a.call({params:{chainId:1,message:c,partnerId:d},procedureName:"signMessage"});return e},async signTransaction(a){if(!a.chainId)throw Error("chainId required in tx to sign");return f({...a,chainId:a.chainId})},async signTypedData(c){let e=(0,M.parseTypedData)(c);e.types?.EIP712Domain&&(e.types.EIP712Domain=void 0);let f=e.domain,g=f?.chainId,h={...f?.verifyingContract?{verifyingContract:f?.verifyingContract}:{},name:f?.name,version:f?.version};g&&(h.chainId=g);let i=(0,b.getThirdwebDomains)().rpc,{signedTypedData:j}=await a.call({params:{chainId:Number.parseInt(BigInt(g||1).toString()),domain:h,message:e.message,partnerId:d,rpcEndpoint:`https://${g}.${i}`,types:e.types},procedureName:"signTypedDataV4"});return j}}}}class ah{isClientIdLegacyPaper(a){return!!(a.indexOf("-")>0)&&36===a.length}constructor({client:a,onAuthSuccess:c,ecosystem:e,passkeyDomain:f,storage:g}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(a.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const h=(0,b.getThirdwebBaseUrl)("inAppWallet");this.client=a,this.ecosystem=e,this.passkeyDomain=f,this.storage=new q.ClientScopedStorage({clientId:a.clientId,ecosystem:e,storage:g??d}),this.querier=new Z({baseUrl:h,clientId:a.clientId,ecosystem:e}),this.auth=new ac({baseUrl:h,client:a,ecosystem:e,localStorage:this.storage,onAuthSuccess:async a=>{if(c?.(a),"sharded"===a.storedToken.authDetails.walletType&&(await this.querier.call({params:{storedToken:a.storedToken},procedureName:"migrateFromShardToEnclave"})||console.warn("Failed to migrate from sharded to enclave wallet, continuing with sharded wallet")),this.wallet=await this.initializeWallet(a.storedToken.cookieString),!this.wallet)throw Error("Failed to initialize wallet");let b="deviceShareStored"in a.walletDetails?a.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({deviceShareStored:b,storedToken:a.storedToken}),this.wallet instanceof ag&&await this.querier.call({params:{authCookie:a.storedToken.cookieString,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in a.walletDetails?a.walletDetails.deviceShareStored:null,ecosystemId:e?.id,partnerId:e?.partnerId,walletUserId:a.storedToken.authDetails.userWalletId},procedureName:"initIframe"}),{user:{account:await this.wallet.getAccount(),authDetails:a.storedToken.authDetails,status:"Logged In, Wallet Initialized",walletAddress:a.walletDetails.walletAddress}}},querier:this.querier})}async initializeWallet(a){let b=await this.storage.getAuthCookie();if(!a&&null===b)throw Error("No auth token provided and no stored auth token found to initialize the wallet");let c=await f({authToken:a||b,client:this.client,ecosystem:this.ecosystem});if(!c)throw Error("Cannot initialize wallet, no user logged in");if(0===c.wallets.length)throw Error("Cannot initialize wallet, this user does not have a wallet generated yet");return c.wallets[0]?.type==="enclave"?new R({address:c.wallets[0].address,client:this.client,ecosystem:this.ecosystem,storage:this.storage}):new ag({client:this.client,ecosystem:this.ecosystem,localStorage:this.storage,querier:this.querier})}async getUser(){if(!this.wallet){let a=await this.storage.getAuthCookie();if(!a)return{status:"Logged Out"};this.wallet=await this.initializeWallet(a)}if(!this.wallet)throw Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(a){return ae({...a,client:this.client,ecosystem:this.ecosystem})}async authenticateWithRedirect(a,b,c){return(0,ad.loginWithOauthRedirect)({authOption:a,client:this.client,ecosystem:this.ecosystem,mode:b,redirectUrl:c})}async loginWithAuthToken(a,b){return this.auth.loginWithAuthToken(a,b)}async authenticate(a){let b=a.strategy;switch(b){case"email":case"phone":return af({...a,client:this.client,ecosystem:this.ecosystem});case"auth_endpoint":return n({client:this.client,ecosystem:this.ecosystem,payload:a.payload});case"jwt":return t({client:this.client,ecosystem:this.ecosystem,jwt:a.jwt});case"passkey":return this.passkeyAuth(a);case"iframe_email_verification":return this.auth.authenticateWithIframe({email:a.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"github":case"twitch":case"farcaster":case"line":case"x":case"tiktok":case"epic":case"steam":case"coinbase":case"discord":return(0,ad.loginWithOauth)({authOption:b,client:this.client,closeOpenedWindow:a.closeOpenedWindow,ecosystem:this.ecosystem,openedWindow:a.openedWindow});case"guest":return s({client:this.client,ecosystem:this.ecosystem,storage:this.storage});case"backend":return p({client:this.client,ecosystem:this.ecosystem,walletSecret:a.walletSecret});case"wallet":return E({client:this.client,ecosystem:this.ecosystem,wallet:a.wallet,chain:a.chain})}}async connect(a){let b=a.strategy;switch(b){case"auth_endpoint":case"jwt":{let b=await this.authenticate(a);return await this.loginWithAuthToken(b,a.encryptionKey)}case"iframe_email_verification":return this.auth.loginWithIframe({email:a.email});case"iframe":return this.auth.loginWithModal();case"passkey":{let b=await this.passkeyAuth(a);return this.loginWithAuthToken(b)}case"backend":case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"github":case"line":case"x":case"tiktok":case"epic":case"guest":case"coinbase":case"twitch":case"steam":case"discord":{let b=await this.authenticate(a);return await this.auth.loginWithAuthToken(b)}default:var c=b;throw Error((void 0)??`Invalid param: ${c}`)}}async logout(){return await this.auth.logout()}async passkeyAuth(b){let{PasskeyWebClient:c}=await a.A(243041),{passkeyName:d,storeLastUsedPasskey:e=!0}=b,f=new c,g=this.storage;return"sign-up"===b.type?z({client:this.client,ecosystem:this.ecosystem,passkeyClient:f,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:e?g:void 0,username:d}):A({client:this.client,ecosystem:this.ecosystem,passkeyClient:f,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:e?g:void 0})}async linkProfile(a){let{storedToken:b}=await this.authenticate(a);return await u({client:a.client,ecosystem:a.ecosystem||this.ecosystem,storage:this.storage,tokenToLink:b.cookieString})}async unlinkProfile(a,b){return await v({allowAccountDeletion:b,client:this.client,ecosystem:this.ecosystem,profileToUnlink:a,storage:this.storage})}async getProfiles(){return w({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}a.s(["InAppWebConnector",()=>ah],460594)}];

//# sourceMappingURL=node_modules_thirdweb_dist_esm_wallets_in-app_web_lib_web-connector_9d4bdf34.js.map