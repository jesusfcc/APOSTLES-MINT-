module.exports=[108219,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function o(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(n(arguments[b]));return a}function p(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function q(a){return this instanceof q?(this.v=a,this):new q(a)}function r(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof q?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function s(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:q(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function t(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function u(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function v(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function w(a){return a&&a.__esModule?a:{default:a}}function x(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function y(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>s,"__asyncGenerator",()=>r,"__asyncValues",()=>t,"__await",()=>q,"__awaiter",()=>i,"__classPrivateFieldGet",()=>x,"__classPrivateFieldSet",()=>y,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>w,"__importStar",()=>v,"__makeTemplateObject",()=>u,"__metadata",()=>h,"__param",()=>g,"__read",()=>n,"__rest",()=>e,"__spread",()=>o,"__spreadArrays",()=>p,"__values",()=>m])},708029,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.delay=void 0,c.delay=function(a){return new Promise(b=>{setTimeout(()=>{b(!0)},a)})}},145775,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_THOUSAND=c.ONE_HUNDRED=void 0,c.ONE_HUNDRED=100,c.ONE_THOUSAND=1e3},159162,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ONE_YEAR=c.FOUR_WEEKS=c.THREE_WEEKS=c.TWO_WEEKS=c.ONE_WEEK=c.THIRTY_DAYS=c.SEVEN_DAYS=c.FIVE_DAYS=c.THREE_DAYS=c.ONE_DAY=c.TWENTY_FOUR_HOURS=c.TWELVE_HOURS=c.SIX_HOURS=c.THREE_HOURS=c.ONE_HOUR=c.SIXTY_MINUTES=c.THIRTY_MINUTES=c.TEN_MINUTES=c.FIVE_MINUTES=c.ONE_MINUTE=c.SIXTY_SECONDS=c.THIRTY_SECONDS=c.TEN_SECONDS=c.FIVE_SECONDS=c.ONE_SECOND=void 0,c.ONE_SECOND=1,c.FIVE_SECONDS=5,c.TEN_SECONDS=10,c.THIRTY_SECONDS=30,c.SIXTY_SECONDS=60,c.ONE_MINUTE=c.SIXTY_SECONDS,c.FIVE_MINUTES=5*c.ONE_MINUTE,c.TEN_MINUTES=10*c.ONE_MINUTE,c.THIRTY_MINUTES=30*c.ONE_MINUTE,c.SIXTY_MINUTES=60*c.ONE_MINUTE,c.ONE_HOUR=c.SIXTY_MINUTES,c.THREE_HOURS=3*c.ONE_HOUR,c.SIX_HOURS=6*c.ONE_HOUR,c.TWELVE_HOURS=12*c.ONE_HOUR,c.TWENTY_FOUR_HOURS=24*c.ONE_HOUR,c.ONE_DAY=c.TWENTY_FOUR_HOURS,c.THREE_DAYS=3*c.ONE_DAY,c.FIVE_DAYS=5*c.ONE_DAY,c.SEVEN_DAYS=7*c.ONE_DAY,c.THIRTY_DAYS=30*c.ONE_DAY,c.ONE_WEEK=c.SEVEN_DAYS,c.TWO_WEEKS=2*c.ONE_WEEK,c.THREE_WEEKS=3*c.ONE_WEEK,c.FOUR_WEEKS=4*c.ONE_WEEK,c.ONE_YEAR=365*c.ONE_DAY},553628,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(145775),c),d.__exportStar(a.r(159162),c)},465290,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.fromMiliseconds=c.toMiliseconds=void 0;let d=a.r(553628);c.toMiliseconds=function(a){return a*d.ONE_THOUSAND},c.fromMiliseconds=function(a){return Math.floor(a/d.ONE_THOUSAND)}},486805,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(708029),c),d.__exportStar(a.r(465290),c)},835315,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Watch=void 0;class d{constructor(){this.timestamps=new Map}start(a){if(this.timestamps.has(a))throw Error(`Watch already started for label: ${a}`);this.timestamps.set(a,{started:Date.now()})}stop(a){let b=this.get(a);if(void 0!==b.elapsed)throw Error(`Watch already stopped for label: ${a}`);let c=Date.now()-b.started;this.timestamps.set(a,{started:b.started,elapsed:c})}get(a){let b=this.timestamps.get(a);if(void 0===b)throw Error(`No timestamp found for label: ${a}`);return b}elapsed(a){let b=this.get(a);return b.elapsed||Date.now()-b.started}}c.Watch=d,c.default=d},229323,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IWatch=void 0,c.IWatch=class{}},230635,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),a.r(108219).__exportStar(a.r(229323),c)},673620,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(108219);d.__exportStar(a.r(486805),c),d.__exportStar(a.r(835315),c),d.__exportStar(a.r(230635),c),d.__exportStar(a.r(553628),c)},130146,(a,b,c)=>{b.exports=a.x("pino-28069d5257187539",()=>require("pino-28069d5257187539"))},679628,(a,b,c)=>{"use strict";function d(a){}function e(a){let b=d(a);if(!b)throw Error(`${a} is not defined in Window`);return b}Object.defineProperty(c,"__esModule",{value:!0}),c.getLocalStorage=c.getLocalStorageOrThrow=c.getCrypto=c.getCryptoOrThrow=c.getLocation=c.getLocationOrThrow=c.getNavigator=c.getNavigatorOrThrow=c.getDocument=c.getDocumentOrThrow=c.getFromWindowOrThrow=c.getFromWindow=void 0,c.getFromWindow=d,c.getFromWindowOrThrow=e,c.getDocumentOrThrow=function(){return e("document")},c.getDocument=function(){return d("document")},c.getNavigatorOrThrow=function(){return e("navigator")},c.getNavigator=function(){return d("navigator")},c.getLocationOrThrow=function(){return e("location")},c.getLocation=function(){return d("location")},c.getCryptoOrThrow=function(){return e("crypto")},c.getCrypto=function(){return d("crypto")},c.getLocalStorageOrThrow=function(){return e("localStorage")},c.getLocalStorage=function(){return d("localStorage")}},741721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.getWindowMetadata=void 0;let d=a.r(679628);c.getWindowMetadata=function(){let a,b,c;try{a=d.getDocumentOrThrow(),b=d.getLocationOrThrow()}catch(a){return null}function e(...b){let c=a.getElementsByTagName("meta");for(let a=0;a<c.length;a++){let d=c[a],e=["itemprop","property","name"].map(a=>d.getAttribute(a)).filter(a=>!!a&&b.includes(a));if(e.length&&e){let a=d.getAttribute("content");if(a)return a}}return""}let f=((c=e("name","og:site_name","og:title","twitter:title"))||(c=a.title),c),g=e("description","og:description","twitter:description","keywords"),h=b.origin;return{description:g,url:h,icons:function(){let c=a.getElementsByTagName("link"),d=[];for(let a=0;a<c.length;a++){let e=c[a],f=e.getAttribute("rel");if(f&&f.toLowerCase().indexOf("icon")>-1){let a=e.getAttribute("href");if(a)if(-1===a.toLowerCase().indexOf("https:")&&-1===a.toLowerCase().indexOf("http:")&&0!==a.indexOf("//")){let c=b.protocol+"//"+b.host;if(0===a.indexOf("/"))c+=a;else{let d=b.pathname.split("/");d.pop(),c+=d.join("/")+"/"+a}d.push(c)}else if(0===a.indexOf("//")){let c=b.protocol+a;d.push(c)}else d.push(a)}}return d}(),name:f}}},343579,(a,b,c)=>{function d(a){return(0x100000000+a).toString(16).substring(1)}b.exports={normalizeInput:function(a){let b;if(a instanceof Uint8Array)b=a;else if("string"==typeof a)b=new TextEncoder().encode(a);else throw Error("Input must be an string, Buffer or Uint8Array");return b},toHex:function(a){return Array.prototype.map.call(a,function(a){return(a<16?"0":"")+a.toString(16)}).join("")},debugPrint:function(a,b,c){let e="\n"+a+" = ";for(let f=0;f<b.length;f+=2){if(32===c)e+=d(b[f]).toUpperCase(),e+=" ",e+=d(b[f+1]).toUpperCase();else if(64===c)e+=d(b[f+1]).toUpperCase(),e+=d(b[f]).toUpperCase();else throw Error("Invalid size "+c);f%6==4?e+="\n"+Array(a.length+4).join(" "):f<b.length-2&&(e+=" ")}console.log(e)},testSpeed:function(a,b,c){let d=new Date().getTime(),e=new Uint8Array(b);for(let a=0;a<b;a++)e[a]=a%256;let f=new Date().getTime();console.log("Generated random input in "+(f-d)+"ms"),d=f;for(let f=0;f<c;f++){let c=a(e),f=new Date().getTime(),g=f-d;d=f,console.log("Hashed in "+g+"ms: "+c.substring(0,20)+"..."),console.log(Math.round(b/1048576/(g/1e3)*100)/100+" MB PER SECOND")}}}},335783,(a,b,c)=>{let d=a.r(343579);function e(a,b,c){let d=a[b]+a[c],e=a[b+1]+a[c+1];d>=0x100000000&&e++,a[b]=d,a[b+1]=e}function f(a,b,c,d){let e=a[b]+c;c<0&&(e+=0x100000000);let f=a[b+1]+d;e>=0x100000000&&f++,a[b]=e,a[b+1]=f}function g(a,b){return a[b]^a[b+1]<<8^a[b+2]<<16^a[b+3]<<24}function h(a,b,c,d,g,h){let i=l[g],j=l[g+1],m=l[h],n=l[h+1];e(k,a,b),f(k,a,i,j);let o=k[d]^k[a],p=k[d+1]^k[a+1];k[d]=p,k[d+1]=o,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=o>>>24^p<<8,k[b+1]=p>>>24^o<<8,e(k,a,b),f(k,a,m,n),o=k[d]^k[a],p=k[d+1]^k[a+1],k[d]=o>>>16^p<<16,k[d+1]=p>>>16^o<<16,e(k,c,d),o=k[b]^k[c],p=k[b+1]^k[c+1],k[b]=p>>>31^o<<1,k[b+1]=o>>>31^p<<1}let i=new Uint32Array([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),j=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3].map(function(a){return 2*a})),k=new Uint32Array(32),l=new Uint32Array(32);function m(a,b){let c=0;for(c=0;c<16;c++)k[c]=a.h[c],k[c+16]=i[c];for(k[24]=k[24]^a.t,k[25]=k[25]^a.t/0x100000000,b&&(k[28]=~k[28],k[29]=~k[29]),c=0;c<32;c++)l[c]=g(a.b,4*c);for(c=0;c<12;c++)h(0,8,16,24,j[16*c+0],j[16*c+1]),h(2,10,18,26,j[16*c+2],j[16*c+3]),h(4,12,20,28,j[16*c+4],j[16*c+5]),h(6,14,22,30,j[16*c+6],j[16*c+7]),h(0,10,20,30,j[16*c+8],j[16*c+9]),h(2,12,22,24,j[16*c+10],j[16*c+11]),h(4,14,16,26,j[16*c+12],j[16*c+13]),h(6,8,18,28,j[16*c+14],j[16*c+15]);for(c=0;c<16;c++)a.h[c]=a.h[c]^k[c]^k[c+16]}let n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function o(a,b,c,d){if(0===a||a>64)throw Error("Illegal output length, expected 0 < length <= 64");if(b&&b.length>64)throw Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(c&&16!==c.length)throw Error("Illegal salt, expected Uint8Array with length is 16");if(d&&16!==d.length)throw Error("Illegal personal, expected Uint8Array with length is 16");let e={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:a};n.fill(0),n[0]=a,b&&(n[1]=b.length),n[2]=1,n[3]=1,c&&n.set(c,32),d&&n.set(d,48);for(let a=0;a<16;a++)e.h[a]=i[a]^g(n,4*a);return b&&(p(e,b),e.c=128),e}function p(a,b){for(let c=0;c<b.length;c++)128===a.c&&(a.t+=a.c,m(a,!1),a.c=0),a.b[a.c++]=b[c]}function q(a){for(a.t+=a.c;a.c<128;)a.b[a.c++]=0;m(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c);return b}function r(a,b,c,e,f){c=c||64,a=d.normalizeInput(a),e&&(e=d.normalizeInput(e)),f&&(f=d.normalizeInput(f));let g=o(c,b,e,f);return p(g,a),q(g)}b.exports={blake2b:r,blake2bHex:function(a,b,c,e,f){let g=r(a,b,c,e,f);return d.toHex(g)},blake2bInit:o,blake2bUpdate:p,blake2bFinal:q}},824034,(a,b,c)=>{let d=a.r(343579);function e(a,b,c,d,e,g){i[a]=i[a]+i[b]+e,i[d]=f(i[d]^i[a],16),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],12),i[a]=i[a]+i[b]+g,i[d]=f(i[d]^i[a],8),i[c]=i[c]+i[d],i[b]=f(i[b]^i[c],7)}function f(a,b){return a>>>b^a<<32-b}let g=new Uint32Array([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),h=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),i=new Uint32Array(16),j=new Uint32Array(16);function k(a,b){let c=0;for(c=0;c<8;c++)i[c]=a.h[c],i[c+8]=g[c];for(i[12]^=a.t,i[13]^=a.t/0x100000000,b&&(i[14]=~i[14]),c=0;c<16;c++){var d,f;j[c]=(d=a.b)[f=4*c]^d[f+1]<<8^d[f+2]<<16^d[f+3]<<24}for(c=0;c<10;c++)e(0,4,8,12,j[h[16*c+0]],j[h[16*c+1]]),e(1,5,9,13,j[h[16*c+2]],j[h[16*c+3]]),e(2,6,10,14,j[h[16*c+4]],j[h[16*c+5]]),e(3,7,11,15,j[h[16*c+6]],j[h[16*c+7]]),e(0,5,10,15,j[h[16*c+8]],j[h[16*c+9]]),e(1,6,11,12,j[h[16*c+10]],j[h[16*c+11]]),e(2,7,8,13,j[h[16*c+12]],j[h[16*c+13]]),e(3,4,9,14,j[h[16*c+14]],j[h[16*c+15]]);for(c=0;c<8;c++)a.h[c]^=i[c]^i[c+8]}function l(a,b){if(!(a>0&&a<=32))throw Error("Incorrect output length, should be in [1, 32]");let c=b?b.length:0;if(b&&!(c>0&&c<=32))throw Error("Incorrect key length, should be in [1, 32]");let d={h:new Uint32Array(g),b:new Uint8Array(64),c:0,t:0,outlen:a};return d.h[0]^=0x1010000^c<<8^a,c>0&&(m(d,b),d.c=64),d}function m(a,b){for(let c=0;c<b.length;c++)64===a.c&&(a.t+=a.c,k(a,!1),a.c=0),a.b[a.c++]=b[c]}function n(a){for(a.t+=a.c;a.c<64;)a.b[a.c++]=0;k(a,!0);let b=new Uint8Array(a.outlen);for(let c=0;c<a.outlen;c++)b[c]=a.h[c>>2]>>8*(3&c)&255;return b}function o(a,b,c){c=c||32,a=d.normalizeInput(a);let e=l(c,b);return m(e,a),n(e)}b.exports={blake2s:o,blake2sHex:function(a,b,c){let e=o(a,b,c);return d.toHex(e)},blake2sInit:l,blake2sUpdate:m,blake2sFinal:n}},572696,(a,b,c)=>{let d=a.r(335783),e=a.r(824034);b.exports={blake2b:d.blake2b,blake2bHex:d.blake2bHex,blake2bInit:d.blake2bInit,blake2bUpdate:d.blake2bUpdate,blake2bFinal:d.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal}},588047,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,c)};function c(a,c){function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function i(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function j(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}function k(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}function l(a,b){for(var c in a)"default"===c||b.hasOwnProperty(c)||(b[c]=a[c])}function m(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function o(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(n(arguments[b]));return a}function p(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function q(a){return this instanceof q?(this.v=a,this):new q(a)}function r(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof q?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function s(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:q(a[d](b)),done:"return"===d}:e?e(b):b}:e}}function t(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=m(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function u(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}function v(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function w(a){return a&&a.__esModule?a:{default:a}}function x(a,b){if(!b.has(a))throw TypeError("attempted to get private field on non-instance");return b.get(a)}function y(a,b,c){if(!b.has(a))throw TypeError("attempted to set private field on non-instance");return b.set(a,c),c}a.s(["__assign",()=>d,"__asyncDelegator",()=>s,"__asyncGenerator",()=>r,"__asyncValues",()=>t,"__await",()=>q,"__awaiter",()=>i,"__classPrivateFieldGet",()=>x,"__classPrivateFieldSet",()=>y,"__createBinding",()=>k,"__decorate",()=>f,"__exportStar",()=>l,"__extends",()=>c,"__generator",()=>j,"__importDefault",()=>w,"__importStar",()=>v,"__makeTemplateObject",()=>u,"__metadata",()=>h,"__param",()=>g,"__read",()=>n,"__rest",()=>e,"__spread",()=>o,"__spreadArrays",()=>p,"__values",()=>m])},283435,(a,b,c)=>{"use strict";function d(){return(null===a.g||void 0===a.g?void 0:a.g.crypto)||(null===a.g||void 0===a.g?void 0:a.g.msCrypto)||{}}function e(){let a=d();return a.subtle||a.webkitSubtle}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowserCryptoAvailable=c.getSubtleCrypto=c.getBrowerCrypto=void 0,c.getBrowerCrypto=d,c.getSubtleCrypto=e,c.isBrowserCryptoAvailable=function(){return!!d()&&!!e()}},666818,(a,b,c)=>{"use strict";function d(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function e(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0,c.isReactNative=d,c.isNode=e,c.isBrowser=function(){return!d()&&!e()}},42289,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(588047);d.__exportStar(a.r(283435),c),d.__exportStar(a.r(666818),c)},136554,920275,31620,908578,636050,141651,499963,667842,258910,271137,a=>{"use strict";let b,c,d,e,f,g,h,i;var j,k,l,m=a.i(427699),n=a.i(673620);class o{}class p extends o{constructor(a){super()}}let q=n.FIVE_SECONDS,r="heartbeat_pulse";class s extends p{constructor(a){super(a),this.events=new m.EventEmitter,this.interval=q,this.interval=a?.interval||q}static async init(a){let b=new s(a);return await b.init(),b}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,n.toMiliseconds)(this.interval))}pulse(){this.events.emit(r)}}let t=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,u=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,v=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function w(a,b){var c;return"__proto__"===a||"constructor"===a&&b&&"object"==typeof b&&"prototype"in b?void(c=a,console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)):b}function x(a,b={}){if("string"!=typeof a)return a;if('"'===a[0]&&'"'===a[a.length-1]&&-1===a.indexOf("\\"))return a.slice(1,-1);let c=a.trim();if(c.length<=9)switch(c.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return NaN;case"infinity":return 1/0;case"-infinity":return-1/0}if(!v.test(a)){if(b.strict)throw SyntaxError("[destr] Invalid JSON");return a}try{if(t.test(a)||u.test(a)){if(b.strict)throw Error("[destr] Possible prototype pollution");return JSON.parse(a,w)}return JSON.parse(a)}catch(c){if(b.strict)throw c;return a}}function y(a,...b){try{var c;return(c=a(...b))&&"function"==typeof c.then?c:Promise.resolve(c)}catch(a){return Promise.reject(a)}}function z(a){let b,c;if(b=typeof a,null===a||"object"!==b&&"function"!==b)return String(a);if(!(c=Object.getPrototypeOf(a))||c.isPrototypeOf(Object)||Array.isArray(a))return JSON.stringify(a);if("function"==typeof a.toJSON)return z(a.toJSON());throw Error("[unstorage] Cannot stringify value!")}let A="base64:";function B(a){return a&&a.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function C(a){return(a=B(a))?a+":":""}function D(a,b,c){return a.watch?a.watch((a,d)=>b(a,c+d)):()=>{}}async function E(a){"function"==typeof a.dispose&&await y(a.dispose)}function F(a){return new Promise((b,c)=>{a.oncomplete=a.onsuccess=()=>b(a.result),a.onabort=a.onerror=()=>c(a.error)})}function G(a,b){let c;return(d,e)=>(()=>{if(c)return c;let d=indexedDB.open(a);return d.onupgradeneeded=()=>d.result.createObjectStore(b),(c=F(d)).then(a=>{a.onclose=()=>c=void 0},()=>{}),c})().then(a=>e(a.transaction(b,d).objectStore(b)))}function H(){return b||(b=G("keyval-store","keyval")),b}function I(a,b=H()){return b("readonly",b=>F(b.get(a)))}function J(a){if("string"!=typeof a)throw Error(`Cannot safe json parse value of type ${typeof a}`);try{return JSON.parse(a.replace(/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,'$1"$2n"$3'),(a,b)=>"string"==typeof b&&b.match(/^\d+n$/)?BigInt(b.substring(0,b.length-1)):b)}catch(b){return a}}function K(a){return"string"==typeof a?a:JSON.stringify(a,(a,b)=>"bigint"==typeof b?b.toString()+"n":b)||""}a.s(["safeJsonParse",()=>J,"safeJsonStringify",()=>K],920275);class L{constructor(){this.indexedDb=function(a={}){let b,c={mounts:{"":a.driver||(b=new Map,{name:"memory",getInstance:()=>b,hasItem:a=>b.has(a),getItem:a=>b.get(a)??null,getItemRaw:a=>b.get(a)??null,setItem(a,c){b.set(a,c)},setItemRaw(a,c){b.set(a,c)},removeItem(a){b.delete(a)},getKeys:()=>[...b.keys()],clear(){b.clear()},dispose(){b.clear()}})},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},d=a=>{for(let b of c.mountpoints)if(a.startsWith(b))return{base:b,relativeKey:a.slice(b.length),driver:c.mounts[b]};return{base:"",relativeKey:a,driver:c.mounts[""]}},e=(a,b)=>c.mountpoints.filter(c=>c.startsWith(a)||b&&a.startsWith(c)).map(b=>({relativeBase:a.length>b.length?a.slice(b.length):void 0,mountpoint:b,driver:c.mounts[b]})),f=(a,b)=>{if(c.watching)for(let d of(b=B(b),c.watchListeners))d(a,b)},g=async()=>{if(!c.watching)for(let a in c.watching=!0,c.mounts)c.unwatch[a]=await D(c.mounts[a],f,a)},h=async()=>{if(c.watching){for(let a in c.unwatch)await c.unwatch[a]();c.unwatch={},c.watching=!1}},i=(a,b,c)=>{let e=new Map,f=a=>{let b=e.get(a.base);return b||(b={driver:a.driver,base:a.base,items:[]},e.set(a.base,b)),b};for(let c of a){let a="string"==typeof c,e=B(a?c:c.key),g=a?void 0:c.value,h=a||!c.options?b:{...b,...c.options},i=d(e);f(i).items.push({key:e,value:g,relativeKey:i.relativeKey,options:h})}return Promise.all([...e.values()].map(a=>c(a))).then(a=>a.flat())},j={hasItem(a,b={}){let{relativeKey:c,driver:e}=d(a=B(a));return y(e.hasItem,c,b)},getItem(a,b={}){let{relativeKey:c,driver:e}=d(a=B(a));return y(e.getItem,c,b).then(a=>x(a))},getItems:(a,b={})=>i(a,b,a=>a.driver.getItems?y(a.driver.getItems,a.items.map(a=>({key:a.relativeKey,options:a.options})),b).then(b=>b.map(b=>({key:function(...a){return B(a.join(":"))}(a.base,b.key),value:x(b.value)}))):Promise.all(a.items.map(b=>y(a.driver.getItem,b.relativeKey,b.options).then(a=>({key:b.key,value:x(a)}))))),getItemRaw(a,b={}){let{relativeKey:c,driver:e}=d(a=B(a));return e.getItemRaw?y(e.getItemRaw,c,b):y(e.getItem,c,b).then(a=>{var b;return"string"==typeof a&&a.startsWith(A)?(b=a.slice(A.length),globalThis.Buffer?Buffer.from(b,"base64"):Uint8Array.from(globalThis.atob(b),a=>a.codePointAt(0))):a})},async setItem(a,b,c={}){if(void 0===b)return j.removeItem(a);let{relativeKey:e,driver:g}=d(a=B(a));g.setItem&&(await y(g.setItem,e,z(b),c),g.watch||f("update",a))},async setItems(a,b){await i(a,b,async a=>{if(a.driver.setItems)return y(a.driver.setItems,a.items.map(a=>({key:a.relativeKey,value:z(a.value),options:a.options})),b);a.driver.setItem&&await Promise.all(a.items.map(b=>y(a.driver.setItem,b.relativeKey,z(b.value),b.options)))})},async setItemRaw(a,b,c={}){if(void 0===b)return j.removeItem(a,c);let{relativeKey:e,driver:g}=d(a=B(a));if(g.setItemRaw)await y(g.setItemRaw,e,b,c);else{var h;if(!g.setItem)return;await y(g.setItem,e,"string"==typeof b?b:A+(h=b,globalThis.Buffer?Buffer.from(h).toString("base64"):globalThis.btoa(String.fromCodePoint(...h))),c)}g.watch||f("update",a)},async removeItem(a,b={}){"boolean"==typeof b&&(b={removeMeta:b});let{relativeKey:c,driver:e}=d(a=B(a));e.removeItem&&(await y(e.removeItem,c,b),(b.removeMeta||b.removeMata)&&await y(e.removeItem,c+"$",b),e.watch||f("remove",a))},async getMeta(a,b={}){"boolean"==typeof b&&(b={nativeOnly:b});let{relativeKey:c,driver:e}=d(a=B(a)),f=Object.create(null);if(e.getMeta&&Object.assign(f,await y(e.getMeta,c,b)),!b.nativeOnly){let a=await y(e.getItem,c+"$",b).then(a=>x(a));a&&"object"==typeof a&&("string"==typeof a.atime&&(a.atime=new Date(a.atime)),"string"==typeof a.mtime&&(a.mtime=new Date(a.mtime)),Object.assign(f,a))}return f},setMeta(a,b,c={}){return this.setItem(a+"$",b,c)},removeMeta(a,b={}){return this.removeItem(a+"$",b)},async getKeys(a,b={}){let c=e(a=C(a),!0),d=[],f=[],g=!0;for(let a of c){for(let c of(a.driver.flags?.maxDepth||(g=!1),await y(a.driver.getKeys,a.relativeBase,b))){let b=a.mountpoint+B(c);d.some(a=>b.startsWith(a))||f.push(b)}d=[a.mountpoint,...d.filter(b=>!b.startsWith(a.mountpoint))]}let h=void 0!==b.maxDepth&&!g;return f.filter(c=>{var d;return(!h||function(a,b){if(void 0===b)return!0;let c=0,d=a.indexOf(":");for(;d>-1;)c++,d=a.indexOf(":",d+1);return c<=b}(c,b.maxDepth))&&((d=a)?c.startsWith(d)&&"$"!==c[c.length-1]:"$"!==c[c.length-1])})},async clear(a,b={}){a=C(a),await Promise.all(e(a,!1).map(async a=>a.driver.clear?y(a.driver.clear,a.relativeBase,b):a.driver.removeItem?Promise.all((await a.driver.getKeys(a.relativeBase||"",b)).map(c=>a.driver.removeItem(c,b))):void 0))},async dispose(){await Promise.all(Object.values(c.mounts).map(a=>E(a)))},watch:async a=>(await g(),c.watchListeners.push(a),async()=>{c.watchListeners=c.watchListeners.filter(b=>b!==a),0===c.watchListeners.length&&await h()}),async unwatch(){c.watchListeners=[],await h()},mount(a,b){if((a=C(a))&&c.mounts[a])throw Error(`already mounted at ${a}`);return a&&(c.mountpoints.push(a),c.mountpoints.sort((a,b)=>b.length-a.length)),c.mounts[a]=b,c.watching&&Promise.resolve(D(b,f,a)).then(b=>{c.unwatch[a]=b}).catch(console.error),j},async unmount(a,b=!0){(a=C(a))&&c.mounts[a]&&(c.watching&&a in c.unwatch&&(c.unwatch[a]?.(),delete c.unwatch[a]),b&&await E(c.mounts[a]),c.mountpoints=c.mountpoints.filter(b=>b!==a),delete c.mounts[a])},getMount(a=""){let b=d(a=B(a)+":");return{driver:b.driver,base:b.base}},getMounts:(a="",b={})=>e(a=B(a),b.parents).map(a=>({driver:a.driver,base:a.mountpoint})),keys:(a,b={})=>j.getKeys(a,b),get:(a,b={})=>j.getItem(a,b),set:(a,b,c={})=>j.setItem(a,b,c),has:(a,b={})=>j.hasItem(a,b),del:(a,b={})=>j.removeItem(a,b),remove:(a,b={})=>j.removeItem(a,b)};return j}({driver:((a={})=>{let b,c=a.base&&a.base.length>0?`${a.base}:`:"";return a.dbName&&a.storeName&&(b=G(a.dbName,a.storeName)),{name:"idb-keyval",options:a,hasItem:async a=>!(typeof await I(c+a,b)>"u"),getItem:async a=>await I(c+a,b)??null,setItem:(a,d)=>(function(a,b,c=H()){return c("readwrite",c=>(c.put(b,a),F(c.transaction)))})(c+a,d,b),removeItem:a=>(function(a,b=H()){return b("readwrite",b=>(b.delete(a),F(b.transaction)))})(c+a,b),getKeys:()=>(function(a=H()){return a("readonly",a=>{var b;if(a.getAllKeys)return F(a.getAllKeys());let c=[];return(b=a=>c.push(a.key),a.openCursor().onsuccess=function(){this.result&&(b(this.result),this.result.continue())},F(a.transaction)).then(()=>c)})})(b),clear:()=>(function(a=H()){return a("readwrite",a=>(a.clear(),F(a.transaction)))})(b)}})({dbName:"WALLET_CONNECT_V2_INDEXED_DB",storeName:"keyvaluestorage"})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(a=>[a.key,a.value])}async getItem(a){let b=await this.indexedDb.getItem(a);if(null!==b)return b}async setItem(a,b){await this.indexedDb.setItem(a,K(b))}async removeItem(a){await this.indexedDb.removeItem(a)}}var M="u">typeof globalThis?globalThis:a.g,N={exports:{}};function O(a){var b;return[a[0],J(null!=(b=a[1])?b:"")]}function P(){}P.prototype.getItem=function(a){return this.hasOwnProperty(a)?String(this[a]):null},P.prototype.setItem=function(a,b){this[a]=String(b)},P.prototype.removeItem=function(a){delete this[a]},P.prototype.clear=function(){let a=this;Object.keys(a).forEach(function(b){a[b]=void 0,delete a[b]})},P.prototype.key=function(a){return a=a||0,Object.keys(this)[a]},P.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),"u">typeof M&&M.localStorage?N.exports=M.localStorage:N.exports=new P;class Q{constructor(){this.localStorage=N.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(O)}async getItem(a){let b=this.localStorage.getItem(a);if(null!==b)return J(b)}async setItem(a,b){this.localStorage.setItem(a,K(b))}async removeItem(a){this.localStorage.removeItem(a)}}let R=async(a,b,c)=>{let d="wc_storage_version",e=await b.getItem(d);if(e&&e>=1)return void c(b);let f=await a.getKeys();if(!f.length)return void c(b);let g=[];for(;f.length;){let c=f.shift();if(!c)continue;let d=c.toLowerCase();if(d.includes("wc@")||d.includes("walletconnect")||d.includes("wc_")||d.includes("wallet_connect")){let d=await a.getItem(c);await b.setItem(c,d),g.push(c)}}await b.setItem(d,1),c(b),S(a,g)},S=async(a,b)=>{b.length&&b.forEach(async b=>{await a.removeItem(b)})};class T{constructor(){this.initialized=!1,this.setInitialized=a=>{this.storage=a,this.initialized=!0};const a=new Q;this.storage=a;try{const b=new L;R(a,b,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(a){return await this.initialize(),this.storage.getItem(a)}async setItem(a,b){return await this.initialize(),this.storage.setItem(a,b)}async removeItem(a){return await this.initialize(),this.storage.removeItem(a)}async initialize(){this.initialized||await new Promise(a=>{let b=setInterval(()=>{this.initialized&&(clearInterval(b),a())},20)})}}var U=a.i(130146);let V="custom_context";class W{constructor(a){this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class X{constructor(a){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new W(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}class Y{constructor(a,b=1024e3){this.level=a??"error",this.levelValue=U.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new X(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===U.levels.values.error?console.error(a):b===U.levels.values.warn?console.warn(a):b===U.levels.values.debug?console.debug(a):b===U.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append(K({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new X(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push(K({extraMetadata:a})),new Blob(b,{type:"application/json"})}}class Z{constructor(a,b=1024e3){this.baseChunkLogger=new Y(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var $=Object.defineProperty,_=Object.defineProperties,aa=Object.getOwnPropertyDescriptors,ab=Object.getOwnPropertySymbols,ac=Object.prototype.hasOwnProperty,ad=Object.prototype.propertyIsEnumerable,ae=(a,b,c)=>b in a?$(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,af=(a,b)=>{for(var c in b||(b={}))ac.call(b,c)&&ae(a,c,b[c]);if(ab)for(var c of ab(b))ad.call(b,c)&&ae(a,c,b[c]);return a};function ag(a){return _(af({},a),aa({level:a?.level||"info"}))}function ah(a,b=V){return typeof a.bindings>"u"?function(a,b=V){return a[b]||""}(a,b):a.bindings().context||""}function ai(a,b,c=V){let d=function(a,b,c=V){let d=ah(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=V){return a[c]=b,a}(a.child({context:d}),d,c)}function aj(a){var b;let c;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(c=new Z(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:(0,U.default)(_(af({},a.opts),aa({level:"trace"})),c),chunkLoggerController:c})}a.s(["generateChildLogger",()=>ai,"generatePlatformLogger",()=>aj,"getDefaultLoggerOptions",()=>ag,"getLoggerContext",()=>ah],31620);var ak=U;a.s(["pino",()=>ak.default],908578);var ak=U,al=Object.defineProperty,am=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?al(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class an extends o{constructor(a){super(),this.opts=a,am(this,"protocol","wc"),am(this,"version",2)}}var ao=Object.defineProperty;class ap extends o{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ao(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class aq{constructor(a,b){this.logger=a,this.core=b}}class ar extends o{constructor(a,b){super(),this.relayer=a,this.logger=b}}class as extends o{constructor(a){super()}}class at{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class au extends o{constructor(a,b){super(),this.relayer=a,this.logger=b}}class av extends o{constructor(a,b){super(),this.core=a,this.logger=b}}class aw{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class ax{constructor(a,b){this.projectId=a,this.logger=b}}class ay{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var az=Object.defineProperty,aA=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?az(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};m.default;class aB{constructor(a){this.opts=a,aA(this,"protocol","wc"),aA(this,"version",2)}}m.EventEmitter;class aC{constructor(a){this.client=a}}function aD(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function aE(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let aF="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,aG=a=>new DataView(a.buffer,a.byteOffset,a.byteLength);function aH(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("utf8ToBytes expected string, got "+typeof a);return new Uint8Array(new TextEncoder().encode(a))}(a)),aD(a),a}class aI{clone(){return this._cloneInto()}}function aJ(a=32){if(aF&&"function"==typeof aF.getRandomValues)return aF.getRandomValues(new Uint8Array(a));if(aF&&"function"==typeof aF.randomBytes)return aF.randomBytes(a);throw Error("crypto.getRandomValues must be defined")}class aK extends aI{constructor(a,b,c,d){super(),this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(a),this.view=aG(this.buffer)}update(a){aE(this);let{view:b,buffer:c,blockLen:d}=this,e=(a=aH(a)).length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=aG(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){aE(this),function(a,b){aD(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=aG(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.length=d,a.pos=g,a.finished=e,a.destroyed=f,d%b&&a.buffer.set(c),a}}let aL=BigInt(0x100000000-1),aM=BigInt(32),aN=(a,b,c)=>a>>>c,aO=(a,b,c)=>a<<32-c|b>>>c,aP=(a,b,c)=>a>>>c|b<<32-c,aQ=(a,b,c)=>a<<32-c|b>>>c,aR=(a,b,c)=>a<<64-c|b>>>c-32,aS=(a,b,c)=>a>>>c-32|b<<64-c,aT=function(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}},aU=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),aV=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,aW=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),aX=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,aY=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,aZ=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),[a$,a_]=function(a,b=!1){let c=new Uint32Array(a.length),d=new Uint32Array(a.length);for(let e=0;e<a.length;e++){let{h:f,l:g}=function(a,b=!1){return b?{h:Number(a&aL),l:Number(a>>aM&aL)}:{h:0|Number(a>>aM&aL),l:0|Number(a&aL)}}(a[e],b);[c[e],d[e]]=[f,g]}return[c,d]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),a0=new Uint32Array(80),a1=new Uint32Array(80);class a2 extends aK{constructor(){super(128,64,16,!1),this.Ah=0x6a09e667,this.Al=-0xc4336f8,this.Bh=-0x4498517b,this.Bl=-0x7b3558c5,this.Ch=0x3c6ef372,this.Cl=-0x16b07d5,this.Dh=-0x5ab00ac6,this.Dl=0x5f1d36f1,this.Eh=0x510e527f,this.El=-0x52197d2f,this.Fh=-0x64fa9774,this.Fl=0x2b3e6c1f,this.Gh=0x1f83d9ab,this.Gl=-0x4be4295,this.Hh=0x5be0cd19,this.Hl=0x137e2179}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)a0[c]=a.getUint32(b),a1[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|a0[a-15],c=0|a1[a-15],d=aP(b,c,1)^aP(b,c,8)^aN(b,c,7),e=aQ(b,c,1)^aQ(b,c,8)^aO(b,c,7),f=0|a0[a-2],g=0|a1[a-2],h=aP(f,g,19)^aR(f,g,61)^aN(f,g,6),i=aW(e,aQ(f,g,19)^aS(f,g,61)^aO(f,g,6),a1[a-7],a1[a-16]),j=aX(i,d,h,a0[a-7],a0[a-16]);a0[a]=0|j,a1[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=aP(k,l,14)^aP(k,l,18)^aR(k,l,41),s=aQ(k,l,14)^aQ(k,l,18)^aS(k,l,41),t=k&m^~k&o,u=aZ(r,s,l&n^~l&p,a_[a],a1[a]),v=aY(u,q,b,t,a$[a],a0[a]),w=0|u,x=aP(c,d,28)^aR(c,d,34)^aR(c,d,39),y=aQ(c,d,28)^aS(c,d,34)^aS(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=aT(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=aU(w,y,A);c=aV(B,v,x,z),d=0|B}({h:c,l:d}=aT(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=aT(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=aT(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=aT(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=aT(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=aT(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=aT(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=aT(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){a0.fill(0),a1.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let a3=(j=()=>new a2,(c=a=>j().update(aH(a)).digest()).outputLen=(d=j()).outputLen,c.blockLen=d.blockLen,c.create=()=>j(),c),a4=BigInt(0),a5=BigInt(1),a6=BigInt(2);function a7(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function a8(a){if(!a7(a))throw Error("Uint8Array expected")}function a9(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}let ba=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bb(a){a8(a);let b="";for(let c=0;c<a.length;c++)b+=ba[a[c]];return b}function bc(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?a4:BigInt("0x"+a)}function bd(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function be(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bd(a.charCodeAt(e)),f=bd(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function bf(a){return a8(a),bc(bb(Uint8Array.from(a).reverse()))}function bg(a,b){return be(a.toString(16).padStart(2*b,"0"))}function bh(a,b){return bg(a,b).reverse()}function bi(a,b,c){let d;if("string"==typeof b)try{d=be(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(a7(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function bj(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];a8(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let bk=a=>"bigint"==typeof a&&a4<=a;function bl(a,b,c,d){if(!(bk(b)&&bk(c)&&bk(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let bm={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||a7(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function bn(a,b,c={}){let d=(b,c,d)=>{let e=bm[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if(!(d&&void 0===f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function bo(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let bp=BigInt(0),bq=BigInt(1),br=BigInt(2),bs=BigInt(3),bt=BigInt(4),bu=BigInt(5),bv=BigInt(8);function bw(a,b){let c=a%b;return c>=bp?c:b+c}function bx(a,b,c){let d=a;for(;b-- >bp;)d*=d,d%=c;return d}function by(a,b){if(a===bp)throw Error("invert: expected non-zero number");if(b<=bp)throw Error("invert: expected positive modulus, got "+b);let c=bw(a,b),d=b,e=bp,f=bq;for(;c!==bp;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==bq)throw Error("invert: does not exist");return bw(e,b)}let bz=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bA(a,b){let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function bB(a,b,c=!1,d={}){let e;if(a<=bp)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=bA(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:(a6<<BigInt(f-1))-a5,ZERO:bp,ONE:bq,create:b=>bw(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return bp<=b&&b<a},is0:a=>a===bp,isOdd:a=>(a&bq)===bq,neg:b=>bw(-b,a),eql:(a,b)=>a===b,sqr:b=>bw(b*b,a),add:(b,c)=>bw(b+c,a),sub:(b,c)=>bw(b-c,a),mul:(b,c)=>bw(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<bp)throw Error("invalid exponent, negatives unsupported");if(c===bp)return a.ONE;if(c===bq)return b;let d=a.ONE,e=b;for(;c>bp;)c&bq&&(d=a.mul(d,e)),e=a.sqr(e),c>>=bq;return d})(h,a,b),div:(b,c)=>bw(b*by(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>by(b,a),sqrt:d.sqrt||(b=>(e||(e=function(a){if(a%bt===bs){let b=(a+bq)/bt;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}if(a%bv===bu){let b=(a-bu)/bv;return function(a,c){let d=a.mul(c,br),e=a.pow(d,b),f=a.mul(c,e),g=a.mul(a.mul(f,br),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),c))throw Error("Cannot find square root");return h}}return function(a){let b,c,d,e=(a-bq)/br;for(b=a-bq,c=0;b%br===bp;b/=br,c++);for(d=br;d<a&&function(a,b,c){if(b<bp)throw Error("invalid exponent, negatives unsupported");if(c<=bp)throw Error("invalid modulus");if(c===bq)return bp;let d=bq;for(;b>bp;)b&bq&&(d=d*a%c),a=a*a%c,b>>=bq;return d}(d,e,a)!==a-bq;d++)if(d>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===c){let b=(a+bq)/bt;return function(a,c){let d=a.pow(c,b);if(!a.eql(a.sqr(d),c))throw Error("Cannot find square root");return d}}let f=(b+bq)/br;return function(a,g){if(a.pow(g,e)===a.neg(a.ONE))throw Error("Cannot find square root");let h=c,i=a.pow(a.mul(a.ONE,d),b),j=a.pow(g,f),k=a.pow(g,b);for(;!a.eql(k,a.ONE);){if(a.eql(k,a.ZERO))return a.ZERO;let b=1;for(let c=a.sqr(k);b<h&&!a.eql(c,a.ONE);b++)c=a.sqr(c);let c=a.pow(i,bq<<BigInt(h-b-1));i=a.sqr(c),j=a.mul(j,c),k=a.mul(k,i),h=b}return j}}(a)}(a)),e(h,b))),invertBatch:a=>{let b,c,d;return b=Array(a.length),c=a.reduce((a,c,d)=>h.is0(c)?a:(b[d]=a,h.mul(a,c)),h.ONE),d=h.inv(c),a.reduceRight((a,c,d)=>h.is0(c)?a:(b[d]=h.mul(a,b[d]),h.mul(a,c)),d),b},cmov:(a,b,c)=>c?b:a,toBytes:a=>c?bh(a,g):bg(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?bf(a):bc(bb(a))}});return Object.freeze(h)}let bC=BigInt(0),bD=BigInt(1);function bE(a,b){let c=b.negate();return a?c:b}function bF(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function bG(a,b){return bF(a,b),{windows:Math.ceil(b/a)+1,windowSize:2**(a-1)}}let bH=new WeakMap,bI=new WeakMap;function bJ(a){return bI.get(a)||1}let bK=BigInt(0),bL=BigInt(1),bM=BigInt(2),bN=BigInt(8),bO={zip215:!0};BigInt(0),BigInt(1);let bP=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),bQ=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);let bR=BigInt(1),bS=BigInt(2);BigInt(3);let bT=BigInt(5),bU=BigInt(8),bV=bB(bP,void 0,!0),bW=function(a){var b;let c,d=(bn(a.Fp,bz.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),bn(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),c=Object.freeze({...bA(a.n,a.nBitLength),...a,p:a.Fp.ORDER}),bn(a,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...c})),{Fp:e,n:f,prehash:g,hash:h,randomBytes:i,nByteLength:j,h:k}=d,l=bM<<BigInt(8*j)-bL,m=e.create,n=bB(d.n,d.nBitLength),o=d.uvRatio||((a,b)=>{try{return{isValid:!0,value:e.sqrt(a*e.inv(b))}}catch{return{isValid:!1,value:bK}}}),p=d.adjustScalarBytes||(a=>a),q=d.domain||((a,b,c)=>{if(a9("phflag",c),b.length||c)throw Error("Contexts/pre-hash are not supported");return a});function r(a,b){bl("coordinate "+a,b,bK,l)}function s(a){if(!(a instanceof v))throw Error("ExtendedPoint expected")}let t=bo((a,b)=>{let{ex:c,ey:d,ez:f}=a,g=a.is0();null==b&&(b=g?bN:e.inv(f));let h=m(c*b),i=m(d*b),j=m(f*b);if(g)return{x:bK,y:bL};if(j!==bL)throw Error("invZ was invalid");return{x:h,y:i}}),u=bo(a=>{let{a:b,d:c}=d;if(a.is0())throw Error("bad point: ZERO");let{ex:e,ey:f,ez:g,et:h}=a,i=m(e*e),j=m(f*f),k=m(g*g),l=m(k*k),n=m(i*b);if(m(k*m(n+j))!==m(l+m(c*m(i*j))))throw Error("bad point: equation left != right (1)");if(m(e*f)!==m(g*h))throw Error("bad point: equation left != right (2)");return!0});class v{constructor(a,b,c,d){this.ex=a,this.ey=b,this.ez=c,this.et=d,r("x",a),r("y",b),r("z",c),r("t",d),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(a){if(a instanceof v)throw Error("extended point not allowed");let{x:b,y:c}=a||{};return r("x",b),r("y",c),new v(b,c,bL,m(b*c))}static normalizeZ(a){let b=e.invertBatch(a.map(a=>a.ez));return a.map((a,c)=>a.toAffine(b[c])).map(v.fromAffine)}static msm(a,b){return function(a,b,c,d){if(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})}(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b),c.length!==d.length)throw Error("arrays of points and scalars must have equal length");let e=a.ZERO,f=function(a){let b;for(b=0;a>a4;a>>=a5,b+=1);return b}(BigInt(c.length)),g=f>12?f-3:f>4?f-2:f?2:1,h=(1<<g)-1,i=Array(h+1).fill(e),j=Math.floor((b.BITS-1)/g)*g,k=e;for(let a=j;a>=0;a-=g){i.fill(e);for(let b=0;b<d.length;b++){let e=Number(d[b]>>BigInt(a)&BigInt(h));i[e]=i[e].add(c[b])}let b=e;for(let a=i.length-1,c=e;a>0;a--)c=c.add(i[a]),b=b.add(c);if(k=k.add(b),0!==a)for(let a=0;a<g;a++)k=k.double()}return k}(v,n,a,b)}_setWindowSize(a){y.setWindowSize(this,a)}assertValidity(){u(this)}equals(a){s(a);let{ex:b,ey:c,ez:d}=this,{ex:e,ey:f,ez:g}=a,h=m(b*g),i=m(e*d),j=m(c*g),k=m(f*d);return h===i&&j===k}is0(){return this.equals(v.ZERO)}negate(){return new v(m(-this.ex),this.ey,this.ez,m(-this.et))}double(){let{a:a}=d,{ex:b,ey:c,ez:e}=this,f=m(b*b),g=m(c*c),h=m(bM*m(e*e)),i=m(a*f),j=b+c,k=m(m(j*j)-f-g),l=i+g,n=l-h,o=i-g,p=m(k*n),q=m(l*o),r=m(k*o);return new v(p,q,m(n*l),r)}add(a){s(a);let{a:b,d:c}=d,{ex:e,ey:f,ez:g,et:h}=this,{ex:i,ey:j,ez:k,et:l}=a;if(b===BigInt(-1)){let a=m((f-e)*(j+i)),b=m((f+e)*(j-i)),c=m(b-a);if(c===bK)return this.double();let d=m(g*bM*l),n=m(h*bM*k),o=n+d,p=b+a,q=n-d,r=m(o*c),s=m(p*q),t=m(o*q);return new v(r,s,m(c*p),t)}let n=m(e*i),o=m(f*j),p=m(h*c*l),q=m(g*k),r=m((e+f)*(i+j)-n-o),t=q-p,u=q+p,w=m(o-b*n),x=m(r*t),y=m(u*w),z=m(r*w);return new v(x,y,m(t*u),z)}subtract(a){return this.add(a.negate())}wNAF(a){return y.wNAFCached(this,a,v.normalizeZ)}multiply(a){bl("scalar",a,bL,f);let{p:b,f:c}=this.wNAF(a);return v.normalizeZ([b,c])[0]}multiplyUnsafe(a,b=v.ZERO){return bl("scalar",a,bK,f),a===bK?x:this.is0()||a===bL?this:y.wNAFCachedUnsafe(this,a,v.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(k).is0()}isTorsionFree(){return y.unsafeLadder(this,f).is0()}toAffine(a){return t(this,a)}clearCofactor(){let{h:a}=d;return a===bL?this:this.multiplyUnsafe(a)}static fromHex(a,b=!1){let{d:c,a:f}=d,g=e.BYTES;a=bi("pointHex",a,g),a9("zip215",b);let h=a.slice(),i=a[g-1];h[g-1]=-129&i;let j=bf(h);bl("pointHex.y",j,bK,b?l:e.ORDER);let k=m(j*j),{isValid:n,value:p}=o(m(k-bL),m(c*k-f));if(!n)throw Error("Point.fromHex: invalid y coordinate");let q=(p&bL)===bL,r=(128&i)!=0;if(!b&&p===bK&&r)throw Error("Point.fromHex: x=0 and x_0=1");return r!==q&&(p=m(-p)),v.fromAffine({x:p,y:j})}static fromPrivateKey(a){return z(a).point}toRawBytes(){let{x:a,y:b}=this.toAffine(),c=bh(b,e.BYTES);return c[c.length-1]|=a&bL?128:0,c}toHex(){return bb(this.toRawBytes())}}v.BASE=new v(d.Gx,d.Gy,bL,m(d.Gx*d.Gy)),v.ZERO=new v(bK,bL,bL,bK);let{BASE:w,ZERO:x}=v,y=(b=8*j,{constTimeNegate:bE,hasPrecomputes:a=>1!==bJ(a),unsafeLadder(a,b,c=v.ZERO){let d=a;for(;b>bC;)b&bD&&(c=c.add(d)),d=d.double(),b>>=bD;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=bG(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let{windows:e,windowSize:f}=bG(a,b),g=v.ZERO,h=v.BASE,i=BigInt(2**a-1),j=2**a,k=BigInt(a);for(let a=0;a<e;a++){let b=a*f,e=Number(d&i);d>>=k,e>f&&(e-=j,d+=bD);let l=b+Math.abs(e)-1,m=a%2!=0,n=e<0;0===e?h=h.add(bE(m,c[b])):g=g.add(bE(n,c[l]))}return{p:g,f:h}},wNAFUnsafe(a,c,d,e=v.ZERO){let{windows:f,windowSize:g}=bG(a,b),h=BigInt(2**a-1),i=2**a,j=BigInt(a);for(let a=0;a<f;a++){let b=a*g;if(d===bC)break;let f=Number(d&h);if(d>>=j,f>g&&(f-=i,d+=bD),0===f)continue;let k=c[b+Math.abs(f)-1];f<0&&(k=k.negate()),e=e.add(k)}return e},getPrecomputes(a,b,c){let d=bH.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&bH.set(b,c(d))),d},wNAFCached(a,b,c){let d=bJ(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=bJ(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){bF(c,b),bI.set(a,c),bH.delete(a)}});function z(a){let b=e.BYTES;a=bi("private key",a,b);let c=bi("hashed private key",h(a),2*b),d=p(c.slice(0,b)),g=c.slice(b,2*b),i=bw(bf(d),f),j=w.multiply(i),k=j.toRawBytes();return{head:d,prefix:g,scalar:i,point:j,pointBytes:k}}function A(a=new Uint8Array,...b){return bw(bf(h(q(bj(...b),bi("context",a),!!g))),f)}return w._setWindowSize(8),{CURVE:d,getPublicKey:function(a){return z(a).pointBytes},sign:function(a,b,c={}){a=bi("message",a),g&&(a=g(a));let{prefix:d,scalar:h,pointBytes:i}=z(b),j=A(c.context,d,a),k=w.multiply(j).toRawBytes(),l=bw(j+A(c.context,k,i,a)*h,f);return bl("signature.s",l,bK,f),bi("result",bj(k,bh(l,e.BYTES)),2*e.BYTES)},verify:function(a,b,c,d=bO){let f,h,i,{context:j,zip215:k}=d,l=e.BYTES;a=bi("signature",a,2*l),b=bi("message",b),c=bi("publicKey",c,l),void 0!==k&&a9("zip215",k),g&&(b=g(b));let m=bf(a.slice(l,2*l));try{f=v.fromHex(c,k),h=v.fromHex(a.slice(0,l),k),i=w.multiplyUnsafe(m)}catch{return!1}if(!k&&f.isSmallOrder())return!1;let n=A(j,h.toRawBytes(),f.toRawBytes(),b);return h.add(f.multiplyUnsafe(n)).subtract(i).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:z,randomPrivateKey:()=>i(e.BYTES),precompute:(a=8,b=v.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}}({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:bV,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:bU,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:a3,randomBytes:aJ,adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a},uvRatio:function(a,b){var c;let d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=bw(b*b*b,bP),s=(c=a*bw(r*r*b,bP),d=BigInt(10),e=BigInt(20),f=BigInt(40),g=BigInt(80),i=bx(h=c*c%bP*c%bP,bS,bP)*h%bP,j=bx(i,bR,bP)*c%bP,k=bx(j,bT,bP)*j%bP,l=bx(k,d,bP)*k%bP,m=bx(l,e,bP)*l%bP,n=bx(m,f,bP)*m%bP,o=bx(n,g,bP)*n%bP,p=bx(o,g,bP)*n%bP,q=bx(p,d,bP)*k%bP,{pow_p_5_8:bx(q,bS,bP)*c%bP,b2:h}).pow_p_5_8,t=bw(a*r*s,bP),u=bw(b*t*t,bP),v=t,w=bw(t*bQ,bP),x=u===a,y=u===bw(-a,bP),z=u===bw(-a*bQ,bP);return x&&(t=v),(y||z)&&(t=w),(bw(t,bP)&bq)===bq&&(t=bw(-t,bP)),{isValid:x||y,value:t}}}),bX="base64url",bY="utf8",bZ="utf8",b$="base58btc";function b_(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function b0(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?b_(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function b1(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=b0(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return b_(c)}var b2=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let b3=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class b4{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class b5{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return b7(this,a)}}class b6{constructor(a){this.decoders=a}or(a){return b7(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let b7=(a,b)=>new b6({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class b8{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new b4(a,b,c),this.decoder=new b5(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let b9=({name:a,prefix:b,encode:c,decode:d})=>new b8(a,b,c,d),ca=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=b2(c,b);return b9({prefix:a,name:b,encode:d,decode:a=>b3(e(a))})},cb=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>b9({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var cc=Object.freeze({__proto__:null,identity:b9({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),cd=Object.freeze({__proto__:null,base2:cb({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),ce=Object.freeze({__proto__:null,base8:cb({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),cf=Object.freeze({__proto__:null,base10:ca({prefix:"9",name:"base10",alphabet:"0123456789"})}),cg=Object.freeze({__proto__:null,base16:cb({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:cb({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),ch=Object.freeze({__proto__:null,base32:cb({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:cb({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:cb({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:cb({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:cb({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:cb({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:cb({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:cb({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:cb({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),ci=Object.freeze({__proto__:null,base36:ca({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:ca({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),cj=Object.freeze({__proto__:null,base58btc:ca({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:ca({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),ck=Object.freeze({__proto__:null,base64:cb({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:cb({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:cb({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:cb({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let cl=Array.from(""),cm=cl.reduce((a,b,c)=>(a[c]=b,a),[]),cn=cl.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var co=Object.freeze({__proto__:null,base256emoji:b9({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=cm[b],"")},decode:function(a){let b=[];for(let c of a){let a=cn[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function cp(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,cp.bytes=c-d+1,b}var cq=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let cr=(a,b,c=0)=>(cp(a,b,c),b),cs=(a,b)=>{let c=b.byteLength,d=cq(a),e=d+cq(c),f=new Uint8Array(e+c);return cr(a,f,0),cr(c,f,d),f.set(b,e),new ct(a,c,b,f)};class ct{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let cu=({name:a,code:b,encode:c})=>new cv(a,b,c);class cv{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?cs(this.code,b):b.then(a=>cs(this.code,a))}throw Error("Unknown type, must be binary type")}}let cw=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var cx=Object.freeze({__proto__:null,sha256:cu({name:"sha2-256",code:18,encode:cw("SHA-256")}),sha512:cu({name:"sha2-512",code:19,encode:cw("SHA-512")})}),cy=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:b3,digest:a=>cs(0,b3(a))}});new TextEncoder,new TextDecoder;let cz={...cc,...cd,...ce,...cf,...cg,...ch,...ci,...cj,...ck,...co};function cA(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...cx,...cy});let cB=cA("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),cC=cA("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=b0((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),cD={utf8:cB,"utf-8":cB,hex:cz.base16,latin1:cC,ascii:cC,binary:cC,...cz};function cE(a,b="utf8"){let c=cD[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}function cF(a,b="utf8"){let c=cD[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?b_(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function cG(a){return J(cE(cF(a,bX),bY))}function cH(a){return cE(cF(K(a),bY),bX)}function cI(a){return["did:key","z"+cE(b1([cF("K36",b$),a]),b$)].join(":")}function cJ(a){let b=a.split(".");return{header:cG(b[0]),payload:cG(b[1]),signature:cF(b[2],bX),data:cF(b.slice(0,2).join("."),bZ)}}function cK(a=aJ(32)){let b=bW.getPublicKey(a);return{secretKey:b1([a,b]),publicKey:b}}async function cL(a,b,c,d,e=(0,n.fromMiliseconds)(Date.now())){let f={alg:"EdDSA",typ:"JWT"},g={iss:cI(d.publicKey),sub:a,aud:b,iat:e,exp:e+c},h=cF([cH((i={header:f,payload:g}).header),cH(i.payload)].join("."),bZ);var i,j={header:f,payload:g,signature:bW.sign(h,d.secretKey.slice(0,32))};return[cH(j.header),cH(j.payload),cE(j.signature,bX)].join(".")}var cM=function(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))},cN=function(a,b,c){this.name=a,this.version=b,this.os=c,this.type="browser"},cO=function(a){this.version=a,this.type="node",this.name="node",this.os=process.platform},cP=function(a,b,c,d){this.name=a,this.version=b,this.os=c,this.bot=d,this.type="bot-device"},cQ=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},cR=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},cS=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,cT=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],cU=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]],cV=a.i(679628),cW=a.i(741721);let cX="2.31.0",cY={getDocsUrl:({docsBaseUrl:a,docsPath:b="",docsSlug:c})=>b?`${a??"https://viem.sh"}${b}${c?`#${c}`:""}`:void 0,version:`viem@${cX}`};class cZ extends Error{constructor(a,b={}){const c=b.cause instanceof cZ?b.cause.details:b.cause?.message?b.cause.message:b.details,d=b.cause instanceof cZ&&b.cause.docsPath||b.docsPath,e=cY.getDocsUrl?.({...b,docsPath:d});super([a||"An error occurred.","",...b.metaMessages?[...b.metaMessages,""]:[],...e?[`Docs: ${e}`]:[],...c?[`Details: ${c}`]:[],...cY.version?[`Version: ${cY.version}`]:[]].join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=c,this.docsPath=d,this.metaMessages=b.metaMessages,this.name=b.name??this.name,this.shortMessage=a,this.version=cX}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&void 0!==b.cause?a(b.cause,c):c?null:b}(this,a)}}function c$(a,{strict:b=!0}={}){return!!a&&"string"==typeof a&&(b?/^0x[0-9a-fA-F]*$/.test(a):a.startsWith("0x"))}class c_ extends cZ{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (${a}) exceeds padding size (${b}).`,{name:"SizeExceedsPaddingSizeError"})}}function c0(a,{dir:b,size:c=32}={}){return"string"==typeof a?function(a,{dir:b,size:c=32}={}){if(null===c)return a;let d=a.replace("0x","");if(d.length>2*c)throw new c_({size:Math.ceil(d.length/2),targetSize:c,type:"hex"});return`0x${d["right"===b?"padEnd":"padStart"](2*c,"0")}`}(a,{dir:b,size:c}):function(a,{dir:b,size:c=32}={}){if(null===c)return a;if(a.length>c)throw new c_({size:a.length,targetSize:c,type:"bytes"});let d=new Uint8Array(c);for(let e=0;e<c;e++){let f="right"===b;d[f?e:c-e-1]=a[f?e:a.length-e-1]}return d}(a,{dir:b,size:c})}class c1 extends cZ{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number "${e}" is not in safe ${d?`${8*d}-bit ${c?"signed":"unsigned"} `:""}integer range ${a?`(${b} to ${a})`:`(above ${b})`}`,{name:"IntegerOutOfRangeError"})}}class c2 extends cZ{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed ${b} bytes. Given size: ${a} bytes.`,{name:"SizeOverflowError"})}}function c3(a){return c$(a,{strict:!1})?Math.ceil((a.length-2)/2):a.length}function c4(a,{size:b}){if(c3(a)>b)throw new c2({givenSize:c3(a),maxSize:b})}function c5(a,b={}){let{signed:c}=b;b.size&&c4(a,{size:b.size});let d=BigInt(a);if(!c)return d;let e=(a.length-2)/2;return d<=(1n<<8n*BigInt(e)-1n)-1n?d:d-BigInt(`0x${"f".padStart(2*e,"f")}`)-1n}let c6=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function c7(a,b={}){return"number"==typeof a||"bigint"==typeof a?c9(a,b):"string"==typeof a?function(a,b={}){return c8(da.encode(a),b)}(a,b):"boolean"==typeof a?function(a,b={}){let c=`0x${Number(a)}`;return"number"==typeof b.size?(c4(c,{size:b.size}),c0(c,{size:b.size})):c}(a,b):c8(a,b)}function c8(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=c6[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(c4(d,{size:b.size}),c0(d,{dir:"right",size:b.size})):d}function c9(a,b={}){let c,{signed:d,size:e}=b,f=BigInt(a);e?c=d?(1n<<8n*BigInt(e)-1n)-1n:2n**(8n*BigInt(e))-1n:"number"==typeof a&&(c=BigInt(Number.MAX_SAFE_INTEGER));let g="bigint"==typeof c&&d?-c-1n:0;if(c&&f>c||f<g){let b="bigint"==typeof a?"n":"";throw new c1({max:c?`${c}${b}`:void 0,min:`${g}${b}`,signed:d,size:e,value:`${a}${b}`})}let h=`0x${(d&&f<0?(1n<<BigInt(8*e))+BigInt(f):f).toString(16)}`;return e?c0(h,{size:e}):h}let da=new TextEncoder,db=new TextEncoder;function dc(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function dd(a,b={}){let c=a;b.size&&(c4(c,{size:b.size}),c=c0(c,{dir:"right",size:b.size}));let d=c.slice(2);d.length%2&&(d=`0${d}`);let e=d.length/2,f=new Uint8Array(e);for(let a=0,b=0;a<e;a++){let c=dc(d.charCodeAt(b++)),e=dc(d.charCodeAt(b++));if(void 0===c||void 0===e)throw new cZ(`Invalid byte sequence ("${d[b-2]}${d[b-1]}" in "${d}").`);f[a]=16*c+e}return f}function de(a,b={}){let c=db.encode(a);return"number"==typeof b.size?(c4(c,{size:b.size}),c0(c,{dir:"right",size:b.size})):c}var df=a.i(841049),dg=a.i(665235);let dh=BigInt(0),di=BigInt(1),dj=BigInt(2),dk=BigInt(7),dl=BigInt(256),dm=BigInt(113),dn=[],dp=[],dq=[];for(let a=0,b=di,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],dn.push(2*(5*d+c)),dp.push((a+1)*(a+2)/2%64);let e=dh;for(let a=0;a<7;a++)(b=(b<<di^(b>>dk)*dm)%dl)&dj&&(e^=di<<(di<<BigInt(a))-di);dq.push(e)}let dr=(0,df.split)(dq,!0),ds=dr[0],dt=dr[1],du=(a,b,c)=>c>32?(0,df.rotlBH)(a,b,c):(0,df.rotlSH)(a,b,c),dv=(a,b,c)=>c>32?(0,df.rotlBL)(a,b,c):(0,df.rotlSL)(a,b,c);class dw extends dg.Hash{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,(0,dg.anumber)(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,dg.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,dg.swap32IfBE)(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=du(f,g,1)^c[d],i=dv(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=dp[c],f=du(b,e,d),g=dv(b,e,d),h=dn[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=ds[d],a[1]^=dt[d]}(0,dg.clean)(c)}(this.state32,this.rounds),(0,dg.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(a){(0,dg.aexists)(this),a=(0,dg.toBytes)(a),(0,dg.abytes)(a);let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){(0,dg.aexists)(this,!1),(0,dg.abytes)(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return(0,dg.anumber)(a),this.xofInto(new Uint8Array(a))}digestInto(a){if((0,dg.aoutput)(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,dg.clean)(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new dw(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let dx=(0,dg.createHasher)(()=>new dw(136,1,32));function dy(a,b){let c=dx(c$(a,{strict:!1})?function(a,b={}){return"number"==typeof a||"bigint"==typeof a?dd(c9(a,b)):"boolean"==typeof a?function(a,b={}){let c=new Uint8Array(1);return(c[0]=Number(a),"number"==typeof b.size)?(c4(c,{size:b.size}),c0(c,{size:b.size})):c}(a,b):c$(a)?dd(a,b):de(a,b)}(a):a);return"bytes"===(b||"hex")?c:c7(c)}class dz extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let dA=new dz(8192);async function dB({hash:b,signature:c}){let d=c$(b)?b:c7(b),{secp256k1:e}=await a.A(756732),f=(()=>{if("object"==typeof c&&"r"in c&&"s"in c){let{r:a,s:b,v:d,yParity:f}=c,g=dC(Number(f??d));return new e.Signature(c5(a),c5(b)).addRecoveryBit(g)}let a=c$(c)?c:c7(c);if(65!==c3(a))throw Error("invalid signature length");let b=dC(function(a,b={}){return Number(c5(a,b))}(`0x${a.slice(130)}`));return e.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(b)})().recoverPublicKey(d.substring(2)).toHex(!1);return`0x${f}`}function dC(a){if(0===a||1===a)return a;if(27===a)return 0;if(28===a)return 1;throw Error("Invalid yParityOrV value")}async function dD({hash:a,signature:b}){var c;let d;return c=await dB({hash:a,signature:b}),d=dy(`0x${c.substring(4)}`).substring(26),function(a,b){if(dA.has(`${a}.undefined`))return dA.get(`${a}.undefined`);let c=a.substring(2).toLowerCase(),d=dy(de(c),"bytes"),e=c.split("");for(let a=0;a<40;a+=2)d[a>>1]>>4>=8&&e[a]&&(e[a]=e[a].toUpperCase()),(15&d[a>>1])>=8&&e[a+1]&&(e[a+1]=e[a+1].toUpperCase());let f=`0x${e.join("")}`;return dA.set(`${a}.undefined`,f),f}(`0x${d}`)}let dE=function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;let f=0,g=0,h=0;for(;a[f]===d;)g++,f++;let i=(a.length-f)*e+1>>>0,j=new Uint8Array(i);for(;f<a.length;){let d=a.charCodeAt(f);if(d>255)return;let e=b[d];if(255===e)return;let g=0;for(let a=i-1;(0!==e||g<h)&&-1!==a;a--,g++)e+=c*j[a]>>>0,j[a]=e%256>>>0,e=e/256>>>0;if(0!==e)throw Error("Non-zero carry");h=g,f++}let k=i-h;for(;k!==i&&0===j[k];)k++;let l=new Uint8Array(g+(i-k)),m=g;for(;k!==i;)l[m++]=j[k++];return l}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";let e=0,g=0,h=0,i=b.length;for(;h!==i&&0===b[h];)h++,e++;let j=(i-h)*f+1>>>0,k=new Uint8Array(j);for(;h!==i;){let a=b[h],d=0;for(let b=j-1;(0!==a||d<g)&&-1!==b;b--,d++)a+=256*k[b]>>>0,k[b]=a%c>>>0,a=a/c>>>0;if(0!==a)throw Error("Non-zero carry");g=d,h++}let l=j-g;for(;l!==j&&0===k[l];)l++;let m=d.repeat(e);for(;l<j;++l)m+=a.charAt(k[l]);return m},decodeUnsafe:g,decode:function(a){let b=g(a);if(b)return b;throw Error("Non-base"+c+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function dF(a){return`${a<0?"-":""}0x${Math.abs(a).toString(16).padStart(2,"0")}`}class dG{constructor(a,b){this.type=a,this.data=b}}class dH extends Error{constructor(a){super(a),Object.setPrototypeOf(this,Object.create(dH.prototype)),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:dH.name})}}function dI(a,b,c){let d=Math.floor(c/0x100000000);a.setUint32(b,d),a.setUint32(b+4,c)}function dJ(a,b){return 0x100000000*a.getInt32(b)+a.getUint32(b+4)}let dK={type:-1,encode:function(a){if(!(a instanceof Date))return null;{let b,c,d,e;return function({sec:a,nsec:b}){if(a>=0&&b>=0&&a<=0x3ffffffff)if(0===b&&a<=0xffffffff){let b=new Uint8Array(4);return new DataView(b.buffer).setUint32(0,a),b}else{let c=a/0x100000000,d=new Uint8Array(8),e=new DataView(d.buffer);return e.setUint32(0,b<<2|3&c),e.setUint32(4,0|a),d}{let c=new Uint8Array(12),d=new DataView(c.buffer);return d.setUint32(0,b),dI(d,4,a),c}}((c=Math.floor((b=a.getTime())/1e3),e=Math.floor((d=(b-1e3*c)*1e6)/1e9),{sec:c+e,nsec:d-1e9*e}))}},decode:function(a){let b=function(a){let b=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:return{sec:b.getUint32(0),nsec:0};case 8:{let a=b.getUint32(0);return{sec:(3&a)*0x100000000+b.getUint32(4),nsec:a>>>2}}case 12:return{sec:dJ(b,4),nsec:b.getUint32(0)};default:throw new dH(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${a.length}`)}}(a);return new Date(1e3*b.sec+b.nsec/1e6)}};class dL{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(dK)}register({type:a,encode:b,decode:c}){if(a>=0)this.encoders[a]=b,this.decoders[a]=c;else{let d=-1-a;this.builtInEncoders[d]=b,this.builtInDecoders[d]=c}}tryToEncode(a,b){for(let c=0;c<this.builtInEncoders.length;c++){let d=this.builtInEncoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new dG(-1-c,e)}}for(let c=0;c<this.encoders.length;c++){let d=this.encoders[c];if(null!=d){let e=d(a,b);if(null!=e)return new dG(c,e)}}return a instanceof dG?a:null}decode(a,b,c){let d=b<0?this.builtInDecoders[-1-b]:this.decoders[b];return d?d(a,b,c):new dG(b,a)}}dL.defaultCodec=new dL;let dM=new TextEncoder;function dN(a,b,c){let d=b,e=d+c,f=[],g="";for(;d<e;){let b=a[d++];if((128&b)==0)f.push(b);else if((224&b)==192){let c=63&a[d++];f.push((31&b)<<6|c)}else if((240&b)==224){let c=63&a[d++],e=63&a[d++];f.push((31&b)<<12|c<<6|e)}else if((248&b)==240){let c=(7&b)<<18|(63&a[d++])<<12|(63&a[d++])<<6|63&a[d++];c>65535&&(c-=65536,f.push(c>>>10&1023|55296),c=56320|1023&c),f.push(c)}else f.push(b);f.length>=4096&&(g+=String.fromCharCode(...f),f.length=0)}return f.length>0&&(g+=String.fromCharCode(...f)),g}let dO=new TextDecoder;function dP(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer||"undefined"!=typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}let dQ="array",dR="map_key",dS="map_value",dT=a=>{if("string"==typeof a||"number"==typeof a)return a;throw new dH("The type of key must be string or number but "+typeof a)};class dU{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(a){let b=this.getUninitializedStateFromPool();b.type=dQ,b.position=0,b.size=a,b.array=Array(a)}pushMapState(a){let b=this.getUninitializedStateFromPool();b.type=dR,b.readCount=0,b.size=a,b.map={}}getUninitializedStateFromPool(){return this.stackHeadPosition++,this.stackHeadPosition===this.stack.length&&this.stack.push({type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null}),this.stack[this.stackHeadPosition]}release(a){if(this.stack[this.stackHeadPosition]!==a)throw Error("Invalid stack state. Released state is not on top of the stack.");a.type===dQ&&(a.size=0,a.array=void 0,a.position=0,a.type=void 0),(a.type===dR||a.type===dS)&&(a.size=0,a.map=void 0,a.readCount=0,a.type=void 0),this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}let dV=new DataView(new ArrayBuffer(0)),dW=new Uint8Array(dV.buffer);try{dV.getInt8(0)}catch(a){if(!(a instanceof RangeError))throw Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}let dX=RangeError("Insufficient data"),dY=new class{constructor(a=16,b=16){this.hit=0,this.miss=0,this.maxKeyLength=a,this.maxLengthPerKey=b,this.caches=[];for(let a=0;a<this.maxKeyLength;a++)this.caches.push([])}canBeCached(a){return a>0&&a<=this.maxKeyLength}find(a,b,c){let d=this.caches[c-1];a:for(let e of d){let d=e.bytes;for(let e=0;e<c;e++)if(d[e]!==a[b+e])continue a;return e.str}return null}store(a,b){let c=this.caches[a.length-1],d={bytes:a,str:b};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=d:c.push(d)}decode(a,b,c){let d=this.find(a,b,c);if(null!=d)return this.hit++,d;this.miss++;let e=dN(a,b,c),f=Uint8Array.prototype.slice.call(a,b,b+c);return this.store(f,e),e}};class dZ{constructor(a){this.totalPos=0,this.pos=0,this.view=dV,this.bytes=dW,this.headByte=-1,this.stack=new dU,this.entered=!1,this.extensionCodec=a?.extensionCodec??dL.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.rawStrings=a?.rawStrings??!1,this.maxStrLength=a?.maxStrLength??0xffffffff,this.maxBinLength=a?.maxBinLength??0xffffffff,this.maxArrayLength=a?.maxArrayLength??0xffffffff,this.maxMapLength=a?.maxMapLength??0xffffffff,this.maxExtLength=a?.maxExtLength??0xffffffff,this.keyDecoder=a?.keyDecoder!==void 0?a.keyDecoder:dY,this.mapKeyConverter=a?.mapKeyConverter??dT}clone(){return new dZ({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=-1,this.stack.reset()}setBuffer(a){let b=dP(a);this.bytes=b,this.view=new DataView(b.buffer,b.byteOffset,b.byteLength),this.pos=0}appendBuffer(a){if(-1!==this.headByte||this.hasRemaining(1)){let b=this.bytes.subarray(this.pos),c=dP(a),d=new Uint8Array(b.length+c.length);d.set(b),d.set(c,b.length),this.setBuffer(d)}else this.setBuffer(a)}hasRemaining(a){return this.view.byteLength-this.pos>=a}createExtraByteError(a){let{view:b,pos:c}=this;return RangeError(`Extra ${b.byteLength-c} of ${b.byteLength} byte(s) found at buffer[${a}]`)}decode(a){if(this.entered)return this.clone().decode(a);try{this.entered=!0,this.reinitializeState(),this.setBuffer(a);let b=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return b}finally{this.entered=!1}}*decodeMulti(a){if(this.entered){let b=this.clone();yield*b.decodeMulti(a);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(a);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(a){if(this.entered)return this.clone().decodeAsync(a);try{let b;this.entered=!0;let c=!1;for await(let d of a){if(c)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(d);try{b=this.doDecodeSync(),c=!0}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}if(c){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return b}let{headByte:d,pos:e,totalPos:f}=this;throw RangeError(`Insufficient data in parsing ${dF(d)} at ${f} (${e} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(a){return this.decodeMultiAsync(a,!0)}decodeStream(a){return this.decodeMultiAsync(a,!1)}async *decodeMultiAsync(a,b){if(this.entered){let c=this.clone();yield*c.decodeMultiAsync(a,b);return}try{this.entered=!0;let c=b,d=-1;for await(let e of a){if(b&&0===d)throw this.createExtraByteError(this.totalPos);this.appendBuffer(e),c&&(d=this.readArraySize(),c=!1,this.complete());try{for(;yield this.doDecodeSync(),0!=--d;);}catch(a){if(!(a instanceof RangeError))throw a}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){b:for(;;){let a,b=this.readHeadByte();if(b>=224)a=b-256;else if(b<192)if(b<128)a=b;else if(b<144){let c=b-128;if(0!==c){this.pushMapState(c),this.complete();continue}a={}}else if(b<160){let c=b-144;if(0!==c){this.pushArrayState(c),this.complete();continue}a=[]}else{let c=b-160;a=this.decodeString(c,0)}else if(192===b)a=null;else if(194===b)a=!1;else if(195===b)a=!0;else if(202===b)a=this.readF32();else if(203===b)a=this.readF64();else if(204===b)a=this.readU8();else if(205===b)a=this.readU16();else if(206===b)a=this.readU32();else if(207===b)a=this.useBigInt64?this.readU64AsBigInt():this.readU64();else if(208===b)a=this.readI8();else if(209===b)a=this.readI16();else if(210===b)a=this.readI32();else if(211===b)a=this.useBigInt64?this.readI64AsBigInt():this.readI64();else if(217===b){let b=this.lookU8();a=this.decodeString(b,1)}else if(218===b){let b=this.lookU16();a=this.decodeString(b,2)}else if(219===b){let b=this.lookU32();a=this.decodeString(b,4)}else if(220===b){let b=this.readU16();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(221===b){let b=this.readU32();if(0!==b){this.pushArrayState(b),this.complete();continue}a=[]}else if(222===b){let b=this.readU16();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(223===b){let b=this.readU32();if(0!==b){this.pushMapState(b),this.complete();continue}a={}}else if(196===b){let b=this.lookU8();a=this.decodeBinary(b,1)}else if(197===b){let b=this.lookU16();a=this.decodeBinary(b,2)}else if(198===b){let b=this.lookU32();a=this.decodeBinary(b,4)}else if(212===b)a=this.decodeExtension(1,0);else if(213===b)a=this.decodeExtension(2,0);else if(214===b)a=this.decodeExtension(4,0);else if(215===b)a=this.decodeExtension(8,0);else if(216===b)a=this.decodeExtension(16,0);else if(199===b){let b=this.lookU8();a=this.decodeExtension(b,1)}else if(200===b){let b=this.lookU16();a=this.decodeExtension(b,2)}else if(201===b){let b=this.lookU32();a=this.decodeExtension(b,4)}else throw new dH(`Unrecognized type byte: ${dF(b)}`);this.complete();let c=this.stack;for(;c.length>0;){let b=c.top();if(b.type===dQ)if(b.array[b.position]=a,b.position++,b.position===b.size)a=b.array,c.release(b);else continue b;else if(b.type===dR){if("__proto__"===a)throw new dH("The key __proto__ is not allowed");b.key=this.mapKeyConverter(a),b.type=dS;continue b}else if(b.map[b.key]=a,b.readCount++,b.readCount===b.size)a=b.map,c.release(b);else{b.key=null,b.type=dR;continue b}}return a}}readHeadByte(){return -1===this.headByte&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=-1}readArraySize(){let a=this.readHeadByte();switch(a){case 220:return this.readU16();case 221:return this.readU32();default:if(a<160)return a-144;throw new dH(`Unrecognized array type byte: ${dF(a)}`)}}pushMapState(a){if(a>this.maxMapLength)throw new dH(`Max length exceeded: map length (${a}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(a)}pushArrayState(a){if(a>this.maxArrayLength)throw new dH(`Max length exceeded: array length (${a}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(a)}decodeString(a,b){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(a,b):this.decodeBinary(a,b)}decodeUtf8String(a,b){let c;if(a>this.maxStrLength)throw new dH(`Max length exceeded: UTF-8 byte length (${a}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+b+a)throw dX;let d=this.pos+b;return c=this.stateIsMapKey()&&this.keyDecoder?.canBeCached(a)?this.keyDecoder.decode(this.bytes,d,a):function(a,b,c){let d;if(!(c>200))return dN(a,b,c);return d=a.subarray(b,b+c),dO.decode(d)}(this.bytes,d,a),this.pos+=b+a,c}stateIsMapKey(){return this.stack.length>0&&this.stack.top().type===dR}decodeBinary(a,b){if(a>this.maxBinLength)throw new dH(`Max length exceeded: bin length (${a}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(a+b))throw dX;let c=this.pos+b,d=this.bytes.subarray(c,c+a);return this.pos+=b+a,d}decodeExtension(a,b){if(a>this.maxExtLength)throw new dH(`Max length exceeded: ext length (${a}) > maxExtLength (${this.maxExtLength})`);let c=this.view.getInt8(this.pos+b),d=this.decodeBinary(a,b+1);return this.extensionCodec.decode(d,c,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let a=this.view.getUint8(this.pos);return this.pos++,a}readI8(){let a=this.view.getInt8(this.pos);return this.pos++,a}readU16(){let a=this.view.getUint16(this.pos);return this.pos+=2,a}readI16(){let a=this.view.getInt16(this.pos);return this.pos+=2,a}readU32(){let a=this.view.getUint32(this.pos);return this.pos+=4,a}readI32(){let a=this.view.getInt32(this.pos);return this.pos+=4,a}readU64(){var a,b;let c=(a=this.view,b=this.pos,0x100000000*a.getUint32(b)+a.getUint32(b+4));return this.pos+=8,c}readI64(){let a=dJ(this.view,this.pos);return this.pos+=8,a}readU64AsBigInt(){let a=this.view.getBigUint64(this.pos);return this.pos+=8,a}readI64AsBigInt(){let a=this.view.getBigInt64(this.pos);return this.pos+=8,a}readF32(){let a=this.view.getFloat32(this.pos);return this.pos+=4,a}readF64(){let a=this.view.getFloat64(this.pos);return this.pos+=8,a}}class d${constructor(a){this.entered=!1,this.extensionCodec=a?.extensionCodec??dL.defaultCodec,this.context=a?.context,this.useBigInt64=a?.useBigInt64??!1,this.maxDepth=a?.maxDepth??100,this.initialBufferSize=a?.initialBufferSize??2048,this.sortKeys=a?.sortKeys??!1,this.forceFloat32=a?.forceFloat32??!1,this.ignoreUndefined=a?.ignoreUndefined??!1,this.forceIntegerToFloat=a?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new d$({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(a){if(this.entered)return this.clone().encodeSharedRef(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(a){if(this.entered)return this.clone().encode(a);try{return this.entered=!0,this.reinitializeState(),this.doEncode(a,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(a,b){if(b>this.maxDepth)throw Error(`Too deep objects in depth ${b}`);null==a?this.encodeNil():"boolean"==typeof a?this.encodeBoolean(a):"number"==typeof a?this.forceIntegerToFloat?this.encodeNumberAsFloat(a):this.encodeNumber(a):"string"==typeof a?this.encodeString(a):this.useBigInt64&&"bigint"==typeof a?this.encodeBigInt64(a):this.encodeObject(a,b)}ensureBufferSizeToWrite(a){let b=this.pos+a;this.view.byteLength<b&&this.resizeBuffer(2*b)}resizeBuffer(a){let b=new ArrayBuffer(a),c=new Uint8Array(b),d=new DataView(b);c.set(this.bytes),this.view=d,this.bytes=c}encodeNil(){this.writeU8(192)}encodeBoolean(a){!1===a?this.writeU8(194):this.writeU8(195)}encodeNumber(a){!this.forceIntegerToFloat&&Number.isSafeInteger(a)?a>=0?a<128?this.writeU8(a):a<256?(this.writeU8(204),this.writeU8(a)):a<65536?(this.writeU8(205),this.writeU16(a)):a<0x100000000?(this.writeU8(206),this.writeU32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(207),this.writeU64(a)):a>=-32?this.writeU8(224|a+32):a>=-128?(this.writeU8(208),this.writeI8(a)):a>=-32768?(this.writeU8(209),this.writeI16(a)):a>=-0x80000000?(this.writeU8(210),this.writeI32(a)):this.useBigInt64?this.encodeNumberAsFloat(a):(this.writeU8(211),this.writeI64(a)):this.encodeNumberAsFloat(a)}encodeNumberAsFloat(a){this.forceFloat32?(this.writeU8(202),this.writeF32(a)):(this.writeU8(203),this.writeF64(a))}encodeBigInt64(a){a>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(a)):(this.writeU8(211),this.writeBigInt64(a))}writeStringHeader(a){if(a<32)this.writeU8(160+a);else if(a<256)this.writeU8(217),this.writeU8(a);else if(a<65536)this.writeU8(218),this.writeU16(a);else if(a<0x100000000)this.writeU8(219),this.writeU32(a);else throw Error(`Too long string: ${a} bytes in UTF-8`)}encodeString(a){let b=function(a){let b=a.length,c=0,d=0;for(;d<b;){let e=a.charCodeAt(d++);if((0xffffff80&e)==0){c++;continue}if((0xfffff800&e)==0)c+=2;else{if(e>=55296&&e<=56319&&d<b){let b=a.charCodeAt(d);(64512&b)==56320&&(++d,e=((1023&e)<<10)+(1023&b)+65536)}(0xffff0000&e)==0?c+=3:c+=4}}return c}(a);this.ensureBufferSizeToWrite(5+b),this.writeStringHeader(b),function(a,b,c){if(a.length>50)dM.encodeInto(a,b.subarray(c));else!function(a,b,c){let d=a.length,e=c,f=0;for(;f<d;){let c=a.charCodeAt(f++);if((0xffffff80&c)==0){b[e++]=c;continue}if((0xfffff800&c)==0)b[e++]=c>>6&31|192;else{if(c>=55296&&c<=56319&&f<d){let b=a.charCodeAt(f);(64512&b)==56320&&(++f,c=((1023&c)<<10)+(1023&b)+65536)}(0xffff0000&c)==0?b[e++]=c>>12&15|224:(b[e++]=c>>18&7|240,b[e++]=c>>12&63|128),b[e++]=c>>6&63|128}b[e++]=63&c|128}}(a,b,c)}(a,this.bytes,this.pos),this.pos+=b}encodeObject(a,b){let c=this.extensionCodec.tryToEncode(a,this.context);if(null!=c)this.encodeExtension(c);else if(Array.isArray(a))this.encodeArray(a,b);else if(ArrayBuffer.isView(a))this.encodeBinary(a);else if("object"==typeof a)this.encodeMap(a,b);else throw Error(`Unrecognized object: ${Object.prototype.toString.apply(a)}`)}encodeBinary(a){let b=a.byteLength;if(b<256)this.writeU8(196),this.writeU8(b);else if(b<65536)this.writeU8(197),this.writeU16(b);else if(b<0x100000000)this.writeU8(198),this.writeU32(b);else throw Error(`Too large binary: ${b}`);let c=dP(a);this.writeU8a(c)}encodeArray(a,b){let c=a.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<0x100000000)this.writeU8(221),this.writeU32(c);else throw Error(`Too large array: ${c}`);for(let c of a)this.doEncode(c,b+1)}countWithoutUndefined(a,b){let c=0;for(let d of b)void 0!==a[d]&&c++;return c}encodeMap(a,b){let c=Object.keys(a);this.sortKeys&&c.sort();let d=this.ignoreUndefined?this.countWithoutUndefined(a,c):c.length;if(d<16)this.writeU8(128+d);else if(d<65536)this.writeU8(222),this.writeU16(d);else if(d<0x100000000)this.writeU8(223),this.writeU32(d);else throw Error(`Too large map object: ${d}`);for(let d of c){let c=a[d];this.ignoreUndefined&&void 0===c||(this.encodeString(d),this.doEncode(c,b+1))}}encodeExtension(a){if("function"==typeof a.data){let b=a.data(this.pos+6),c=b.length;if(c>=0x100000000)throw Error(`Too large extension object: ${c}`);this.writeU8(201),this.writeU32(c),this.writeI8(a.type),this.writeU8a(b);return}let b=a.data.length;if(1===b)this.writeU8(212);else if(2===b)this.writeU8(213);else if(4===b)this.writeU8(214);else if(8===b)this.writeU8(215);else if(16===b)this.writeU8(216);else if(b<256)this.writeU8(199),this.writeU8(b);else if(b<65536)this.writeU8(200),this.writeU16(b);else if(b<0x100000000)this.writeU8(201),this.writeU32(b);else throw Error(`Too large extension object: ${b}`);this.writeI8(a.type),this.writeU8a(a.data)}writeU8(a){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,a),this.pos++}writeU8a(a){let b=a.length;this.ensureBufferSizeToWrite(b),this.bytes.set(a,this.pos),this.pos+=b}writeI8(a){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,a),this.pos++}writeU16(a){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,a),this.pos+=2}writeI16(a){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,a),this.pos+=2}writeU32(a){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,a),this.pos+=4}writeI32(a){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,a),this.pos+=4}writeF32(a){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,a),this.pos+=4}writeF64(a){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,a),this.pos+=8}writeU64(a){var b,c;this.ensureBufferSizeToWrite(8),b=this.view,c=this.pos,b.setUint32(c,a/0x100000000),b.setUint32(c+4,a),this.pos+=8}writeI64(a){this.ensureBufferSizeToWrite(8),dI(this.view,this.pos,a),this.pos+=8}writeBigUint64(a){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,a),this.pos+=8}writeBigInt64(a){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,a),this.pos+=8}}function d_(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function d0(a,b){return!!Array.isArray(b)&&(0===b.length||(a?b.every(a=>"string"==typeof a):b.every(a=>Number.isSafeInteger(a))))}function d1(a){if("function"!=typeof a)throw Error("function expected");return!0}function d2(a,b){if("string"!=typeof b)throw Error(`${a}: string expected`);return!0}function d3(a){if(!Number.isSafeInteger(a))throw Error(`invalid integer: ${a}`)}function d4(a){if(!Array.isArray(a))throw Error("array expected")}function d5(a,b){if(!d0(!0,b))throw Error(`${a}: array of strings expected`)}function d6(a,b){if(!d0(!1,b))throw Error(`${a}: array of numbers expected`)}function d7(...a){let b=a=>a,c=(a,b)=>c=>a(b(c));return{encode:a.map(a=>a.encode).reduceRight(c,b),decode:a.map(a=>a.decode).reduce(c,b)}}function d8(a){let b="string"==typeof a?a.split(""):a,c=b.length;d5("alphabet",b);let d=new Map(b.map((a,b)=>[a,b]));return{encode:d=>(d4(d),d.map(d=>{if(!Number.isSafeInteger(d)||d<0||d>=c)throw Error(`alphabet.encode: digit index outside alphabet "${d}". Allowed: ${a}`);return b[d]})),decode:b=>(d4(b),b.map(b=>{d2("alphabet.decode",b);let c=d.get(b);if(void 0===c)throw Error(`Unknown letter: "${b}". Allowed: ${a}`);return c}))}}function d9(a=""){return d2("join",a),{encode:b=>(d5("join.decode",b),b.join(a)),decode:b=>(d2("join.decode",b),b.split(a))}}function ea(a,b,c){if(b<2)throw Error(`convertRadix: invalid from=${b}, base cannot be less than 2`);if(c<2)throw Error(`convertRadix: invalid to=${c}, base cannot be less than 2`);if(d4(a),!a.length)return[];let d=0,e=[],f=Array.from(a,a=>{if(d3(a),a<0||a>=b)throw Error(`invalid integer: ${a}`);return a}),g=f.length;for(;;){let a=0,h=!0;for(let e=d;e<g;e++){let g=f[e],i=b*a,j=i+g;if(!Number.isSafeInteger(j)||i/b!==a||j-g!==i)throw Error("convertRadix: carry overflow");let k=j/c;a=j%c;let l=Math.floor(k);if(f[e]=l,!Number.isSafeInteger(l)||l*c+a!==j)throw Error("convertRadix: carry overflow");h&&(l?h=!1:d=e)}if(e.push(a),h)break}for(let b=0;b<a.length-1&&0===a[b];b++)e.push(0);return e.reverse()}let eb=(a,b)=>0===b?a:eb(b,a%b),ec=(a,b)=>a+(b-eb(a,b)),ed=(()=>{let a=[];for(let b=0;b<40;b++)a.push(2**b);return a})();function ee(a,b,c,d){if(d4(a),b<=0||b>32)throw Error(`convertRadix2: wrong from=${b}`);if(c<=0||c>32)throw Error(`convertRadix2: wrong to=${c}`);if(ec(b,c)>32)throw Error(`convertRadix2: carry overflow from=${b} to=${c} carryBits=${ec(b,c)}`);let e=0,f=0,g=ed[b],h=ed[c]-1,i=[];for(let d of a){if(d3(d),d>=g)throw Error(`convertRadix2: invalid data word=${d} from=${b}`);if(e=e<<b|d,f+b>32)throw Error(`convertRadix2: carry overflow pos=${f} from=${b}`);for(f+=b;f>=c;f-=c)i.push((e>>f-c&h)>>>0);let a=ed[f];if(void 0===a)throw Error("invalid carry");e&=a-1}if(e=e<<c-f&h,!d&&f>=b)throw Error("Excess padding");if(!d&&e>0)throw Error(`Non-zero padding: ${e}`);return d&&f>0&&i.push(e>>>0),i}let ef=d7(function(a,b=!1){d3(5),!1;if(ec(8,5)>32||ec(5,8)>32)throw Error("radix2: carry overflow");return{encode:a=>{if(!d_(a))throw Error("radix2.encode input should be Uint8Array");return ee(Array.from(a),8,5,!b)},decode:a=>(d6("radix2.decode",a),Uint8Array.from(ee(a,5,8,b)))}}(5),d8("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),function(a,b="="){return d3(5),d2("padding",b),{encode(a){for(d5("padding.encode",a);5*a.length%8;)a.push(b);return a},decode(a){d5("padding.decode",a);let c=a.length;if(5*c%8)throw Error("padding: invalid, string should have whole number of bytes");for(;c>0&&a[c-1]===b;c--)if((c-1)*5%8==0)throw Error("padding: invalid, string has too much padding");return a.slice(0,c)}}}(5),d9("")),eg="function"==typeof Uint8Array.from([]).toBase64&&"function"==typeof Uint8Array.fromBase64;d3(58);function eh(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function ei(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?eh(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function ej(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=ei(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return eh(c)}"function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex||d1(a=>{if("string"!=typeof a||a.length%2!=0)throw TypeError(`hex.decode: expected string, got ${typeof a} with length ${a.length}`);return a.toLowerCase()});let ek=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}},el=new Uint8Array(0),em=a=>a.reduce((a,b)=>a+b.toString(16).padStart(2,"0"),""),en=a=>{let b=a.match(/../g);return b?new Uint8Array(b.map(a=>parseInt(a,16))):el},eo=(a,b)=>{if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0},ep=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")},eq=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),er=a=>new TextEncoder().encode(a),es=a=>new TextDecoder().decode(a);a.s(["coerce",()=>ep,"empty",()=>el,"equals",()=>eo,"fromHex",()=>en,"fromString",()=>er,"isBinary",()=>eq,"toHex",()=>em,"toString",()=>es],908619);class et{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class eu{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return ew(this,a)}}class ev{constructor(a){this.decoders=a}or(a){return ew(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let ew=(a,b)=>new ev({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class ex{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new et(a,b,c),this.decoder=new eu(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let ey=({name:a,prefix:b,encode:c,decode:d})=>new ex(a,b,c,d),ez=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=ek(c,b);return ey({prefix:a,name:b,encode:d,decode:a=>ep(e(a))})},eA=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>ey({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)}),eB=ey({prefix:"\0",name:"identity",encode:a=>es(a),decode:a=>er(a)});a.s(["identity",0,eB],236206);var eC=a.i(236206);let eD=eA({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});a.s(["base2",0,eD],412591);var eE=a.i(412591);let eF=eA({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});a.s(["base8",0,eF],393571);var eG=a.i(393571);let eH=ez({prefix:"9",name:"base10",alphabet:"0123456789"});a.s(["base10",0,eH],965715);var eI=a.i(965715);let eJ=eA({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eK=eA({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});a.s(["base16",0,eJ,"base16upper",0,eK],767012);var eL=a.i(767012);let eM=eA({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),eN=eA({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),eO=eA({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),eP=eA({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eQ=eA({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eR=eA({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),eS=eA({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eT=eA({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),eU=eA({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});a.s(["base32",0,eM,"base32hex",0,eQ,"base32hexpad",0,eS,"base32hexpadupper",0,eT,"base32hexupper",0,eR,"base32pad",0,eO,"base32padupper",0,eP,"base32upper",0,eN,"base32z",0,eU],625162);var eV=a.i(625162);let eW=ez({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),eX=ez({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});a.s(["base36",0,eW,"base36upper",0,eX],279980);var eY=a.i(279980);let eZ=ez({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),e$=ez({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});a.s(["base58btc",0,eZ,"base58flickr",0,e$],295959);var e_=a.i(295959);let e0=eA({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),e1=eA({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),e2=eA({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),e3=eA({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});a.s(["base64",0,e0,"base64pad",0,e1,"base64url",0,e2,"base64urlpad",0,e3],884919);var e4=a.i(884919);let e5=Array.from(""),e6=e5.reduce((a,b,c)=>(a[c]=b,a),[]),e7=e5.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]),e8=ey({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=e6[b],"")},decode:function(a){let b=[];for(let c of a){let a=e7[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}});a.s(["base256emoji",0,e8],438253);var e9=a.i(438253),fa=a.i(254799);function fb(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,fb.bytes=c-d+1,b}function fc(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw fc.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128)return fc.bytes=f-b,d}let fd=(a,b=0)=>[fc(a,b),fc.bytes],fe=(a,b,c=0)=>(fb(a,b,c),b),ff=a=>{var b;return(b=a)<128?1:b<16384?2:b<2097152?3:b<0x10000000?4:b<0x800000000?5:b<0x40000000000?6:b<0x2000000000000?7:b<0x100000000000000?8:b<0x8000000000000000?9:10};a.s(["decode",0,fd,"encodeTo",0,fe,"encodingLength",0,ff],703229);let fg=(a,b)=>{let c=b.byteLength,d=ff(a),e=d+ff(c),f=new Uint8Array(e+c);return fe(a,f,0),fe(c,f,d),f.set(b,e),new fj(a,c,b,f)},fh=a=>{let b=ep(a),[c,d]=fd(b),[e,f]=fd(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new fj(c,e,g,b)},fi=(a,b)=>a===b||a.code===b.code&&a.size===b.size&&eo(a.bytes,b.bytes);class fj{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}a.s(["Digest",()=>fj,"create",0,fg,"decode",0,fh,"equals",0,fi],643442);let fk=({name:a,code:b,encode:c})=>new fl(a,b,c);class fl{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?fg(this.code,b):b.then(a=>fg(this.code,a))}throw Error("Unknown type, must be binary type")}}a.s(["Hasher",()=>fl,"from",0,fk],964955);let fm=fk({name:"sha2-256",code:18,encode:a=>ep(fa.default.createHash("sha256").update(a).digest())}),fn=fk({name:"sha2-512",code:19,encode:a=>ep(fa.default.createHash("sha512").update(a).digest())});a.s(["sha256",0,fm,"sha512",0,fn],9822);var fo=a.i(9822);a.s(["identity",0,{code:0,name:"identity",encode:ep,digest:a=>fg(0,ep(a))}],651817);var fp=a.i(651817);a.s(["code",0,85,"decode",0,a=>ep(a),"encode",0,a=>ep(a),"name",0,"raw"],708321),a.i(708321);let fq=new TextEncoder,fr=new TextDecoder;a.s(["code",0,512,"decode",0,a=>JSON.parse(fr.decode(a)),"encode",0,a=>fq.encode(JSON.stringify(a)),"name",0,"json"],954056),a.i(954056);class fs{constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this.byteOffset=d.byteOffset,this.byteLength=d.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:fB,byteLength:fB,code:fA,version:fA,multihash:fA,bytes:fA,_baseCache:fB,asCID:fB})}toV0(){if(0===this.version)return this;{let{code:a,multihash:b}=this;if(a!==fw)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==fx)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return fs.createV0(b)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=fg(a,b);return fs.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(a){return a&&this.code===a.code&&this.version===a.version&&fi(this.multihash,a.multihash)}toString(a){let{bytes:b,version:c,_baseCache:d}=this;return 0===c?fu(b,d,a||eZ.encoder):fv(b,d,a||eM.encoder)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(a){return fC(/^0\.0/,fD),!!(a&&(a[fz]||a.asCID===a))}get toBaseEncodedString(){throw Error("Deprecated, use .toString()")}get codec(){throw Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw Error('"multibaseName" property is deprecated')}get prefix(){throw Error('"prefix" property is deprecated')}static asCID(a){if(a instanceof fs)return a;if(null!=a&&a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new fs(b,c,d,e||fy(b,c,d.bytes))}if(null==a||!0!==a[fz])return null;{let{version:b,multihash:c,code:d}=a,e=fh(c);return fs.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");switch(a){case 0:if(b===fw)return new fs(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${fw}) block encoding`);case 1:{let d=fy(a,b,c.bytes);return new fs(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return fs.create(0,fw,a)}static createV1(a,b){return fs.create(1,a,b)}static decode(a){let[b,c]=fs.decodeFirst(a);if(c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=fs.inspectBytes(a),c=b.size-b.multihashSize,d=ep(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new fj(b.multihashCode,b.digestSize,e,d);return[0===b.version?fs.createV0(f):fs.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=fd(a.subarray(b));return b+=d,c},d=c(),e=fw;if(18===d?(d=0,b=0):1===d&&(e=c()),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=ft(a,b),e=fs.decode(d);return e._baseCache.set(c,a),e}}let ft=(a,b)=>{switch(a[0]){case"Q":{let c=b||eZ;return[eZ.prefix,c.decode(`${eZ.prefix}${a}`)]}case eZ.prefix:{let c=b||eZ;return[eZ.prefix,c.decode(a)]}case eM.prefix:{let c=b||eM;return[eM.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}},fu=(a,b,c)=>{let{prefix:d}=c;if(d!==eZ.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}},fv=(a,b,c)=>{let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}},fw=112,fx=18,fy=(a,b,c)=>{let d=ff(a),e=d+ff(b),f=new Uint8Array(e+c.byteLength);return fe(a,f,0),fe(b,f,d),f.set(c,e),f},fz=Symbol.for("@ipld/js-cid/CID"),fA={writable:!1,configurable:!1,enumerable:!0},fB={writable:!1,enumerable:!1,configurable:!1},fC=(a,b)=>{if(a.test("0.0.0-dev"))console.warn(b);else throw Error(b)},fD=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;a.i(703229),a.i(908619),a.i(964955),a.i(643442);let fE={...eC,...eE,...eG,...eI,...eL,...eV,...eY,...e_,...e4,...e9};function fF(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...fo,...fp});let fG=fF("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),fH=fF("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=ei((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),fI={utf8:fG,"utf-8":fG,hex:fE.base16,latin1:fH,ascii:fH,binary:fH,...fE};function fJ(a,b="utf8"){let c=fI[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?eh(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function fK(a,b="utf8"){let c=fI[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}let fL={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var fM=a.i(572696);function fN(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function fO(a,b){return a.includes(":")?[a]:b.chains||[]}var fP=Object.defineProperty,fQ=Object.defineProperties,fR=Object.getOwnPropertyDescriptors,fS=Object.getOwnPropertySymbols,fT=Object.prototype.hasOwnProperty,fU=Object.prototype.propertyIsEnumerable,fV=(a,b,c)=>b in a?fP(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,fW=(a,b)=>{for(var c in b||(b={}))fT.call(b,c)&&fV(a,c,b[c]);if(fS)for(var c of fS(b))fU.call(b,c)&&fV(a,c,b[c]);return a},fX=(a,b,c)=>fV(a,"symbol"!=typeof b?b+"":b,c);let fY="react-native",fZ="node",f$="browser";function f_(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function f0(){return!(0,cV.getDocument)()&&!!(0,cV.getNavigator)()&&"ReactNative"===navigator.product}function f1(){return f0()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"}function f2(){return f0()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"}function f3(){return!f_()&&!!(0,cV.getNavigator)()&&!!(0,cV.getDocument)()}function f4(){return f0()?fY:f_()?fZ:f3()?f$:"unknown"}function f5(){var b;try{return f0()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function f6(a){var b,c;let d=f7();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=fW(fW({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},fQ(e,fR(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}function f7(){return(0,cW.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function f8(b,c,d){var e;let f,g=function(){if(f4()===fY&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new cR:"undefined"!=typeof navigator?function(a){var b=""!==a&&cT.reduce(function(b,c){var d=c[0],e=c[1];if(b)return b;var f=e.exec(a);return!!f&&[d,f]},!1);if(!b)return null;var c=b[0],d=b[1];if("searchbot"===c)return new cQ;var e=d[1]&&d[1].split(".").join("_").split("_").slice(0,3);e?e.length<3&&(e=cM(cM([],e,!0),function(a){for(var b=[],c=0;c<a;c++)b.push("0");return b}(3-e.length),!0)):e=[];var f=e.join("."),g=function(a){for(var b=0,c=cU.length;b<c;b++){var d=cU[b],e=d[0];if(d[1].exec(a))return e}return null}(a),h=cS.exec(a);return h&&h[1]?new cP(c,f,g,h[1]):new cN(c,f,g)}(navigator.userAgent):"undefined"!=typeof process&&process.version?new cO(process.version.slice(1)):null;if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=f4())===f$?[f,(null==(e=(0,cV.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function f9({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){let j=c.split("?"),k=f8(a,b,d),l=function(a,b){let c=new URLSearchParams(a);for(let a of Object.keys(b).sort())if(b.hasOwnProperty(a)){let d=b[a];void 0!==d&&c.set(a,d)}return c.toString()}(j[1]||"",{auth:e,ua:k,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0});return j[0]+"?"+l}function ga(a,b){return a.filter(a=>b.includes(a)).length===a.length}function gb(a){return Object.fromEntries(a.entries())}function gc(a){return new Map(Object.entries(a))}function gd(a=n.FIVE_MINUTES,b){let c,d,e,f,g=(0,n.toMiliseconds)(a||n.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function ge(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function gf(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function gg(a){return gf("topic",a)}function gh(a){return gf("id",a)}function gi(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function gj(a,b){return(0,n.fromMiliseconds)((b||Date.now())+(0,n.toMiliseconds)(a))}function gk(a){return Date.now()>=(0,n.toMiliseconds)(a)}function gl(a,b){return`${a}${b?`:${b}`:""}`}function gm(a=[],b=[]){return[...new Set([...a,...b])]}async function gn({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=f4();if(j===f$){let a;if(!(null!=(e=(0,cV.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===fY&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function go(a,b){let c="";try{if(f3()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function gp(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function gq(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function gr(){return"u">typeof process&&"true"===process.env.IS_VITEST}function gs(a){return Buffer.from(a,"base64").toString("utf-8")}function gt(a){return new Promise(b=>setTimeout(b,a))}class gu{constructor({limit:a}){fX(this,"limit"),fX(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let gv=BigInt(0x100000000-1),gw=BigInt(32);function gx(a,b=!1){return b?{h:Number(a&gv),l:Number(a>>gw&gv)}:{h:0|Number(a>>gw&gv),l:0|Number(a&gv)}}function gy(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=gx(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let gz=(a,b,c)=>a>>>c,gA=(a,b,c)=>a<<32-c|b>>>c,gB=(a,b,c)=>a>>>c|b<<32-c,gC=(a,b,c)=>a<<32-c|b>>>c,gD=(a,b,c)=>a<<64-c|b>>>c-32,gE=(a,b,c)=>a>>>c-32|b<<64-c;function gF(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let gG=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),gH=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,gI=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),gJ=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,gK=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),gL=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,gM="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function gN(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function gO(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function gP(a,...b){if(!gN(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function gQ(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");gO(a.outputLen),gO(a.blockLen)}function gR(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function gS(a,b){gP(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function gT(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function gU(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function gV(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function gW(a,b){return a<<32-b|a>>>b}let gX=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function gY(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let gZ=gX?a=>a:a=>gY(a),g$=gX?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=gY(a[b]);return a},g_="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,g0=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function g1(a){if(gP(a),g_)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=g0[a[c]];return b}function g2(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function g3(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(g_)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=g2(a.charCodeAt(e)),f=g2(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function g4(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a)),gP(a),a}function g5(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];gP(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class g6{}function g7(a){let b=b=>a().update(g4(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function g8(a=32){if(gM&&"function"==typeof gM.getRandomValues)return gM.getRandomValues(new Uint8Array(a));if(gM&&"function"==typeof gM.randomBytes)return Uint8Array.from(gM.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let g9=BigInt(0),ha=BigInt(1),hb=BigInt(2),hc=BigInt(7),hd=BigInt(256),he=BigInt(113),hf=[],hg=[],hh=[];for(let a=0,b=ha,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],hf.push(2*(5*d+c)),hg.push((a+1)*(a+2)/2%64);let e=g9;for(let a=0;a<7;a++)(b=(b<<ha^(b>>hc)*he)%hd)&hb&&(e^=ha<<(ha<<BigInt(a))-ha);hh.push(e)}let hi=gy(hh,!0),hj=hi[0],hk=hi[1],hl=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,hm=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class hn extends g6{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,gO(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=gT(this.state)}clone(){return this._cloneInto()}keccak(){g$(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=hl(f,g,1)^c[d],i=hm(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=hg[c],f=hl(b,e,d),g=hm(b,e,d),h=hf[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=hj[d],a[1]^=hk[d]}gU(c)}(this.state32,this.rounds),g$(this.state32),this.posOut=0,this.pos=0}update(a){gR(this),gP(a=g4(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){gR(this,!1),gP(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return gO(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(gS(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,gU(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new hn(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let ho=g7(()=>new hn(136,1,32));class hp extends g6{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=gV(this.buffer)}update(a){gR(this),gP(a=g4(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=gV(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){gR(this),gS(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,gU(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=gV(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let hq=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),hr=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),hs=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),ht=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),hu=new Uint32Array(64);class hv extends hp{constructor(a=32){super(64,a,8,!1),this.A=0|hq[0],this.B=0|hq[1],this.C=0|hq[2],this.D=0|hq[3],this.E=0|hq[4],this.F=0|hq[5],this.G=0|hq[6],this.H=0|hq[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)hu[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=hu[a-15],c=hu[a-2],d=gW(b,7)^gW(b,18)^b>>>3,e=gW(c,17)^gW(c,19)^c>>>10;hu[a]=e+hu[a-7]+d+hu[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(gW(g,6)^gW(g,11)^gW(g,25))+((k=g)&h^~k&i)+ht[a]+hu[a]|0,o=(gW(c,2)^gW(c,13)^gW(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){gU(hu)}destroy(){this.set(0,0,0,0,0,0,0,0),gU(this.buffer)}}let hw=gy(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),hx=hw[0],hy=hw[1],hz=new Uint32Array(80),hA=new Uint32Array(80);class hB extends hp{constructor(a=64){super(128,a,16,!1),this.Ah=0|hs[0],this.Al=0|hs[1],this.Bh=0|hs[2],this.Bl=0|hs[3],this.Ch=0|hs[4],this.Cl=0|hs[5],this.Dh=0|hs[6],this.Dl=0|hs[7],this.Eh=0|hs[8],this.El=0|hs[9],this.Fh=0|hs[10],this.Fl=0|hs[11],this.Gh=0|hs[12],this.Gl=0|hs[13],this.Hh=0|hs[14],this.Hl=0|hs[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)hz[c]=a.getUint32(b),hA[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|hz[a-15],c=0|hA[a-15],d=gB(b,c,1)^gB(b,c,8)^gz(b,c,7),e=gC(b,c,1)^gC(b,c,8)^gA(b,c,7),f=0|hz[a-2],g=0|hA[a-2],h=gB(f,g,19)^gD(f,g,61)^gz(f,g,6),i=gI(e,gC(f,g,19)^gE(f,g,61)^gA(f,g,6),hA[a-7],hA[a-16]),j=gJ(i,d,h,hz[a-7],hz[a-16]);hz[a]=0|j,hA[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=gB(k,l,14)^gB(k,l,18)^gD(k,l,41),s=gC(k,l,14)^gC(k,l,18)^gE(k,l,41),t=k&m^~k&o,u=gK(r,s,l&n^~l&p,hy[a],hA[a]),v=gL(u,q,b,t,hx[a],hz[a]),w=0|u,x=gB(c,d,28)^gD(c,d,34)^gD(c,d,39),y=gC(c,d,28)^gE(c,d,34)^gE(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=gF(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=gG(w,y,A);c=gH(B,v,x,z),d=0|B}({h:c,l:d}=gF(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=gF(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=gF(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=gF(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=gF(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=gF(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=gF(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=gF(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){gU(hz,hA)}destroy(){gU(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class hC extends hB{constructor(){super(48),this.Ah=0|hr[0],this.Al=0|hr[1],this.Bh=0|hr[2],this.Bl=0|hr[3],this.Ch=0|hr[4],this.Cl=0|hr[5],this.Dh=0|hr[6],this.Dl=0|hr[7],this.Eh=0|hr[8],this.El=0|hr[9],this.Fh=0|hr[10],this.Fl=0|hr[11],this.Gh=0|hr[12],this.Gl=0|hr[13],this.Hh=0|hr[14],this.Hl=0|hr[15]}}let hD=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class hE extends hB{constructor(){super(32),this.Ah=0|hD[0],this.Al=0|hD[1],this.Bh=0|hD[2],this.Bl=0|hD[3],this.Ch=0|hD[4],this.Cl=0|hD[5],this.Dh=0|hD[6],this.Dl=0|hD[7],this.Eh=0|hD[8],this.El=0|hD[9],this.Fh=0|hD[10],this.Fl=0|hD[11],this.Gh=0|hD[12],this.Gl=0|hD[13],this.Hh=0|hD[14],this.Hl=0|hD[15]}}let hF=g7(()=>new hv),hG=g7(()=>new hB),hH=g7(()=>new hC),hI=g7(()=>new hE),hJ=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),hK=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),hL=new Uint32Array(32);function hM(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=hL[2*a],j=hL[2*a+1],k=hL[2*b],l=hL[2*b+1],m=hL[2*c],n=hL[2*c+1],o=hL[2*d],p=hL[2*d+1],q=gG(i,k,g);j=gH(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=gF(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:gB(l,k,24),Bl:gC(l,k,24)}),hL[2*a]=i,hL[2*a+1]=j,hL[2*b]=k,hL[2*b+1]=l,hL[2*c]=m,hL[2*c+1]=n,hL[2*d]=o,hL[2*d+1]=p}function hN(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=hL[2*a],j=hL[2*a+1],k=hL[2*b],l=hL[2*b+1],m=hL[2*c],n=hL[2*c+1],o=hL[2*d],p=hL[2*d+1],q=gG(i,k,g);j=gH(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:gB(p,o,16),Dl:gC(p,o,16)}),({h:n,l:m}=gF(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:gD(l,k,63),Bl:gE(l,k,63)}),hL[2*a]=i,hL[2*a+1]=j,hL[2*b]=k,hL[2*b+1]=l,hL[2*c]=m,hL[2*c+1]=n,hL[2*d]=o,hL[2*d+1]=p}class hO extends g6{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,gO(a),gO(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=gT(this.buffer)}update(a){gR(this),gP(a=g4(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(g$(d),this.compress(d,0,!1),g$(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));g$(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);g$(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){gR(this),gS(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,gU(this.buffer.subarray(b)),g$(c),this.compress(c,0,!0),g$(c);let d=gT(a);this.get().forEach((a,b)=>d[b]=gZ(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class hP extends hO{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|hK[0],this.v0h=0|hK[1],this.v1l=0|hK[2],this.v1h=0|hK[3],this.v2l=0|hK[4],this.v2h=0|hK[5],this.v3l=0|hK[6],this.v3h=0|hK[7],this.v4l=0|hK[8],this.v4h=0|hK[9],this.v5l=0|hK[10],this.v5h=0|hK[11],this.v6l=0|hK[12],this.v6h=0|hK[13],this.v7l=0|hK[14],this.v7h=0|hK[15],function(a,b={},c,d,e){if(gO(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=g4(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=gT(e=g4(e));this.v4l^=gZ(a[0]),this.v4h^=gZ(a[1]),this.v5l^=gZ(a[2]),this.v5h^=gZ(a[3])}if(void 0!==d){const a=gT(d=g4(d));this.v6l^=gZ(a[0]),this.v6h^=gZ(a[1]),this.v7l^=gZ(a[2]),this.v7h^=gZ(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>hL[b]=a),hL.set(hK,16);let{h:d,l:e}=gx(BigInt(this.length));hL[24]=hK[8]^e,hL[25]=hK[9]^d,c&&(hL[28]=~hL[28],hL[29]=~hL[29]);let f=0;for(let c=0;c<12;c++)hM(0,4,8,12,a,b+2*hJ[f++]),hN(0,4,8,12,a,b+2*hJ[f++]),hM(1,5,9,13,a,b+2*hJ[f++]),hN(1,5,9,13,a,b+2*hJ[f++]),hM(2,6,10,14,a,b+2*hJ[f++]),hN(2,6,10,14,a,b+2*hJ[f++]),hM(3,7,11,15,a,b+2*hJ[f++]),hN(3,7,11,15,a,b+2*hJ[f++]),hM(0,5,10,15,a,b+2*hJ[f++]),hN(0,5,10,15,a,b+2*hJ[f++]),hM(1,6,11,12,a,b+2*hJ[f++]),hN(1,6,11,12,a,b+2*hJ[f++]),hM(2,7,8,13,a,b+2*hJ[f++]),hN(2,7,8,13,a,b+2*hJ[f++]),hM(3,4,9,14,a,b+2*hJ[f++]),hN(3,4,9,14,a,b+2*hJ[f++]);this.v0l^=hL[0]^hL[16],this.v0h^=hL[1]^hL[17],this.v1l^=hL[2]^hL[18],this.v1h^=hL[3]^hL[19],this.v2l^=hL[4]^hL[20],this.v2h^=hL[5]^hL[21],this.v3l^=hL[6]^hL[22],this.v3h^=hL[7]^hL[23],this.v4l^=hL[8]^hL[24],this.v4h^=hL[9]^hL[25],this.v5l^=hL[10]^hL[26],this.v5h^=hL[11]^hL[27],this.v6l^=hL[12]^hL[28],this.v6h^=hL[13]^hL[29],this.v7l^=hL[14]^hL[30],this.v7h^=hL[15]^hL[31],gU(hL)}destroy(){this.destroyed=!0,gU(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let hQ=(k=a=>new hP(a),(e=(a,b)=>k(b).update(g4(a)).digest()).outputLen=(f=k({})).outputLen,e.blockLen=f.blockLen,e.create=a=>k(a),e);function hR(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(ho(c)).toString("hex")}async function hS(a,b,c,d,e,f){switch(c.t){case"eip191":return await hT(a,b,c.s);case"eip1271":return await hU(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function hT(a,b,c){return(await dD({hash:hR(b),signature:c})).toLowerCase()===a.toLowerCase()}async function hU(a,b,c,d,e,f){let g=fN(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:hR(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function hV(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return dE.encode(e)}function hW(a){let b=new Uint8Array(Buffer.from(a,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),d=new Uint8Array(c.length+b.length);d.set(c),d.set(b,c.length);let e=hQ(d,{dkLen:32});return dE.encode(e)}function hX(a){let b=new Uint8Array(hF(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return dE.encode(b)}function hY(a){var b;let c=(b=Buffer.from(a,"base64"),new dZ(void 0).decode(b)).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=new d$(void 0).encodeSharedRef(c),e=Buffer.from("TX"),f=hI(Buffer.concat([e,Buffer.from(d)]));return ef.encode(f).replace(/=+$/,"")}function hZ(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}function h$(a){let b=Buffer.from(a.signed.bodyBytes,"base64"),c=Buffer.from(a.signed.authInfoBytes,"base64"),d=Buffer.from(a.signature.signature,"base64"),e=[];e.push(Buffer.from([10])),e.push(hZ(b.length)),e.push(b),e.push(Buffer.from([18])),e.push(hZ(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(hZ(d.length)),e.push(d);let f=hF(Buffer.concat(e));return Buffer.from(f).toString("hex").toUpperCase()}var h_=Object.defineProperty,h0=Object.defineProperties,h1=Object.getOwnPropertyDescriptors,h2=Object.getOwnPropertySymbols,h3=Object.prototype.hasOwnProperty,h4=Object.prototype.propertyIsEnumerable,h5=(a,b,c)=>b in a?h_(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let h6=a=>a?.split(":"),h7=a=>{let b=a&&h6(a);if(b)return b[2]+":"+b[3]},h8=a=>{let b=a&&h6(a);if(b)return b.pop()};async function h9(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=ia(e,e.iss),g=h8(e.iss);return await hS(g,f,d,h7(e.iss),c)}let ia=(a,b)=>{let c=`${a.domain} wants you to sign in with your Ethereum account:`,d=h8(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let e=a.statement||void 0,f=`URI: ${a.aud||a.uri}`,g=`Version: ${a.version}`,h=`Chain ID: ${(a=>{let b=a&&h6(a);if(b)return a.includes("did:pkh:")?b[3]:b[1]})(b)}`,i=`Nonce: ${a.nonce}`,j=`Issued At: ${a.iat}`,k=a.exp?`Expiration Time: ${a.exp}`:void 0,l=a.nbf?`Not Before: ${a.nbf}`:void 0,m=a.requestId?`Request ID: ${a.requestId}`:void 0,n=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,o=ij(a.resources);return o&&(e=function(a="",b){ib(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(e,id(o))),[c,d,"",e,"",f,g,h,i,j,k,l,m,n].filter(a=>null!=a).join(`
`)};function ib(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function ic(a){return ib(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function id(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return ib(c),c}function ie(a,b,c){return ic(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(a,b,c))}function ig(a,b){var c,d;let e,f;return ic((c=id(a),d=id(b),ib(c),ib(d),e=Object.keys(c.att).concat(Object.keys(d.att)).sort((a,b)=>a.localeCompare(b)),f={att:{}},e.forEach(a=>{var b,e;Object.keys((null==(b=c.att)?void 0:b[a])||{}).concat(Object.keys((null==(e=d.att)?void 0:e[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(b=>{var e,g;f.att[a]=h0(((a,b)=>{for(var c in b||(b={}))h3.call(b,c)&&h5(a,c,b[c]);if(h2)for(var c of h2(b))h4.call(b,c)&&h5(a,c,b[c]);return a})({},f.att[a]),h1({[b]:(null==(e=c.att[a])?void 0:e[b])||(null==(g=d.att[a])?void 0:g[b])}))})}),f))}function ih(a){var b;let c=id(a);ib(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function ii(a){let b=id(a);ib(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function ij(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function ik(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function il(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function im(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function io(a,...b){if(!ik(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function ip(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function iq(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ir(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let is=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function it(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(ik(a))a=iw(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function iu(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function iv(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function iw(a){return Uint8Array.from(a)}let ix=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),iy=ix("expand 16-byte k"),iz=ix("expand 32-byte k"),iA=iq(iy),iB=iq(iz);function iC(a,b){return a<<b|a>>>32-b}function iD(a){return a.byteOffset%4==0}let iE=0x100000000-1,iF=new Uint32Array,iG=(a,b)=>255&a[b++]|(255&a[b++])<<8;class iH{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,io(a=it(a),32);const b=iG(a,0),c=iG(a,2),d=iG(a,4),e=iG(a,6),f=iG(a,8),g=iG(a,10),h=iG(a,12),i=iG(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=iG(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=iG(a,b+0),q=iG(a,b+2),r=iG(a,b+4),s=iG(a,b+6),t=iG(a,b+8),u=iG(a,b+10),v=iG(a,b+12),w=iG(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;ir(c)}update(a){ip(this),io(a=it(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){ir(this.h,this.r,this.buffer,this.pad)}digestInto(a){ip(this),function(a,b){io(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let iI=(l=a=>new iH(a),(g=(a,b)=>l(b).update(it(a)).digest()).outputLen=(h=l(new Uint8Array(32))).outputLen,g.blockLen=h.blockLen,g.create=a=>l(a),g),iJ=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return im(e),im(g),il(f),il(c),(b,h,i,j,k=0)=>{io(b),io(h),io(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),io(j),im(k),k<0||k>=iE)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=iw(b)),p=iB;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=iA,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);iD(h)||m.push(h=iw(h));let q=iq(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,iq(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=iq(j),l=iD(e)&&iD(f),m=l?iq(e):iF,n=l?iq(f):iF;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=iE)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,iq(h),i,j,k,g),ir(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=iC(H^(v=v+z|0),16))|0,v=v+(z=iC(z^D,12))|0,D=D+(H=iC(H^v,8))|0,z=iC(z^D,7),E=E+(I=iC(I^(w=w+A|0),16))|0,w=w+(A=iC(A^E,12))|0,E=E+(I=iC(I^w,8))|0,A=iC(A^E,7),F=F+(J=iC(J^(x=x+B|0),16))|0,x=x+(B=iC(B^F,12))|0,F=F+(J=iC(J^x,8))|0,B=iC(B^F,7),G=G+(K=iC(K^(y=y+C|0),16))|0,y=y+(C=iC(C^G,12))|0,G=G+(K=iC(K^y,8))|0,C=iC(C^G,7),F=F+(K=iC(K^(v=v+A|0),16))|0,v=v+(A=iC(A^F,12))|0,F=F+(K=iC(K^v,8))|0,A=iC(A^F,7),G=G+(H=iC(H^(w=w+B|0),16))|0,w=w+(B=iC(B^G,12))|0,G=G+(H=iC(H^w,8))|0,B=iC(B^G,7),D=D+(I=iC(I^(x=x+C|0),16))|0,x=x+(C=iC(C^D,12))|0,D=D+(I=iC(I^x,8))|0,C=iC(C^D,7),E=E+(J=iC(J^(y=y+z|0),16))|0,y=y+(z=iC(z^E,12))|0,E=E+(J=iC(J^y,8))|0,z=iC(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),iK=new Uint8Array(16),iL=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(iK.subarray(c))},iM=new Uint8Array(32);function iN(a,b,c,d,e){var f,g;let h,i,j=a(b,c,iM),k=iI.create(j);e&&iL(k,e),iL(k,d);let l=(f=d.length,g=e?e.length:0,il(!0),iv(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),iv(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return ir(j,l),m}let iO=((a,b)=>{function c(d,...e){if(io(d),!is)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?io(b):io(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&io(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");io(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,io(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(io(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=iu(f+16,e,!1)).set(d);let g=e.subarray(0,-16);iJ(a,b,g,g,1);let h=iN(iJ,a,b,g,c);return e.set(h,f),ir(h),e},decrypt(d,e){e=iu(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=iN(iJ,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),iJ(a,b,e,e,1),ir(h),e}}));class iP extends g6{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,gQ(a);const c=g4(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),gU(e)}update(a){return gR(this),this.iHash.update(a),this}digestInto(a){gR(this),gP(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let iQ=(a,b,c)=>new iP(a,b).update(c).digest();iQ.create=(a,b)=>new iP(a,b);let iR=Uint8Array.from([0]),iS=Uint8Array.of(),iT=BigInt(0),iU=BigInt(1);function iV(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function iW(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function iX(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?iT:BigInt("0x"+a)}function iY(a){return gP(a),iX(g1(Uint8Array.from(a).reverse()))}function iZ(a,b){return g3(a.toString(16).padStart(2*b,"0"))}function i$(a,b){return iZ(a,b).reverse()}function i_(a,b,c){let d;if("string"==typeof b)try{d=g3(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(gN(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let i0=a=>"bigint"==typeof a&&iT<=a;function i1(a,b,c,d){if(!(i0(b)&&i0(c)&&i0(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let i2=a=>(iU<<BigInt(a))-iU;function i3(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function i4(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let i5=BigInt(0),i6=BigInt(1),i7=BigInt(2),i8=BigInt(3),i9=BigInt(4),ja=BigInt(5),jb=BigInt(8);function jc(a,b){let c=a%b;return c>=i5?c:b+c}function jd(a,b,c){let d=a;for(;b-- >i5;)d*=d,d%=c;return d}function je(a,b){if(a===i5)throw Error("invert: expected non-zero number");if(b<=i5)throw Error("invert: expected positive modulus, got "+b);let c=jc(a,b),d=b,e=i5,f=i6;for(;c!==i5;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==i6)throw Error("invert: does not exist");return jc(e,b)}function jf(a,b){let c=(a.ORDER+i6)/i9,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function jg(a,b){let c=(a.ORDER-ja)/jb,d=a.mul(b,i7),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,i7),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let jh=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ji(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function jj(a,b){let c=(a.ORDER-i6)/i7,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function jk(a,b,c=!1,d={}){var e;let f,g,h,i,j;if(a<=i5)throw Error("invalid field: expected ORDER > 0, got "+a);if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE)}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:k,nByteLength:l}=(void 0!==(e=f)&&gO(e),j=Math.ceil((i=void 0!==e?e:a.toString(2).length)/8),{nBitLength:i,nByteLength:j});if(l>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let m=Object.freeze({ORDER:a,isLE:c,BITS:k,BYTES:l,MASK:i2(k),ZERO:i5,ONE:i6,create:b=>jc(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return i5<=b&&b<a},is0:a=>a===i5,isValidNot0:a=>!m.is0(a)&&m.isValid(a),isOdd:a=>(a&i6)===i6,neg:b=>jc(-b,a),eql:(a,b)=>a===b,sqr:b=>jc(b*b,a),add:(b,c)=>jc(b+c,a),sub:(b,c)=>jc(b-c,a),mul:(b,c)=>jc(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<i5)throw Error("invalid exponent, negatives unsupported");if(c===i5)return a.ONE;if(c===i6)return b;let d=a.ONE,e=b;for(;c>i5;)c&i6&&(d=a.mul(d,e)),e=a.sqr(e),c>>=i6;return d})(m,a,b),div:(b,c)=>jc(b*je(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>je(b,a),sqrt:g||(b=>(h||(h=a%i9===i8?jf:a%jb===ja?jg:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-i6,c=0;for(;b%i7===i5;)b/=i7,c++;let d=i7,e=jk(a);for(;1===jj(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return jf;let f=e.pow(d,b),g=(b+i6)/i7;return function(a,d){if(a.is0(d))return d;if(1!==jj(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=i6<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),h(m,b))),toBytes:a=>c?i$(a,l):iZ(a,l),fromBytes:a=>{if(a.length!==l)throw Error("Field.fromBytes: expected "+l+" bytes, got "+a.length);return c?iY(a):iX(g1(a))},invertBatch:a=>ji(m,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(m)}function jl(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function jm(a){let b=jl(a);return b+Math.ceil(b/2)}let jn=BigInt(0),jo=BigInt(1);function jp(a,b){let c=b.negate();return a?c:b}function jq(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function jr(a,b){jq(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:i2(a),maxNumber:e,shiftBy:BigInt(a)}}function js(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=jo);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let jt=new WeakMap,ju=new WeakMap;function jv(a){return ju.get(a)||1}function jw(a){if(a!==jn)throw Error("invalid wNAF")}function jx(a,b){if(!b)return jk(a);if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return i3(b,jh.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8);let jy=BigInt(0),jz=BigInt(1),jA=BigInt(2);BigInt(0);let jB=BigInt(1),jC=BigInt(2),jD=BigInt(3),jE=BigInt(5),jF=BigInt(8),jG={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:jF,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},jH=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(i3(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||g8,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?jA**BigInt(254):jA**BigInt(447),n=m+(g?BigInt(8)*jA**BigInt(251)-jz:BigInt(4)*jA**BigInt(445)-jz)+jz,o=a=>jc(a,b),p=i$(o(k),j);function q(a,c){let f,h=function(a,c){i1("u",a,jy,b),i1("scalar",c,m,n);let d=jz,f=jy,g=a,h=jz,j=jy;for(let b=BigInt(i-1);b>=jy;b--){let e=c>>b&jz;j^=e,({x_2:d,x_3:g}=s(j,d,g)),({x_2:f,x_3:h}=s(j,f,h)),j=e;let i=d+f,k=o(i*i),m=d-f,n=o(m*m),p=k-n,q=g+h,r=o((g-h)*i),t=o(q*m),u=r+t,v=r-t;g=o(u*u),h=o(a*o(v*v)),d=o(k*n),f=o(p*(k+o(l*p)))}return{x_2:d,x_3:g}=s(j,d,g),{x_2:f,x_3:h}=s(j,f,h),o(d*e(f))}((f=i_("u coordinate",c,j),g&&(f[31]&=127),o(iY(f))),iY(d(i_("scalar",a,j))));if(h===jy)throw Error("invalid private or public key received");return i$(o(h),j)}function r(a){return q(a,p)}function s(a,b,c){let d=o(a*(b-c));return{x_2:b=o(b-d),x_3:c=o(c+d)}}return{scalarMult:q,scalarMultBase:r,getSharedSecret:(a,b)=>q(a,b),getPublicKey:a=>r(a),utils:{randomPrivateKey:()=>h(j)},GuBytes:p.slice()}}({P:i=jG.p,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,{pow_p_5_8:r,b2:s}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),h=jd(g=a*a%(f=jG.p)*a%f,jC,f)*g%f,j=jd(h,jB,f)*a%f,k=jd(j,jE,f)*j%f,l=jd(k,b,f)*k%f,m=jd(l,c,f)*l%f,n=jd(m,d,f)*m%f,o=jd(n,e,f)*n%f,p=jd(o,e,f)*n%f,q=jd(p,b,f)*k%f,{pow_p_5_8:jd(q,jC,f)*a%f,b2:g});return jc(jd(r,jD,i)*s,i)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}});function jI(a){void 0!==a.lowS&&iV("lowS",a.lowS),void 0!==a.prehash&&iV("prehash",a.prehash)}let jJ={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=jJ;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=iW(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?iW(e.length/2|128):"";return iW(a)+f+e+b},decode(a,b){let{Err:c}=jJ,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=jJ;if(a<jK)throw new b("integer: negative integers are not allowed");let c=iW(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=jJ;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return iX(g1(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=jJ,e=i_("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=jJ,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},jK=BigInt(0),jL=BigInt(1),jM=BigInt(2),jN=BigInt(3),jO=BigInt(4);function jP(a,b,c){let{BYTES:d}=a;return function(e){let f;if("bigint"==typeof e)f=e;else{let c=i_("private key",e);if(b){if(!b.includes(2*c.length))throw Error("invalid private key");let a=new Uint8Array(d);a.set(c,a.length-c.length),c=a}try{f=a.fromBytes(c)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof e}`)}}if(c&&(f=a.create(f)),!a.isValidNot0(f))throw Error("invalid private key: out of range [1..N-1]");return f}}function jQ(a){return Uint8Array.of(a?2:3)}function jR(a,b){let c=b=>(function(a){let{CURVE:b,curveOpts:c,ecdsaOpts:d}=function(a){let b,c,{CURVE:d,curveOpts:e}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c={Fp:a.Fp,Fn:jk(b.n,a.nBitLength),allowedPrivateKeyLengths:a.allowedPrivateKeyLengths,allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,wrapPrivateKey:a.wrapPrivateKey,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:c});return{CURVE:d,curveOpts:e,ecdsaOpts:{hash:a.hash,hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN}}}(a),e=function(a,b,c={}){i3(b,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=b.randomBytes||g8,e=b.hmac||((a,...c)=>iQ(b.hash,a,g5(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g;function j(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..CURVE.n`)}class k{constructor(a,b,c){j("r",a),j("s",b),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){let b=g.BYTES,c=i_("compactSignature",a,2*b);return new k(g.fromBytes(c.subarray(0,b)),g.fromBytes(c.subarray(b,2*b)))}static fromDER(a){let{r:b,s:c}=jJ.toSig(i_("DER",a));return new k(b,c)}assertValidity(){}addRecoveryBit(a){return new k(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*jM<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromHex(g5(jQ((1&i)==0),k)),m=g.inv(j),n=o(i_("msgHash",b)),p=g.create(-n*m),q=g.create(e*m),r=a.BASE.multiplyUnsafe(p).add(l.multiplyUnsafe(q));if(r.is0())throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>h>>jL}normalizeS(){return this.hasHighS()?new k(this.r,g.neg(this.s),this.recovery):this}toBytes(a){if("compact"===a)return g5(g.toBytes(this.r),g.toBytes(this.s));if("der"===a)return g3(jJ.hexFromSig(this));throw Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return g1(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return g1(this.toBytes("compact"))}}let l=jP(g,c.allowedPrivateKeyLengths,c.wrapPrivateKey);function m(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let d=i_("key",b).length,e=f.BYTES,h=e+1;if(!(c.allowedPrivateKeyLengths||g.BYTES===h))return d===h||d===2*e+1}let n=b.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=iX(g1(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},o=b.bits2int_modN||function(a){return g.create(n(a))},p=i2(i);function q(a){return i1("num < 2^"+i,a,jK,p),g.toBytes(a)}let r={lowS:b.lowS,prehash:!1},s={lowS:b.lowS,prehash:!1};return a.BASE.precompute(8),Object.freeze({getPublicKey:function(b,c=!0){return a.fromPrivateKey(b).toBytes(c)},getSharedSecret:function(b,c,d=!0){if(!0===m(b))throw Error("first arg must be private key");if(!1===m(c))throw Error("second arg must be public key");return a.fromHex(c).multiply(l(b)).toBytes(d)},sign:function(c,i,j=r){let{seed:m,k2sig:p}=function(c,e,i=r){if(["recovered","canonical"].some(a=>a in i))throw Error("sign() legacy options not supported");let{hash:j}=b,{lowS:m,prehash:p,extraEntropy:s}=i;null==m&&(m=!0),c=i_("msgHash",c),jI(i),p&&(c=i_("prehashed msgHash",j(c)));let t=o(c),u=l(e),v=[q(u),q(t)];if(null!=s&&!1!==s){let a=!0===s?d(f.BYTES):s;v.push(i_("extraEntropy",a))}return{seed:g5(...v),k2sig:function(b){var c;let d=n(b);if(!g.isValidNot0(d))return;let e=g.inv(d),f=a.BASE.multiply(d).toAffine(),i=g.create(f.x);if(i===jK)return;let j=g.create(e*g.create(t+i*u));if(j===jK)return;let l=2*(f.x!==i)|Number(f.y&jL),o=j;return m&&j>h>>jL&&(o=(c=j)>h>>jL?g.neg(c):c,l^=1),new k(i,o,l)}}}(c,i,j);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return g5(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.hash.outputLen,g.BYTES,e)(m,p)},verify:function(c,d,e,f=s){let h,i;d=i_("msgHash",d),e=i_("publicKey",e),jI(f);let{lowS:j,prehash:l,format:m}=f;if("strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&!["compact","der","js"].includes(m))throw Error('format must be "compact", "der" or "js"');let n="string"==typeof c||gN(c),p=!n&&!m&&"object"==typeof c&&null!==c&&"bigint"==typeof c.r&&"bigint"==typeof c.s;if(!n&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p)if(void 0===m||"js"===m)h=new k(c.r,c.s);else throw Error("invalid format");if(n){try{"compact"!==m&&(h=k.fromDER(c))}catch(a){if(!(a instanceof jJ.Err))throw a}h||"der"===m||(h=k.fromCompact(c))}i=a.fromHex(e)}catch{return!1}if(!h||j&&h.hasHighS())return!1;l&&(d=b.hash(d));let{r:q,s:r}=h,t=o(d),u=g.inv(r),v=g.create(t*u),w=g.create(q*u),x=a.BASE.multiplyUnsafe(v).add(i.multiplyUnsafe(w));return!x.is0()&&g.create(x.x)===q},utils:{isValidPrivateKey(a){try{return l(a),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>(function(a,b,c=!1){let d=a.length,e=jl(b),f=jm(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=jc(c?iY(a):iX(g1(a)),b-i6)+i6;return c?i$(g,e):iZ(g,e)})(d(jm(h)),h),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},Point:a,Signature:k})}(function(a,b={}){var c,d,e;let{Fp:f,Fn:g}=function(a,b,c={}){if(!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>jn))throw Error(`CURVE.${a} must be positive bigint`)}let d=jx(b.p,c.Fp),e=jx(b.n,c.Fn);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!d.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{Fp:d,Fn:e}}("weierstrass",a,b),{h:h,n:i}=a;i3(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:j}=b;if(j&&(!f.is0(a.a)||"bigint"!=typeof j.beta||"function"!=typeof j.splitScalar))throw Error('invalid endo: expected "beta": bigint and "splitScalar": function');function k(){if(!f.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:d,y:e}=b.toAffine(),g=f.toBytes(d);return(iV("isCompressed",c),c)?(k(),g5(jQ(!f.isOdd(e)),g)):g5(Uint8Array.of(4),g,f.toBytes(e))},m=b.fromBytes||function(a){gP(a);let b=f.BYTES,c=b+1,d=2*b+1,e=a.length,g=a[0],h=a.subarray(1);if(e===c&&(2===g||3===g)){let a,b=f.fromBytes(h);if(!f.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=f.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&g)==1!==f.isOdd(a)&&(a=f.neg(a)),{x:b,y:a}}if(e===d&&4===g){let a=f.fromBytes(h.subarray(0*b,+b)),c=f.fromBytes(h.subarray(+b,2*b));if(!o(a,c))throw Error("bad point: is not on curve");return{x:a,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${c} or uncompressed=${d}`)},n=(c=a.a,d=a.b,function(a){let b=f.sqr(a),e=f.mul(b,a);return f.add(f.add(e,f.mul(a,c)),d)});function o(a,b){let c=f.sqr(b),d=n(a);return f.eql(c,d)}if(!o(a.Gx,a.Gy))throw Error("bad curve params: generator point");let p=f.mul(f.pow(a.a,jN),jO),q=f.mul(f.sqr(a.b),BigInt(27));if(f.is0(f.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!f.isValid(b)||c&&f.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof w))throw Error("ProjectivePoint expected")}let t=i4((a,b)=>{let{px:c,py:d,pz:e}=a;if(f.eql(e,f.ONE))return{x:c,y:d};let g=a.is0();null==b&&(b=g?f.ONE:f.inv(e));let h=f.mul(c,b),i=f.mul(d,b),j=f.mul(e,b);if(g)return{x:f.ZERO,y:f.ZERO};if(!f.eql(j,f.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),u=i4(a=>{if(a.is0()){if(b.allowInfinityPoint&&!f.is0(a.py))return;throw Error("bad point: ZERO")}let{x:c,y:d}=a.toAffine();if(!f.isValid(c)||!f.isValid(d))throw Error("bad point: x or y not field elements");if(!o(c,d))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function v(a,b,c,d,e){return c=new w(f.mul(c.px,a),c.py,c.pz),b=jp(d,b),c=jp(e,c),b.add(c)}class w{constructor(a,b,c){this.px=r("x",a),this.py=r("y",b,!0),this.pz=r("z",c),Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!f.isValid(b)||!f.isValid(c))throw Error("invalid affine point");if(a instanceof w)throw Error("projective point not allowed");return f.is0(b)&&f.is0(c)?w.ZERO:new w(b,c,f.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b,c;return b=a=>a.pz,c=ji(w.Fp,a.map(b)),a.map((a,b)=>a.toAffine(c[b])).map(w.fromAffine)}static fromBytes(a){return gP(a),w.fromHex(a)}static fromHex(a){let b=w.fromAffine(m(i_("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){let c=jP(g,b.allowedPrivateKeyLengths,b.wrapPrivateKey);return w.BASE.multiply(c(a))}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>iT;a>>=iU,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=i2(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(w,g,a,b)}precompute(a=8,b=!0){return y.setWindowSize(this,a),b||this.multiply(jN),this}_setWindowSize(a){this.precompute(a)}assertValidity(){u(this)}hasEvenY(){let{y:a}=this.toAffine();if(!f.isOdd)throw Error("Field doesn't support isOdd");return!f.isOdd(a)}equals(a){s(a);let{px:b,py:c,pz:d}=this,{px:e,py:g,pz:h}=a,i=f.eql(f.mul(b,h),f.mul(e,d)),j=f.eql(f.mul(c,h),f.mul(g,d));return i&&j}negate(){return new w(this.px,f.neg(this.py),this.pz)}double(){let{a:b,b:c}=a,d=f.mul(c,jN),{px:e,py:g,pz:h}=this,i=f.ZERO,j=f.ZERO,k=f.ZERO,l=f.mul(e,e),m=f.mul(g,g),n=f.mul(h,h),o=f.mul(e,g);return o=f.add(o,o),k=f.mul(e,h),k=f.add(k,k),i=f.mul(b,k),j=f.mul(d,n),j=f.add(i,j),i=f.sub(m,j),j=f.add(m,j),j=f.mul(i,j),i=f.mul(o,i),k=f.mul(d,k),n=f.mul(b,n),o=f.sub(l,n),o=f.mul(b,o),o=f.add(o,k),k=f.add(l,l),l=f.add(k,l),l=f.add(l,n),l=f.mul(l,o),j=f.add(j,l),n=f.mul(g,h),n=f.add(n,n),l=f.mul(n,o),i=f.sub(i,l),k=f.mul(n,m),k=f.add(k,k),new w(i,j,k=f.add(k,k))}add(b){s(b);let{px:c,py:d,pz:e}=this,{px:g,py:h,pz:i}=b,j=f.ZERO,k=f.ZERO,l=f.ZERO,m=a.a,n=f.mul(a.b,jN),o=f.mul(c,g),p=f.mul(d,h),q=f.mul(e,i),r=f.add(c,d),t=f.add(g,h);r=f.mul(r,t),t=f.add(o,p),r=f.sub(r,t),t=f.add(c,e);let u=f.add(g,i);return t=f.mul(t,u),u=f.add(o,q),t=f.sub(t,u),u=f.add(d,e),j=f.add(h,i),u=f.mul(u,j),j=f.add(p,q),u=f.sub(u,j),l=f.mul(m,t),j=f.mul(n,q),l=f.add(j,l),j=f.sub(p,l),l=f.add(p,l),k=f.mul(j,l),p=f.add(o,o),p=f.add(p,o),q=f.mul(m,q),t=f.mul(n,t),p=f.add(p,q),q=f.sub(o,q),q=f.mul(m,q),t=f.add(t,q),o=f.mul(p,t),k=f.add(k,o),o=f.mul(u,t),j=f.mul(r,j),j=f.sub(j,o),o=f.mul(r,p),l=f.mul(u,l),new w(j,k,l=f.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(w.ZERO)}multiply(a){let c,d,{endo:e}=b;if(!g.isValidNot0(a))throw Error("invalid scalar: out of range");let f=a=>y.wNAFCached(this,a,w.normalizeZ);if(e){let{k1neg:b,k1:g,k2neg:h,k2:i}=e.splitScalar(a),{p:j,f:k}=f(g),{p:l,f:m}=f(i);d=k.add(m),c=v(e.beta,j,l,b,h)}else{let{p:b,f:e}=f(a);c=b,d=e}return w.normalizeZ([c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!g.isValid(a))throw Error("invalid scalar: out of range");if(a===jK||this.is0())return w.ZERO;if(a===jL)return this;if(y.hasPrecomputes(this))return this.multiply(a);if(!c)return y.wNAFCachedUnsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=c.splitScalar(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>jn||d>jn;)c&jo&&(f=f.add(e)),d&jo&&(g=g.add(e)),e=e.double(),c>>=jo,d>>=jo;return{p1:f,p2:g}}(w,this,d,f);return v(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return t(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return h===jL||(a?a(w,this):y.wNAFCachedUnsafe(this,i).is0())}clearCofactor(){let{clearCofactor:a}=b;return h===jL?this:a?a(w,this):this.multiplyUnsafe(h)}toBytes(a=!0){return iV("isCompressed",a),this.assertValidity(),l(w,this,a)}toRawBytes(a=!0){return this.toBytes(a)}toHex(a=!0){return g1(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}w.BASE=new w(a.Gx,a.Gy,f.ONE),w.ZERO=new w(f.ZERO,f.ONE,f.ZERO),w.Fp=f,w.Fn=g;let x=g.BITS,y=(e=b.endo?Math.ceil(x/2):x,{constTimeNegate:jp,hasPrecomputes:a=>1!==jv(a),unsafeLadder(a,b,c=w.ZERO){let d=a;for(;b>jn;)b&jo&&(c=c.add(d)),d=d.double(),b>>=jo;return c},precomputeWindow(a,b){let{windows:c,windowSize:d}=jr(b,e),f=[],g=a,h=g;for(let a=0;a<c;a++){h=g,f.push(h);for(let a=1;a<d;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,b,c){let d=w.ZERO,f=w.BASE,g=jr(a,e);for(let a=0;a<g.windows;a++){let{nextN:e,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=js(c,a,g);c=e,i?f=f.add(jp(k,b[l])):d=d.add(jp(j,b[h]))}return jw(c),{p:d,f:f}},wNAFUnsafe(a,b,c,d=w.ZERO){let f=jr(a,e);for(let a=0;a<f.windows&&c!==jn;a++){let{nextN:e,offset:g,isZero:h,isNeg:i}=js(c,a,f);if(c=e,!h){let a=b[g];d=d.add(i?a.negate():a)}}return jw(c),d},getPrecomputes(a,b,c){let d=jt.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),jt.set(b,d))),d},wNAFCached(a,b,c){let d=jv(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=jv(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,b){jq(b,e),ju.set(a,b),jt.delete(a)}});return w}(b,c),d,c);return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:a})})({...a,hash:b});return{...c(b),create:c}}let jS={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},jT={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},jU={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},jV=jk(jS.p),jW=jk(jT.p),jX=jk(jU.p),jY=jR({...jS,Fp:jV,lowS:!1},hF);jR({...jT,Fp:jW,lowS:!1},hH),jR({...jU,Fp:jX,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},hG);let jZ="base10",j$="base16",j_="base64pad",j0="base64url",j1="utf8";function j2(){let a=jH.utils.randomPrivateKey(),b=jH.getPublicKey(a);return{privateKey:fK(a,j$),publicKey:fK(b,j$)}}function j3(){return fK(g8(32),j$)}function j4(a,b){var c,d;let e=jH.getSharedSecret(fJ(a,j$),fJ(b,j$));return fK((c=void 0,function(a,b,c,d=32){gQ(a),gO(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=iS);let g=new Uint8Array(f*e),h=iQ.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)iR[0]=a+1,i.update(0===a?iS:j).update(c).update(iR).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),gU(j,iR),g.slice(0,d)}(hF,(d=void 0,gQ(hF),void 0===d&&(d=new Uint8Array(hF.outputLen)),iQ(hF,g4(d),g4(e))),c,32)),j$)}function j5(a){return fK(hF(fJ(a,j$)),j$)}function j6(a){return fK(hF(fJ(a,j1)),j$)}function j7(a){return Number(fK(a,jZ))}function j8(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function j9(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function ka(a){var b;let c=(b="u">typeof a.type?a.type:0,fJ(`${b}`,jZ));if(1===j7(c)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let d="u">typeof a.senderPublicKey?fJ(a.senderPublicKey,j$):void 0,e="u">typeof a.iv?fJ(a.iv,j$):g8(12),f=ke({type:c,sealed:iO(fJ(a.symKey,j$),e).encrypt(fJ(a.message,j1)),iv:e,senderPublicKey:d});return a.encoding===j0?j8(f):f}function kb(a){let b=fJ(a.symKey,j$),{sealed:c,iv:d}=kf({encoded:a.encoded,encoding:a.encoding}),e=iO(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return fK(e,j1)}function kc(a,b){let c=fJ("2",jZ),d=g8(12),e=ke({type:c,sealed:fJ(a,j1),iv:d});return b===j0?j8(e):e}function kd(a,b){let{sealed:c}=kf({encoded:a,encoding:b});return fK(c,j1)}function ke(a){if(2===j7(a.type))return fK(ej([a.type,a.sealed]),j_);if(1===j7(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return fK(ej([a.type,a.senderPublicKey,a.iv,a.sealed]),j_)}return fK(ej([a.type,a.iv,a.sealed]),j_)}function kf(a){let b=fJ((a.encoding||j_)===j0?j9(a.encoded):a.encoded,j_),c=b.slice(0,1);if(1===j7(c)){let a=b.slice(1,33),d=b.slice(33,45);return{type:c,sealed:b.slice(45),iv:d,senderPublicKey:a}}if(2===j7(c))return{type:c,sealed:b.slice(1),iv:g8(12)};let d=b.slice(1,13);return{type:c,sealed:b.slice(13),iv:d}}function kg(a,b){let c=kf({encoded:a,encoding:b?.encoding});return kh({type:j7(c.type),senderPublicKey:"u">typeof c.senderPublicKey?fK(c.senderPublicKey,j$):void 0,receiverPublicKey:b?.receiverPublicKey})}function kh(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function ki(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function kj(a){return 2===a.type}function kk(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(j9(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=hF(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),ej([new Uint8Array([4]),c,d]));if(!jY.verify(ej([i,j]),k,l))throw Error("Invalid signature");return cJ(a).payload}function kl(a){return a?.relay||{protocol:"irn"}}function km(a){let b=fL[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}function kn(a){var b;if(!a.includes("wc:")){let b=gs(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=new URLSearchParams("u">typeof d?a.substring(d):""),h={};g.forEach((a,b)=>{h[b]=a});let i="string"==typeof h.methods?h.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:h.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(h),methods:i,expiryTimestamp:h.expiryTimestamp?parseInt(h.expiryTimestamp,10):void 0}}function ko(a){let b=new URLSearchParams,c=function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay);Object.keys(c).sort().forEach(a=>{b.set(a,c[a])}),b.set("symKey",a.symKey),a.expiryTimestamp&&b.set("expiryTimestamp",a.expiryTimestamp.toString()),a.methods&&b.set("methods",a.methods.join(","));let d=b.toString();return`${a.protocol}:${a.topic}@${a.version}?${d}`}function kp(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var kq=Object.defineProperty,kr=Object.defineProperties,ks=Object.getOwnPropertyDescriptors,kt=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,kw=(a,b,c)=>b in a?kq(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kx=(a,b)=>{for(var c in b||(b={}))ku.call(b,c)&&kw(a,c,b[c]);if(kt)for(var c of kt(b))kv.call(b,c)&&kw(a,c,b[c]);return a},ky=(a,b)=>kr(a,ks(b));function kz(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function kA(a){return a.includes(":")}function kB(a){return kA(a)?a.split(":")[0]:a}function kC(a){var b,c,d;let e={};if(!kK(a))return e;for(let[f,g]of Object.entries(a)){let a=kA(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=kB(f);e[j]=ky(kx({},e[j]),{chains:gm(a,null==(b=e[j])?void 0:b.chains),methods:gm(h,null==(c=e[j])?void 0:c.methods),events:gm(i,null==(d=e[j])?void 0:d.events)})}return e}function kD(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=gm(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}function kE(a,b){var c,d,e,f,g,h;let i=kC(a),j=kC(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:gm(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:gm(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:gm(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}let kF={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},kG={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function kH(a,b){let{message:c,code:d}=kG[a];return{message:b?`${c} ${b}`:c,code:d}}function kI(a,b){let{message:c,code:d}=kF[a];return{message:b?`${c} ${b}`:c,code:d}}function kJ(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function kK(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function kL(a){return typeof a>"u"}function kM(a,b){return!!(b&&kL(a))||"string"==typeof a&&!!a.trim().length}function kN(a,b){return!!(b&&kL(a))||"number"==typeof a&&!isNaN(a)}function kO(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!ga(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=kz(d),i=c[b];ga(fO(b,i),h)&&ga(i.methods,e)&&ga(i.events,g)||(f=!1)}),f)}function kP(a){return!!(kM(a,!1)&&a.includes(":"))&&2===a.split(":").length}function kQ(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(kM(a,!1)){if(b(a))return!0;let c=gs(a);return b(c)}}catch{}return!1}function kR(a){var b;return null==(b=a?.proposer)?void 0:b.publicKey}function kS(a){return a?.topic}function kT(a,b){let c=null;return kM(a?.publicKey,!1)||(c=kH("MISSING_OR_INVALID",`${b} controller public key should be a string`)),c}function kU(a){let b=!0;return kJ(a)?a.length&&(b=a.every(a=>kM(a,!1))):b=!1,b}function kV(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,kU(a?.methods)?kU(a?.events)||(e=kI("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=kI("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function kW(a,b,c){let d=null;if(a&&kK(a)){let e,f=kV(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=fO(a,d),g=`${b} ${c}`,h=null,kJ(f)&&f.length?f.forEach(a=>{h||kP(a)||(h=kI("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):kP(a)||(h=kI("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=kH("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}function kX(a,b){let c=null;if(a&&kK(a)){let d,e=kV(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,kJ(c)?c.forEach(a=>{f||function(a){if(kM(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&kP(a)}}return!1}(a)||(f=kI("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=kI("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=kH("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function kY(a){return kM(a.protocol,!0)}function kZ(a,b){let c=!1;return b&&!a?c=!0:a&&kJ(a)&&a.length&&a.forEach(a=>{c=kY(a)}),c}function k$(a){return"number"==typeof a}function k_(a){return"u">typeof a}function k0(a){return!(!a||"object"!=typeof a||!a.code||!kN(a.code,!1)||!a.message||!kM(a.message,!1))}function k1(a){return!(kL(a)||!kM(a.method,!1))}function k2(a){return!(kL(a)||kL(a.result)&&kL(a.error)||!kN(a.id,!1)||!kM(a.jsonrpc,!1))}function k3(a){return!(kL(a)||!kM(a.name,!1))}function k4(a,b){let c;return!(!kP(b)||!(c=[],Object.values(a).forEach(a=>{c.push(...kz(a.accounts))}),c).includes(b))}function k5(a,b,c){let d;return!!kM(c,!1)&&(d=[],Object.values(a).forEach(a=>{kz(a.accounts).includes(b)&&d.push(...a.methods)}),d).includes(c)}function k6(a,b,c){let d;return!!kM(c,!1)&&(d=[],Object.values(a).forEach(a=>{kz(a.accounts).includes(b)&&d.push(...a.events)}),d).includes(c)}function k7(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=kz(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=k8(Object.keys(a)),n=k8(Object.keys(b)),o=m.filter(a=>!n.includes(a));return o.length&&(h=kH("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${o.toString()}
      Received: ${Object.keys(b).toString()}`)),ga(k,l)||(h=kH("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=kz(b[a].accounts);d.includes(a)||(h=kH("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(ga(i[a].methods,j[a].methods)?ga(i[a].events,j[a].events)||(h=kH("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=kH("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function k8(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function k9(a,b){return kN(a,!1)&&a<=b.max&&a>=b.min}function la(){let a=f4();return new Promise(b=>{switch(a){case f$:b(f3()&&navigator?.onLine);break;case fY:b(lb());break;default:b(!0)}})}async function lb(){if(f0()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}function lc(b){var c,d;switch(f4()){case f$:c=b,!f0()&&f3()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case fY:d=b,f0()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}}function ld(){var a;return!(f3()&&(0,cV.getDocument)())||(null==(a=(0,cV.getDocument)())?void 0:a.visibilityState)==="visible"}let le={};class lf{static get(a){return le[a]}static set(a,b){le[a]=b}static delete(a){delete le[a]}}function lg(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function lh(a){let b,c,d=Uint8Array.from(Buffer.from(a.signature,"hex")),e=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=lg(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,42===(g=dE.decode(e)[0])?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):lg(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),n=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(n.length+1),i,...n])}({publicKey:function(a){let b=dE.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(a.transaction.address),signature:d,payload:a.transaction});return b=lg(Buffer.from(e).toString("hex")),c=(0,fM.blake2b)(b,void 0,32),"0x"+Buffer.from(c).toString("hex")}a.s(["BASE16",()=>j$,"BASE64",()=>j_,"BASE64URL",()=>j0,"LimitedSet",()=>gu,"MemoryStore",()=>lf,"TYPE_1",()=>1,"TYPE_2",()=>2,"buildNamespacesFromAuth",()=>kD,"buildSignedExtrinsicHash",()=>lh,"calcExpiry",()=>gj,"createDelayedPromise",()=>gd,"createEncodedRecap",()=>ie,"createExpiringPromise",()=>ge,"decodeTypeByte",()=>j7,"decodeTypeTwoEnvelope",()=>kd,"decrypt",()=>kb,"deriveSymKey",()=>j4,"deserialize",()=>kf,"encodeTypeTwoEnvelope",()=>kc,"encrypt",()=>ka,"engineEvent",()=>gl,"extractSolanaTransactionId",()=>hV,"formatIdTarget",()=>gh,"formatMessage",()=>ia,"formatRelayRpcUrl",()=>f9,"formatTopicTarget",()=>gg,"formatUA",()=>f8,"formatUri",()=>ko,"generateKeyPair",()=>j2,"generateRandomBytes32",()=>j3,"getAlgorandTransactionId",()=>hY,"getAppId",()=>f5,"getAppMetadata",()=>f7,"getChainsFromRecap",()=>ii,"getDeepLink",()=>go,"getDidAddress",()=>h8,"getInternalError",()=>kH,"getLinkModeURL",()=>kp,"getMethodsFromRecap",()=>ih,"getNamespacedDidChainId",()=>h7,"getNearTransactionIdFromSignedTransaction",()=>hX,"getRecapFromResources",()=>ij,"getRelayProtocolApi",()=>km,"getRelayProtocolName",()=>kl,"getSdkError",()=>kI,"getSearchParamFromURL",()=>gp,"getSignDirectHash",()=>h$,"getSuiDigest",()=>hW,"handleDeeplinkRedirect",()=>gn,"hashKey",()=>j5,"hashMessage",()=>j6,"isAndroid",()=>f1,"isAppVisible",()=>ld,"isBrowser",()=>f3,"isCaipNamespace",()=>kA,"isConformingNamespaces",()=>k7,"isExpired",()=>gk,"isIos",()=>f2,"isNode",()=>f_,"isOnline",()=>la,"isProposalStruct",()=>kR,"isReactNative",()=>f0,"isSessionCompatible",()=>kO,"isSessionStruct",()=>kS,"isTestRun",()=>gr,"isTypeOneEnvelope",()=>ki,"isTypeTwoEnvelope",()=>kj,"isUndefined",()=>kL,"isValidArray",()=>kJ,"isValidController",()=>kT,"isValidErrorReason",()=>k0,"isValidEvent",()=>k3,"isValidId",()=>k$,"isValidNamespaces",()=>kX,"isValidNamespacesChainId",()=>k4,"isValidNamespacesEvent",()=>k6,"isValidNamespacesRequest",()=>k5,"isValidObject",()=>kK,"isValidParams",()=>k_,"isValidRelay",()=>kY,"isValidRelays",()=>kZ,"isValidRequest",()=>k1,"isValidRequestExpiry",()=>k9,"isValidRequiredNamespaces",()=>kW,"isValidResponse",()=>k2,"isValidString",()=>kM,"isValidUrl",()=>kQ,"mapToObj",()=>gb,"mergeArrays",()=>gm,"mergeEncodedRecaps",()=>ig,"mergeRequiredAndOptionalNamespaces",()=>kE,"objToMap",()=>gc,"parseChainId",()=>fN,"parseExpirerTarget",()=>gi,"parseNamespaceKey",()=>kB,"parseUri",()=>kn,"populateAppMetadata",()=>f6,"sleep",()=>gt,"subscribeToNetworkChange",()=>lc,"uuidv4",()=>gq,"validateDecoding",()=>kg,"validateEncoding",()=>kh,"validateSignedCacao",()=>h9,"verifyP256Jwt",()=>kk],636050);let li="INTERNAL_ERROR",lj="SERVER_ERROR",lk=[-32700,-32600,-32601,-32602,-32603],ll={PARSE_ERROR:{code:-32700,message:"Parse error"},INVALID_REQUEST:{code:-32600,message:"Invalid Request"},METHOD_NOT_FOUND:{code:-32601,message:"Method not found"},INVALID_PARAMS:{code:-32602,message:"Invalid params"},[li]:{code:-32603,message:"Internal error"},[lj]:{code:-32e3,message:"Server error"}};function lm(a){return lk.includes(a)}function ln(a){return Object.keys(ll).includes(a)?ll[a]:ll[lj]}function lo(a){let b=Object.values(ll).find(b=>b.code===a);return b||ll[lj]}function lp(a,b,c){return a.message.includes("getaddrinfo ENOTFOUND")||a.message.includes("connect ECONNREFUSED")?Error(`Unavailable ${c} RPC url at ${b}`):a}a.s(["getError",()=>ln,"getErrorByCode",()=>lo,"isReservedErrorCode",()=>lm,"parseConnectionError",()=>lp],141651);var lq=a.i(42289);function lr(a=3){return Date.now()*Math.pow(10,a)+Math.floor(Math.random()*Math.pow(10,a))}function ls(a=6){return BigInt(lr(a))}function lt(a,b,c){return{id:c||lr(),jsonrpc:"2.0",method:a,params:b}}function lu(a,b){return{id:a,jsonrpc:"2.0",result:b}}function lv(a,b,c){var d,e;return{id:a,jsonrpc:"2.0",error:(d=b,e=c,void 0===d?ln(li):("string"==typeof d&&(d=Object.assign(Object.assign({},ln(lj)),{message:d})),void 0!==e&&(d.data=e),lm(d.code)&&(d=lo(d.code)),d))}}lq.isNode,a.s(["formatJsonRpcError",()=>lv,"formatJsonRpcRequest",()=>lt,"formatJsonRpcResult",()=>lu,"getBigIntRpcId",()=>ls,"payloadId",()=>lr],499963);class lw{}class lx extends lw{constructor(){super()}}class ly extends lx{constructor(a){super()}}function lz(a,b){let c=function(a){let b=a.match(RegExp(/^\w+:/,"gi"));if(b&&b.length)return b[0]}(a);return void 0!==c&&new RegExp(b).test(c)}function lA(a){return lz(a,"^https?:")}function lB(a){return lz(a,"^wss?:")}function lC(a){return RegExp("wss?://localhost(:d{2,5})?").test(a)}function lD(a){return"object"==typeof a&&"id"in a&&"jsonrpc"in a&&"2.0"===a.jsonrpc}function lE(a){return lD(a)&&"method"in a}function lF(a){return lD(a)&&(lG(a)||lH(a))}function lG(a){return"result"in a}function lH(a){return"error"in a}a.s(["isHttpUrl",()=>lA,"isLocalhostUrl",()=>lC,"isWsUrl",()=>lB],667842),a.s([],258910);class lI extends ly{constructor(a){super(a),this.events=new m.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(a),this.connection.connected&&this.registerEventListeners()}async connect(a=this.connection){await this.open(a)}async disconnect(){await this.close()}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async request(a,b){return this.requestStrict(lt(a.method,a.params||[],a.id||ls().toString()),b)}async requestStrict(a,b){return new Promise(async(c,d)=>{if(!this.connection.connected)try{await this.open()}catch(a){d(a)}this.events.on(`${a.id}`,a=>{lH(a)?d(a.error):c(a.result)});try{await this.connection.send(a,b)}catch(a){d(a)}})}setConnection(a=this.connection){return a}onPayload(a){this.events.emit("payload",a),lF(a)?this.events.emit(`${a.id}`,a):this.events.emit("message",{type:a.method,data:a.params})}onClose(a){a&&3e3===a.code&&this.events.emit("error",Error(`WebSocket connection closed abnormally with code: ${a.code} ${a.reason?`(${a.reason})`:""}`)),this.events.emit("disconnect")}async open(a=this.connection){this.connection===a&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof a&&(await this.connection.open(a),a=this.connection),this.connection=this.setConnection(a),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",a=>this.onPayload(a)),this.connection.on("close",a=>this.onClose(a)),this.connection.on("error",a=>this.events.emit("error",a)),this.connection.on("register_error",a=>this.onClose()),this.hasRegisteredEventListeners=!0)}}a.s(["JsonRpcProvider",()=>lI],271137);let lJ=a=>a.split("?")[0],lK="u">typeof WebSocket?WebSocket:"u">typeof a.g.WebSocket?a.g.WebSocket:"u">typeof self&&"u">typeof self.WebSocket?self.WebSocket:a.r(674248);class lL{constructor(a){if(this.url=a,this.events=new m.EventEmitter,this.registering=!1,!lB(a))throw Error(`Provided URL is not compatible with WebSocket connection: ${a}`);this.url=a}get connected(){return"u">typeof this.socket}get connecting(){return this.registering}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async open(a=this.url){await this.register(a)}async close(){return new Promise((a,b)=>{typeof this.socket>"u"?b(Error("Connection already closed")):(this.socket.onclose=b=>{this.onClose(b),a()},this.socket.close())})}async send(a){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(K(a))}catch(b){this.onError(a.id,b)}}register(b=this.url){if(!lB(b))throw Error(`Provided URL is not compatible with WebSocket connection: ${b}`);if(this.registering){let a=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=a||this.events.listenerCount("open")>=a)&&this.events.setMaxListeners(a+1),new Promise((a,b)=>{this.events.once("register_error",a=>{this.resetMaxListeners(),b(a)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return b(Error("WebSocket connection is missing or invalid"));a(this.socket)})})}return this.url=b,this.registering=!0,new Promise((c,d)=>{let e=(0,lq.isReactNative)()?void 0:{rejectUnauthorized:!lC(b)},f=new lK(b,[],e);"u">typeof WebSocket||"u">typeof a.g.WebSocket||"u">typeof self&&"u">typeof self.WebSocket?f.onerror=a=>{d(this.emitError(a.error))}:f.on("error",a=>{d(this.emitError(a))}),f.onopen=()=>{this.onOpen(f),c(f)}})}onOpen(a){a.onmessage=a=>this.onPayload(a),a.onclose=a=>this.onClose(a),this.socket=a,this.registering=!1,this.events.emit("open")}onClose(a){this.socket=void 0,this.registering=!1,this.events.emit("close",a)}onPayload(a){if(typeof a.data>"u")return;let b="string"==typeof a.data?J(a.data):a.data;this.events.emit("payload",b)}onError(a,b){let c=this.parseError(b),d=lv(a,c.message||c.toString());this.events.emit("payload",d)}parseError(a,b=this.url){return lp(a,lJ(b),"WS")}resetMaxListeners(){this.events.getMaxListeners()>10&&this.events.setMaxListeners(10)}emitError(a){let b=this.parseError(Error(a?.message||`WebSocket connection failed for host: ${lJ(this.url)}`));return this.events.emit("register_error",b),b}}let lM="core",lN=`wc@2:${lM}:`,lO={database:":memory:"},lP="client_ed25519_seed",lQ=n.ONE_DAY,lR=n.SIX_HOURS,lS="wss://relay.walletconnect.org",lT="relayer_message",lU="relayer_message_ack",lV="relayer_connection_stalled",lW="relayer_publish",lX="payload",lY="connect",lZ="disconnect",l$="error",l_="2.21.8",l0="link_mode",l1="relay",l2="inbound",l3="WALLETCONNECT_LINK_MODE_APPS",l4="subscription_created",l5="subscription_deleted",l6=(n.THIRTY_DAYS,n.FIVE_SECONDS,n.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:n.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:n.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:n.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:n.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:n.ONE_DAY,prompt:!1,tag:0},res:{ttl:n.ONE_DAY,prompt:!1,tag:0}}}),l7="pairing_create",l8="pairing_delete",l9="history_created",ma="history_updated",mb="history_deleted",mc="expirer_created",md="expirer_deleted",me="expirer_expired",mf=(n.ONE_DAY,"https://verify.walletconnect.org"),mg=`${mf}/v3`,mh=["https://verify.walletconnect.com",mf],mi="malformed_pairing_uri",mj="session_approve_started";var mk=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let ml=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class mm{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class mn{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return mp(this,a)}}class mo{constructor(a){this.decoders=a}or(a){return mp(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let mp=(a,b)=>new mo({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class mq{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new mm(a,b,c),this.decoder=new mn(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let mr=({name:a,prefix:b,encode:c,decode:d})=>new mq(a,b,c,d),ms=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=mk(c,b);return mr({prefix:a,name:b,encode:d,decode:a=>ml(e(a))})},mt=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>mr({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var mu=Object.freeze({__proto__:null,identity:mr({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),mv=Object.freeze({__proto__:null,base2:mt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),mw=Object.freeze({__proto__:null,base8:mt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),mx=Object.freeze({__proto__:null,base10:ms({prefix:"9",name:"base10",alphabet:"0123456789"})}),my=Object.freeze({__proto__:null,base16:mt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:mt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),mz=Object.freeze({__proto__:null,base32:mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),mA=Object.freeze({__proto__:null,base36:ms({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:ms({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),mB=Object.freeze({__proto__:null,base58btc:ms({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:ms({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),mC=Object.freeze({__proto__:null,base64:mt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:mt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:mt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:mt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let mD=Array.from(""),mE=mD.reduce((a,b,c)=>(a[c]=b,a),[]),mF=mD.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var mG=Object.freeze({__proto__:null,base256emoji:mr({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=mE[b],"")},decode:function(a){let b=[];for(let c of a){let a=mF[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function mH(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,mH.bytes=c-d+1,b}var mI=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let mJ=(a,b,c=0)=>(mH(a,b,c),b),mK=(a,b)=>{let c=b.byteLength,d=mI(a),e=d+mI(c),f=new Uint8Array(e+c);return mJ(a,f,0),mJ(c,f,d),f.set(b,e),new mL(a,c,b,f)};class mL{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let mM=({name:a,code:b,encode:c})=>new mN(a,b,c);class mN{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?mK(this.code,b):b.then(a=>mK(this.code,a))}throw Error("Unknown type, must be binary type")}}let mO=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var mP=Object.freeze({__proto__:null,sha256:mM({name:"sha2-256",code:18,encode:mO("SHA-256")}),sha512:mM({name:"sha2-512",code:19,encode:mO("SHA-512")})}),mQ=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:ml,digest:a=>mK(0,ml(a))}});new TextEncoder,new TextDecoder;let mR={...mu,...mv,...mw,...mx,...my,...mz,...mA,...mB,...mC,...mG};function mS(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function mT(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...mP,...mQ});let mU=mT("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),mV=mT("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?mS(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),mW={utf8:mU,"utf-8":mU,hex:mR.base16,latin1:mV,ascii:mV,binary:mV,...mR};var mX=Object.defineProperty,mY=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?mX(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class mZ{constructor(a,b){this.core=a,this.logger=b,mY(this,"keychain",new Map),mY(this,"name","keychain"),mY(this,"version","0.3"),mY(this,"initialized",!1),mY(this,"storagePrefix",lN),mY(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),mY(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),mY(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),mY(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=kH("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),mY(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=ai(b,this.name)}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,gb(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?gc(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var m$=Object.defineProperty,m_=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?m$(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class m0{constructor(a,b,c){this.core=a,this.logger=b,m_(this,"name","crypto"),m_(this,"keychain"),m_(this,"randomSessionIdentifier",j3()),m_(this,"initialized",!1),m_(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),m_(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),m_(this,"getClientId",async()=>(this.isInitialized(),cI(cK(await this.getClientSeed()).publicKey))),m_(this,"generateKeyPair",()=>{this.isInitialized();let a=j2();return this.setPrivateKey(a.publicKey,a.privateKey)}),m_(this,"signJWT",async a=>{this.isInitialized();let b=cK(await this.getClientSeed()),c=this.randomSessionIdentifier;return await cL(c,a,lQ,b)}),m_(this,"generateSharedKey",(a,b,c)=>{this.isInitialized();let d=j4(this.getPrivateKey(a),b);return this.setSymKey(d,c)}),m_(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||j5(a);return await this.keychain.set(c,a),c}),m_(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),m_(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),m_(this,"encode",async(a,b,c)=>{this.isInitialized();let d=kh(c),e=K(b);if(kj(d))return kc(e,c?.encoding);if(ki(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let f=this.getSymKey(a),{type:g,senderPublicKey:h}=d;return ka({type:g,symKey:f,message:e,senderPublicKey:h,encoding:c?.encoding})}),m_(this,"decode",async(a,b,c)=>{this.isInitialized();let d=kg(b,c);if(kj(d))return J(kd(b,c?.encoding));if(ki(d)){let b=d.receiverPublicKey,c=d.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=kb({symKey:d,encoded:b,encoding:c?.encoding});return J(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),m_(this,"getPayloadType",(a,b=j_)=>j7(kf({encoded:a,encoding:b}).type)),m_(this,"getPayloadSenderPublicKey",(a,b=j_)=>{let c=kf({encoded:a,encoding:b});return c.senderPublicKey?fK(c.senderPublicKey,j$):void 0}),this.core=a,this.logger=ai(b,this.name),this.keychain=c||new mZ(this.core,this.logger)}get context(){return ah(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(lP)}catch{a=j3(),await this.keychain.set(lP,a)}return function(a,b="utf8"){let c=mW[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?mS(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var m1=Object.defineProperty,m2=Object.defineProperties,m3=Object.getOwnPropertyDescriptors,m4=Object.getOwnPropertySymbols,m5=Object.prototype.hasOwnProperty,m6=Object.prototype.propertyIsEnumerable,m7=(a,b,c)=>b in a?m1(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,m8=(a,b,c)=>m7(a,"symbol"!=typeof b?b+"":b,c);class m9 extends aq{constructor(a,b){super(a,b),this.logger=a,this.core=b,m8(this,"messages",new Map),m8(this,"messagesWithoutClientAck",new Map),m8(this,"name","messages"),m8(this,"version","0.3"),m8(this,"initialized",!1),m8(this,"storagePrefix",lN),m8(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),m8(this,"set",async(a,b,c)=>{this.isInitialized();let d=j6(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===l2){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,m2(((a,b)=>{for(var c in b||(b={}))m5.call(b,c)&&m7(a,c,b[c]);if(m4)for(var c of m4(b))m6.call(b,c)&&m7(a,c,b[c]);return a})({},c),m3({[d]:b})))}return await this.persist(),d}),m8(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),m8(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),m8(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[j6(b)])),m8(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=j6(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),m8(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=ai(a,this.name),this.core=b}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,gb(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,gb(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?gc(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?gc(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var na=Object.defineProperty,nb=Object.defineProperties,nc=Object.getOwnPropertyDescriptors,nd=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,nf=Object.prototype.propertyIsEnumerable,ng=(a,b,c)=>b in a?na(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nh=(a,b)=>{for(var c in b||(b={}))ne.call(b,c)&&ng(a,c,b[c]);if(nd)for(var c of nd(b))nf.call(b,c)&&ng(a,c,b[c]);return a},ni=(a,b,c)=>ng(a,"symbol"!=typeof b?b+"":b,c);class nj extends ar{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,ni(this,"events",new m.EventEmitter),ni(this,"name","publisher"),ni(this,"queue",new Map),ni(this,"publishTimeout",(0,n.toMiliseconds)(n.ONE_MINUTE)),ni(this,"initialPublishTimeout",(0,n.toMiliseconds)(15*n.ONE_SECOND)),ni(this,"needsTransportRestart",!1),ni(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||lR,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||ls().toString(),m=km(kl().protocol),n={id:l,method:c?.publishMethod||m.publish,params:nh({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf&&{tvf:c.tvf})},o=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{kL(null==(d=n.params)?void 0:d.prompt)&&(null==(e=n.params)||delete e.prompt),kL(null==(f=n.params)?void 0:f.tag)&&(null==(g=n.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=n.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(lW,b),a())};this.relayer.events.on(lW,b);let d=ge(new Promise((a,b)=>{this.rpcPublish(n,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(lW,b)}catch(a){this.queue.set(l,{request:n,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await ge(h,this.publishTimeout,o)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),ni(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:o=n.FIVE_MINUTES}=h,p=h.id||ls().toString(),q=km(kl().protocol),r=k||q.publish,s={id:p,method:r,params:nh(nb(nh({},g),nc({ttl:o,prompt:l,tag:m,attestation:i})),j)},t=`Failed to publish custom payload, please try again. id:${p} tag:${m}`;try{kL(null==(b=s.params)?void 0:b.prompt)&&(null==(c=s.params)||delete c.prompt),kL(null==(d=s.params)?void 0:d.tag)&&(null==(e=s.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=s.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(lW,b),a())};this.relayer.events.on(lW,b);let c=ge(new Promise((a,b)=>{this.rpcPublish(s,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${r} id:${p} tag:${m}`);try{await c,this.events.removeListener(lW,b)}catch(a){this.queue.set(p,{request:s,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,payload:g,opts:h}}),await ge(a,this.publishTimeout,t)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(p)}}),ni(this,"on",(a,b)=>{this.events.on(a,b)}),ni(this,"once",(a,b)=>{this.events.once(a,b)}),ni(this,"off",(a,b)=>{this.events.off(a,b)}),ni(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=ai(b,this.name),this.registerEventListeners()}get context(){return ah(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(lW,nh(nh({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,nb(nh({},a),nc({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(r,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(lV);return}this.checkQueue()}),this.relayer.on(lU,a=>{this.removeRequestFromQueue(a.id.toString())})}}var nk=Object.defineProperty,nl=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nk(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class nm{constructor(){nl(this,"map",new Map),nl(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),nl(this,"get",a=>this.map.get(a)||[]),nl(this,"exists",(a,b)=>this.get(a).includes(b)),nl(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),nl(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var nn=Object.defineProperty,no=Object.defineProperties,np=Object.getOwnPropertyDescriptors,nq=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,ns=Object.prototype.propertyIsEnumerable,nt=(a,b,c)=>b in a?nn(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nu=(a,b)=>{for(var c in b||(b={}))nr.call(b,c)&&nt(a,c,b[c]);if(nq)for(var c of nq(b))ns.call(b,c)&&nt(a,c,b[c]);return a},nv=(a,b,c)=>nt(a,"symbol"!=typeof b?b+"":b,c);class nw extends au{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,nv(this,"subscriptions",new Map),nv(this,"topicMap",new nm),nv(this,"events",new m.EventEmitter),nv(this,"name","subscription"),nv(this,"version","0.3"),nv(this,"pending",new Map),nv(this,"cached",[]),nv(this,"initialized",!1),nv(this,"storagePrefix",lN),nv(this,"subscribeTimeout",(0,n.toMiliseconds)(n.ONE_MINUTE)),nv(this,"initialSubscribeTimeout",(0,n.toMiliseconds)(15*n.ONE_SECOND)),nv(this,"clientId"),nv(this,"batchSubscribeTopicsLimit",500),nv(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),nv(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=kl(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),nv(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),nv(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),nv(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),nv(this,"on",(a,b)=>{this.events.on(a,b)}),nv(this,"once",(a,b)=>{this.events.once(a,b)}),nv(this,"off",(a,b)=>{this.events.off(a,b)}),nv(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),nv(this,"start",async()=>{await this.onConnect()}),nv(this,"stop",async()=>{await this.onDisconnect()}),nv(this,"restart",async()=>{await this.restore(),await this.onRestart()}),nv(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),nv(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(r,async()=>{await this.checkPending()}),this.events.on(l4,async a=>{this.logger.info(`Emitting ${l4}`),this.logger.debug({type:"event",event:l4,data:a}),await this.persist()}),this.events.on(l5,async a=>{this.logger.info(`Emitting ${l5}`),this.logger.debug({type:"event",event:l5,data:a}),await this.persist()})}),this.relayer=a,this.logger=ai(b,this.name),this.clientId=""}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=kl(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=kI("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==l1||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:km(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===l0)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,n.toMiliseconds)(n.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(l4,c),b(d.id))};this.events.on(l4,c);try{let d=await ge(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(l4,c),b(d)}catch{}}),d=await ge(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(lV),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:km(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await ge(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(lV)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:km(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await ge(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(lV)}return b}rpcUnsubscribe(a,b,c){let d={method:km(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,no(nu({},b),np({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,nu({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,nu({},b)),this.topicMap.set(b.topic,a),this.events.emit(l4,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=kH("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(l5,no(nu({},c),np({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=kH("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>no(nu({},a),np({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let b=await this.rpcBatchFetchMessages(a);b&&b.messages&&(await gt((0,n.toMiliseconds)(n.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(b.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return j6(a+await this.getClientId())}}var nx=Object.defineProperty,ny=Object.getOwnPropertySymbols,nz=Object.prototype.hasOwnProperty,nA=Object.prototype.propertyIsEnumerable,nB=(a,b,c)=>b in a?nx(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nC=(a,b)=>{for(var c in b||(b={}))nz.call(b,c)&&nB(a,c,b[c]);if(ny)for(var c of ny(b))nA.call(b,c)&&nB(a,c,b[c]);return a},nD=(a,b,c)=>nB(a,"symbol"!=typeof b?b+"":b,c);class nE extends as{constructor(a){super(a),nD(this,"protocol","wc"),nD(this,"version",2),nD(this,"core"),nD(this,"logger"),nD(this,"events",new m.EventEmitter),nD(this,"provider"),nD(this,"messages"),nD(this,"subscriber"),nD(this,"publisher"),nD(this,"name","relayer"),nD(this,"transportExplicitlyClosed",!1),nD(this,"initialized",!1),nD(this,"connectionAttemptInProgress",!1),nD(this,"relayUrl"),nD(this,"projectId"),nD(this,"packageName"),nD(this,"bundleId"),nD(this,"hasExperiencedNetworkDisruption",!1),nD(this,"pingTimeout"),nD(this,"heartBeatTimeout",(0,n.toMiliseconds)(n.THIRTY_SECONDS+n.FIVE_SECONDS)),nD(this,"reconnectTimeout"),nD(this,"connectPromise"),nD(this,"reconnectInProgress",!1),nD(this,"requestsInFlight",[]),nD(this,"connectTimeout",(0,n.toMiliseconds)(15*n.ONE_SECOND)),nD(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||ls().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),nD(this,"resetPingTimeout",()=>{f_()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),nD(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),nD(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),nD(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),nD(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),nD(this,"registerProviderListeners",()=>{this.provider.on(lX,this.onPayloadHandler),this.provider.on(lY,this.onConnectHandler),this.provider.on(lZ,this.onDisconnectHandler),this.provider.on(l$,this.onProviderErrorHandler)}),this.core=a.core,this.logger="u">typeof a.logger&&"string"!=typeof a.logger?ai(a.logger,this.name):(0,ak.default)(ag({level:a.logger||"error"})),this.messages=new m9(this.logger,a.core),this.subscriber=new nw(this,this.logger),this.publisher=new nj(this,this.logger),this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||lS,f1()?this.packageName=f5():f2()&&(this.bundleId=f5()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return ah(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:l1},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(l4,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(l4,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,nC({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await ge(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await la())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=gj(n.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(lT,a),await this.recordMessageEvent(a,l2)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(lZ,c),await ge(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(lZ,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(lZ,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(lZ,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,n.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(f_())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new lI(new lL(f9({sdkVersion:l_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),lE(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:l1,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(nC({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else lF(a)&&this.events.emit(lU,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,l2),this.events.emit(lT,a))}async acknowledgePayload(a){let b=lu(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(lX,this.onPayloadHandler),this.provider.off(lY,this.onConnectHandler),this.provider.off(lZ,this.onDisconnectHandler),this.provider.off(l$,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let a=await la();lc(async b=>{a!==b&&(a=b,b?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(r,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&ld())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,n.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function nF(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function nG(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let nH="[object Arguments]",nI="[object Object]";function nJ(){}function nK(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var nL=Object.defineProperty,nM=Object.getOwnPropertySymbols,nN=Object.prototype.hasOwnProperty,nO=Object.prototype.propertyIsEnumerable,nP=(a,b,c)=>b in a?nL(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nQ=(a,b)=>{for(var c in b||(b={}))nN.call(b,c)&&nP(a,c,b[c]);if(nM)for(var c of nM(b))nO.call(b,c)&&nP(a,c,b[c]);return a},nR=(a,b,c)=>nP(a,"symbol"!=typeof b?b+"":b,c);class nS extends at{constructor(a,b,c,d=lN,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,nR(this,"map",new Map),nR(this,"version","0.3"),nR(this,"cached",[]),nR(this,"initialized",!1),nR(this,"getKey"),nR(this,"storagePrefix",lN),nR(this,"recentlyDeleted",[]),nR(this,"recentlyDeletedLimit",200),nR(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&null!==a&&!kL(a)?this.map.set(this.getKey(a),a):kR(a)?this.map.set(a.id,a):kS(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),nR(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),nR(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),nR(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=nG(c),h=nG(d);if(g===nH&&(g=nI),h===nH&&(h=nI),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case nI:{if(!(b(c.constructor,d.constructor,e,f)||nK(c)&&nK(d)))return!1;let g=[...Object.keys(c),...nF(c)],h=[...Object.keys(d),...nF(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,nJ)})):this.values)),nR(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=nQ(nQ({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),nR(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=ai(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=kH("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=kH("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=kH("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var nT=Object.defineProperty,nU=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nT(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class nV{constructor(a,b){this.core=a,this.logger=b,nU(this,"name","pairing"),nU(this,"version","0.3"),nU(this,"events",new m.default),nU(this,"pairings"),nU(this,"initialized",!1),nU(this,"storagePrefix",lN),nU(this,"ignoredPayloadTypes",[1]),nU(this,"registeredMethods",[]),nU(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),nU(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),nU(this,"create",async a=>{this.isInitialized();let b=j3(),c=await this.core.crypto.setSymKey(b),d=gj(n.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=ko({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(l7,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),nU(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=kn(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||gj(n.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(l7,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),nU(this,"activate",async({topic:a})=>{this.isInitialized();let b=gj(n.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),nU(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=gd();this.events.once(gl("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),nU(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),nU(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),nU(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),nU(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",kI("USER_DISCONNECTED")),await this.deletePairing(b))}),nU(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return ko({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),nU(this,"sendRequest",async(a,b,c)=>{let d=lt(b,c),e=await this.core.crypto.encode(a,d),f=l6[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),nU(this,"sendResult",async(a,b,c)=>{let d=lu(a,c),e=await this.core.crypto.encode(b,d),f=l6[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),nU(this,"sendError",async(a,b,c)=>{let d=lv(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=l6[f]?l6[f].res:l6.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),nU(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,kI("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),nU(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>gk(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),nU(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),nU(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),nU(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),nU(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{lG(b)?this.events.emit(gl("pairing_ping",c),{}):lH(b)&&this.events.emit(gl("pairing_ping",c),{error:b.error})},500)}),nU(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(l8,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),nU(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=kI("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),nU(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(kI("WC_METHOD_UNSUPPORTED",a))}),nU(this,"isValidPair",(a,b)=>{var c;if(!k_(a)){let{message:c}=kH("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(mi),Error(c)}if(!kQ(a.uri)){let{message:c}=kH("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(mi),Error(c)}let d=kn(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=kH("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(mi),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=kH("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(mi),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,n.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=kH("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),nU(this,"isValidPing",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),nU(this,"isValidDisconnect",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),nU(this,"isValidPairingTopic",async a=>{if(!kM(a,!1)){let{message:b}=kH("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=kH("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(gk(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=kH("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=ai(b,this.name),this.pairings=new nS(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ah(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(lT,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==l0&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);lE(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):lF(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(me,async a=>{let{topic:b}=gi(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var nW=Object.defineProperty,nX=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nW(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class nY extends ap{constructor(a,b){super(a,b),this.core=a,this.logger=b,nX(this,"records",new Map),nX(this,"events",new m.EventEmitter),nX(this,"name","history"),nX(this,"version","0.3"),nX(this,"cached",[]),nX(this,"initialized",!1),nX(this,"storagePrefix",lN),nX(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),nX(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:gj(n.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(l9,d)}),nX(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=lH(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(ma,b))}),nX(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),nX(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(mb,c)))}),this.persist()}),nX(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),nX(this,"on",(a,b)=>{this.events.on(a,b)}),nX(this,"once",(a,b)=>{this.events.once(a,b)}),nX(this,"off",(a,b)=>{this.events.off(a,b)}),nX(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=ai(b,this.name)}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:lt(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=kH("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=kH("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(l9,a=>{this.logger.info(`Emitting ${l9}`),this.logger.debug({type:"event",event:l9,record:a})}),this.events.on(ma,a=>{this.logger.info(`Emitting ${ma}`),this.logger.debug({type:"event",event:ma,record:a})}),this.events.on(mb,a=>{this.logger.info(`Emitting ${mb}`),this.logger.debug({type:"event",event:mb,record:a})}),this.core.heartbeat.on(r,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,n.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(mb,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var nZ=Object.defineProperty,n$=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nZ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class n_ extends av{constructor(a,b){super(a,b),this.core=a,this.logger=b,n$(this,"expirations",new Map),n$(this,"events",new m.EventEmitter),n$(this,"name","expirer"),n$(this,"version","0.3"),n$(this,"cached",[]),n$(this,"initialized",!1),n$(this,"storagePrefix",lN),n$(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),n$(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),n$(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(mc,{target:c,expiration:d})}),n$(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),n$(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(md,{target:b,expiration:c})}}),n$(this,"on",(a,b)=>{this.events.on(a,b)}),n$(this,"once",(a,b)=>{this.events.once(a,b)}),n$(this,"off",(a,b)=>{this.events.off(a,b)}),n$(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=ai(b,this.name)}get context(){return ah(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return gg(a);if("number"==typeof a)return gh(a);let{message:b}=kH("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=kH("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=kH("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,n.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(me,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(r,()=>this.checkExpirations()),this.events.on(mc,a=>{this.logger.info(`Emitting ${mc}`),this.logger.debug({type:"event",event:mc,data:a}),this.persist()}),this.events.on(me,a=>{this.logger.info(`Emitting ${me}`),this.logger.debug({type:"event",event:me,data:a}),this.persist()}),this.events.on(md,a=>{this.logger.info(`Emitting ${md}`),this.logger.debug({type:"event",event:md,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}}var n0=Object.defineProperty,n1=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?n0(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class n2 extends aw{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,n1(this,"name","verify-api"),n1(this,"abortController"),n1(this,"isDevEnv"),n1(this,"verifyUrlV3",mg),n1(this,"storagePrefix",lN),n1(this,"version",2),n1(this,"publicKey"),n1(this,"fetchPromise"),n1(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,n.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),n1(this,"register",async a=>{if(!f3()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,cV.getDocument)(),b=this.startAbortTimer(5*n.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if(cJ(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",d),d}catch(a){this.logger.warn(a)}return""}),n1(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if(cJ(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),n1(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*n.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),n1(this,"getVerifyUrl",a=>{let b=a||mf;return mh.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${mf}`),b=mf),b}),n1(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(n.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),n1(this,"persistPublicKey",async a=>{this.logger.debug("persisting public key to local storage",a),await this.store.setItem(this.storeKey,a),this.publicKey=a}),n1(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),n1(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),n1(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),n1(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),n1(this,"validateAttestation",(a,b)=>{let c=kk(a,b.publicKey),d={hasExpired:(0,n.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=ai(b,this.name),this.abortController=new AbortController,this.isDevEnv=gr(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ah(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,n.toMiliseconds)(a))}}var n3=Object.defineProperty,n4=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?n3(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class n5 extends ax{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,n4(this,"context","echo"),n4(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=ai(b,this.context)}}var n6=Object.defineProperty,n7=Object.getOwnPropertySymbols,n8=Object.prototype.hasOwnProperty,n9=Object.prototype.propertyIsEnumerable,oa=(a,b,c)=>b in a?n6(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ob=(a,b)=>{for(var c in b||(b={}))n8.call(b,c)&&oa(a,c,b[c]);if(n7)for(var c of n7(b))n9.call(b,c)&&oa(a,c,b[c]);return a},oc=(a,b,c)=>oa(a,"symbol"!=typeof b?b+"":b,c);class od extends ay{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,oc(this,"context","event-client"),oc(this,"storagePrefix",lN),oc(this,"storageVersion",.1),oc(this,"events",new Map),oc(this,"shouldPersist",!1),oc(this,"init",async()=>{if(!gr())try{let a={eventId:gq(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:f8(this.core.relayer.protocol,this.core.relayer.version,l_)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),oc(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=gq(),g=this.core.projectId||"",h=ob({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),oc(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return ob(ob({},d),this.setMethods(d.eventId))}),oc(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),oc(this,"setEventListeners",()=>{this.core.heartbeat.on(r,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,n.fromMiliseconds)(Date.now())-(0,n.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),oc(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),oc(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),oc(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),oc(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),oc(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,ob(ob({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),oc(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),oc(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${l_}${b}`,{method:"POST",body:JSON.stringify(a)})}),oc(this,"getAppDomain",()=>f7().url),this.logger=ai(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var oe=Object.defineProperty,of=Object.getOwnPropertySymbols,og=Object.prototype.hasOwnProperty,oh=Object.prototype.propertyIsEnumerable,oi=(a,b,c)=>b in a?oe(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,oj=(a,b)=>{for(var c in b||(b={}))og.call(b,c)&&oi(a,c,b[c]);if(of)for(var c of of(b))oh.call(b,c)&&oi(a,c,b[c]);return a},ok=(a,b,c)=>oi(a,"symbol"!=typeof b?b+"":b,c);class ol extends an{constructor(a){var b;super(a),ok(this,"protocol","wc"),ok(this,"version",2),ok(this,"name",lM),ok(this,"relayUrl"),ok(this,"projectId"),ok(this,"customStoragePrefix"),ok(this,"events",new m.EventEmitter),ok(this,"logger"),ok(this,"heartbeat"),ok(this,"relayer"),ok(this,"crypto"),ok(this,"storage"),ok(this,"history"),ok(this,"expirer"),ok(this,"pairing"),ok(this,"verify"),ok(this,"echoClient"),ok(this,"linkModeSupportedApps"),ok(this,"eventClient"),ok(this,"initialized",!1),ok(this,"logChunkController"),ok(this,"on",(a,b)=>this.events.on(a,b)),ok(this,"once",(a,b)=>this.events.once(a,b)),ok(this,"off",(a,b)=>this.events.off(a,b)),ok(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),ok(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:l0};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||lS,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=aj({opts:ag({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:lM}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ai(d,this.name),this.heartbeat=new s,this.crypto=new m0(this,this.logger,a?.keychain),this.history=new nY(this,this.logger),this.expirer=new n_(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new T(oj(oj({},lO),a?.storageOptions)),this.relayer=new nE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new nV(this,this.logger),this.verify=new n2(this,this.logger,this.storage),this.echoClient=new n5(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new od(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new ol(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return ah(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(l3,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(l3)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,a),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}var ak=U;let om="client",on=`wc@2:${om}:`,oo="WALLETCONNECT_DEEPLINK_CHOICE",op=(n.THIRTY_DAYS,"Proposal expired"),oq=n.SEVEN_DAYS,or={wc_sessionPropose:{req:{ttl:n.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:n.ONE_DAY,prompt:!1,tag:1104},res:{ttl:n.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:n.ONE_DAY,prompt:!1,tag:1106},res:{ttl:n.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:n.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:n.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:n.ONE_DAY,prompt:!1,tag:1112},res:{ttl:n.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:n.ONE_DAY,prompt:!1,tag:1114},res:{ttl:n.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:n.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:n.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:n.FIVE_MINUTES,prompt:!1,tag:1119}}},os={min:n.FIVE_MINUTES,max:n.SEVEN_DAYS},ot="IDLE",ou="ACTIVE",ov={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},ow=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],ox="wc@1.5:auth:",oy=`${ox}:PUB_KEY`;var oz=Object.defineProperty,oA=Object.defineProperties,oB=Object.getOwnPropertyDescriptors,oC=Object.getOwnPropertySymbols,oD=Object.prototype.hasOwnProperty,oE=Object.prototype.propertyIsEnumerable,oF=(a,b,c)=>b in a?oz(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,oG=(a,b)=>{for(var c in b||(b={}))oD.call(b,c)&&oF(a,c,b[c]);if(oC)for(var c of oC(b))oE.call(b,c)&&oF(a,c,b[c]);return a},oH=(a,b,c)=>oF(a,"symbol"!=typeof b?b+"":b,c);class oI extends aC{constructor(b){super(b),oH(this,"name","engine"),oH(this,"events",new m.default),oH(this,"initialized",!1),oH(this,"requestQueue",{state:ot,queue:[]}),oH(this,"sessionRequestQueue",{state:ot,queue:[]}),oH(this,"emittedSessionRequests",new gu({limit:500})),oH(this,"requestQueueDelay",n.ONE_SECOND),oH(this,"expectedPairingMethodMap",new Map),oH(this,"recentlyDeletedMap",new Map),oH(this,"recentlyDeletedLimit",200),oH(this,"relayMessageCache",[]),oH(this,"pendingSessions",new Map),oH(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(or)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,n.toMiliseconds)(this.requestQueueDelay)))}),oH(this,"connect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let b=oA(oG({},a),oB({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(b),b.optionalNamespaces=kE(b.requiredNamespaces,b.optionalNamespaces),b.requiredNamespaces={};let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=b,i=c,j,k=!1;try{if(i){let a=this.client.core.pairing.pairings.get(i);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),k=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${i}) failed`),a}if(!i||!k){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});i=a,j=b}if(!i){let{message:a}=kH("NO_MATCHING_KEY",`connect() pairing topic: ${i}`);throw Error(a)}let l=await this.client.core.crypto.generateKeyPair(),m=or.wc_sessionPropose.req.ttl||n.FIVE_MINUTES,o=gj(m),p=oA(oG(oG({requiredNamespaces:d,optionalNamespaces:e,relays:h??[{protocol:"irn"}],proposer:{publicKey:l,metadata:this.client.metadata},expiryTimestamp:o,pairingTopic:i},f&&{sessionProperties:f}),g&&{scopedProperties:g}),oB({id:lr()})),q=gl("session_connect",p.id),{reject:r,resolve:s,done:t}=gd(m,op),u=({id:a})=>{a===p.id&&(this.client.events.off("proposal_expire",u),this.pendingSessions.delete(p.id),this.events.emit(q,{error:{message:op,code:0}}))};return this.client.events.on("proposal_expire",u),this.events.once(q,({error:a,session:b})=>{this.client.events.off("proposal_expire",u),a?r(a):b&&s(b)}),await this.sendProposeSession({proposal:p,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:p.id}}}),await this.setProposal(p.id,p),{uri:j,approval:t}}),oH(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),oH(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[mj]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k}=a,l=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:m,proposer:n,requiredNamespaces:o,optionalNamespaces:p}=l,q=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:m});q||(q=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:mj,properties:{topic:m,trace:[mj,"session_namespaces_validation_success"]}}));let r=await this.client.core.crypto.generateKeyPair(),s=n.publicKey,t=await this.client.core.crypto.generateSharedKey(r,s),u=oG(oG(oG({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:r,metadata:this.client.metadata},expiry:gj(oq)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k});q.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(t,{transportType:l1,internal:{skipSubscribe:!0}})}catch(a){throw q.setError("subscribe_session_topic_failure"),a}q.addTrace("subscribe_session_topic_success");let v=oA(oG({},u),oB({topic:t,requiredNamespaces:o,optionalNamespaces:p,pairingTopic:m,acknowledged:!1,self:u.controller,peer:{publicKey:n.publicKey,metadata:n.metadata},controller:r,transportType:l1}));await this.client.session.set(t,v),q.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:t,proposal:l,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:r},sessionSettleRequest:u,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f}}}),q.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(t,kI("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(t),a}return this.client.core.eventClient.deleteEvent({eventId:q.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:n.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(t,gj(oq)),{topic:t,acknowledged:()=>Promise.resolve(this.client.session.get(t))}}),oH(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:or.wc_sessionPropose.reject}),await this.deleteProposal(c)}),oH(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=gd(),g=lr(),h=ls().toString(),i=this.client.session.get(b).namespaces;return this.events.once(gl("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),oH(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=lr(),{done:d,resolve:e,reject:f}=gd();return this.events.once(gl("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,gj(oq)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),oH(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=or.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===l1&&await this.confirmOnlineStateOrThrow();let g=lr(),h=ls().toString(),{done:i,resolve:j,reject:k}=gd(e,"Request expired. Please try again.");this.events.once(gl("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:oA(oG({},c),oB({expiryTimestamp:gj(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let n={request:oA(oG({},c),oB({expiryTimestamp:gj(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:n,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,n)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await go(this.client.core.storage,oo);await gn({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),oH(this,"respond",async a=>{this.isInitialized(),await this.isValidRespond(a);let{topic:b,response:c}=a,{id:d}=c,e=this.client.session.get(b);e.transportType===l1&&await this.confirmOnlineStateOrThrow();let f=this.getAppLinkIfEnabled(e.peer.metadata,e.transportType);lG(c)?await this.sendResult({id:d,topic:b,result:c.result,throwOnFailedPublish:!0,appLink:f}):lH(c)&&await this.sendError({id:d,topic:b,error:c.error,appLink:f}),this.cleanupAfterResponse(a)}),oH(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=lr(),c=ls().toString(),{done:d,resolve:e,reject:f}=gd();this.events.once(gl("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),oH(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=ls().toString(),f=lr();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),oH(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:kI("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=kH("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),oH(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>kO(b,a)))),oH(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),oH(this,"authenticate",async(a,b)=>{var c;let d;this.isInitialized(),this.isValidAuthenticate(a);let e=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),f=e?l0:l1;f===l1&&await this.confirmOnlineStateOrThrow();let{chains:g,statement:h="",uri:i,domain:j,nonce:k,type:l,exp:m,nbf:n,methods:o=[],expiry:p}=a,q=[...a.resources||[]],{topic:r,uri:s}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:f});this.client.logger.info({message:"Generated new pairing",pairing:{topic:r,uri:s}});let t=await this.client.core.crypto.generateKeyPair(),u=j5(t);if(await Promise.all([this.client.auth.authKeys.set(oy,{responseTopic:u,publicKey:t}),this.client.auth.pairingTopics.set(u,{topic:u,pairingTopic:r})]),await this.client.core.relayer.subscribe(u,{transportType:f}),this.client.logger.info(`sending request to new pairing topic: ${r}`),o.length>0){let{namespace:a}=fN(g[0]),b=ie(a,"request",o);ij(q)&&(b=ig(b,q.pop())),q.push(b)}let v=p&&p>or.wc_sessionAuthenticate.req.ttl?p:or.wc_sessionAuthenticate.req.ttl,w={authPayload:{type:l??"caip122",chains:g,statement:h,aud:i,domain:j,version:"1",nonce:k,iat:new Date().toISOString(),exp:m,nbf:n,resources:q},requester:{publicKey:t,metadata:this.client.metadata},expiryTimestamp:gj(v)},x={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:g,methods:[...new Set(["personal_sign",...o])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:r,proposer:{publicKey:t,metadata:this.client.metadata},expiryTimestamp:gj(or.wc_sessionPropose.req.ttl),id:lr()},{done:y,resolve:z,reject:A}=gd(v,"Request expired"),B=lr(),C=gl("session_connect",x.id),D=gl("session_request",B),E=async({error:a,session:b})=>{this.events.off(D,F),a?A(a):b&&z({session:b})},F=async a=>{var c,d,e;let g;if(await this.deletePendingAuthRequest(B,{message:"fulfilled",code:0}),a.error){let b=kI("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(C,E),A(a.error.message))}await this.deleteProposal(x.id),this.events.off(C,E);let{cacaos:h,responder:i}=a.result,j=[],k=[];for(let a of h){await h9({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),A(kI("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=ij(b.resources),d=[h7(b.iss)],e=h8(b.iss);if(c){let a=ih(c),b=ii(c);j.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(t,i.publicKey);j.length>0&&(g={topic:l,acknowledged:!0,self:{publicKey:t,metadata:this.client.metadata},peer:i,controller:i.publicKey,expiry:gj(oq),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:r,namespaces:kD([...new Set(j)],[...new Set(k)]),transportType:f},await this.client.core.relayer.subscribe(l,{transportType:f}),await this.client.session.set(l,g),r&&await this.client.core.pairing.updateMetadata({topic:r,metadata:i.metadata}),g=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=i.metadata.redirect)&&d.linkMode&&null!=(e=i.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(i.metadata.redirect.universal),this.client.session.update(l,{transportType:l0})),z({auths:h,session:g})};this.events.once(C,E),this.events.once(D,F);try{if(e){let a=lt("wc_sessionAuthenticate",w,B);this.client.core.history.set(r,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:j0});d=kp(b,r,c)}else await Promise.all([this.sendRequest({topic:r,method:"wc_sessionAuthenticate",params:w,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:B}),this.sendRequest({topic:r,method:"wc_sessionPropose",params:x,expiry:or.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:x.id})])}catch(a){throw this.events.off(C,E),this.events.off(D,F),a}return await this.setProposal(x.id,x),await this.setAuthRequest(B,{request:oA(oG({},w),oB({verifyContext:{}})),pairingTopic:r,transportType:f}),{uri:d??s,response:y}}),oH(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||l1;g===l1&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=j5(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await h9({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=kI("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=ij(b.resources),f=[h7(b.iss)],g=h8(b.iss);if(d){let a=ih(d),b=ii(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let n=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:n,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:gj(oq),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:kD([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(n,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(n,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),oH(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===l1&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=j5(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:or.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),oH(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return ia(b,c)}),oH(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),oH(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),oH(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,kI("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(oo).catch(a=>this.client.logger.warn(a)),this.getPendingSessionRequests().forEach(a=>{a.topic===c&&this.deletePendingSessionRequest(a.id,kI("USER_DISCONNECTED"))}),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=ot),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),oH(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,kI("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),oH(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=ot,this.client.events.emit("session_request_expire",{id:a}))}),oH(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),oH(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),oH(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,gj(or.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),oH(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=l1}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),oH(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||gj(or.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),oH(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m,publishOpts:n={}}=b,o=lt(f,g,j),p=!!l;try{let a=p?j0:j_;c=await this.client.core.crypto.encode(e,o,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(ow.includes(f)){let a=j6(JSON.stringify(o)),b=j6(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let q=oG(oG({},or[f].req),n);if(q.attestation=d,h&&(q.ttl=h),i&&(q.id=i),this.client.core.history.set(e,o),p){let b=kp(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;q.tvf=oA(oG({},m),oB({correlationId:o.id})),k?(a=oG({},q.internal),q.internal=oA(a,oB({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,q)):this.client.core.relayer.publish(e,c,q).catch(a=>this.client.logger.error(a))}return o.id}),oH(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=lt("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:j_}),f=j6(JSON.stringify(d)),g=j6(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:oA(oG({},c),oB({publishMethod:"wc_proposeSession",attestation:h}))})}),oH(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=lu(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:j_}),i=lt("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:j_});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:oA(oG({},f),oB({publishMethod:"wc_approveSession"}))})}),oH(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=lu(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?j0:j_;c=await this.client.core.crypto.encode(g,l,(a=oG({},j||{}),b={encoding:d},oA(a,oB(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=kp(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=or[d.request.method].res;b.tvf=oA(oG({},e),oB({correlationId:f})),i?(a=oG({},b.internal),b.internal=oA(a,oB({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),oH(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=lv(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=l?j0:j_;c=await this.client.core.crypto.encode(f,k,(a=oG({},h||{}),b={encoding:d},oA(a,oB(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=kp(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||or[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),oH(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;gk(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{gk(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),oH(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),oH(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),oH(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ou)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ou;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=ot}),oH(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),oH(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),oH(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=kH("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),oH(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),oH(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(oG({},c.params));let h=f.expiryTimestamp||gj(or.wc_sessionPropose.req.ttl),i=oG({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:j6(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:or.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),oH(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if(lG(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if(lH(b)){await this.deleteProposal(d);let a=gl("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),oH(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l}=b.params,m=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!m)return this.client.logger.error(`Pending session not found for topic ${a}`);let n=this.client.proposal.get(m.proposalId),o=(c=oG(oG(oG({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,controller:g.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:l1},oA(c,oB(e)));await this.client.session.set(o.topic,o),await this.setExpiry(o.topic,o.expiry),await this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:o.peer.metadata}),this.client.events.emit("session_connect",{session:o}),this.events.emit(gl("session_connect",m.proposalId),{session:o}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(o),await this.sendResult({id:b.id,topic:a,result:!0})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),oH(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;lG(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(gl("session_approve",c),{})):lH(b)&&(await this.client.session.delete(a,kI("USER_DISCONNECTED")),this.events.emit(gl("session_approve",c),{error:b.error}))}),oH(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=lf.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:kI("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(oG({topic:a},c));try{lf.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw lf.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),oH(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),oH(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=gl("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);lG(b)?this.events.emit(gl("session_update",c),{}):lH(b)&&this.events.emit(gl("session_update",c),{error:b.error})}),oH(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,gj(oq)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),oH(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=gl("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);lG(b)?this.events.emit(gl("session_extend",c),{}):lH(b)&&this.events.emit(gl("session_extend",c),{error:b.error})}),oH(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),oH(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=gl("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);lG(b)?this.events.emit(gl("session_ping",c),{}):lH(b)&&this.events.emit(gl("session_ping",c),{error:b.error})},500)}),oH(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a,reason:b.params}),await Promise.all([new Promise(b=>{this.client.core.relayer.once(lW,async()=>{b(await this.deleteSession({topic:a,id:c}))})}),this.sendResult({id:c,topic:a,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:a,error:kI("USER_DISCONNECTED")})]).catch(a=>this.client.logger.error(a))}catch(a){this.client.logger.error(a)}}),oH(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(oG({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:j6(JSON.stringify(lt("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===l0&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),oH(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=gl("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);lG(b)?this.events.emit(gl("session_request",c),{result:b.result}):lH(b)&&this.events.emit(gl("session_request",c),{error:b.error})}),oH(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=lf.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(oG({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),lf.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),oH(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),lG(b)?this.events.emit(gl("session_request",c),{result:b.result}):lH(b)&&this.events.emit(gl("session_request",c),{error:b.error})}),oH(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:j6(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===l0&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:or.wc_sessionAuthenticate.autoReject,appLink:e})}}),oH(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),oH(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ot,this.processSessionRequestQueue()},(0,n.toMiliseconds)(this.requestQueueDelay))}),oH(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{let c=gl("session_request",a.request.id);if(0===this.events.listenerCount(c))throw Error(`emitting ${c} without any listeners`);this.events.emit(gl("session_request",a.request.id),{error:b})})}),oH(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ou)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),oH(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=ou,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),oH(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:lt("wc_sessionPropose",oA(oG({},b),oB({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),oH(this,"isValidConnect",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:b,requiredNamespaces:c,optionalNamespaces:d,sessionProperties:e,scopedProperties:f,relays:g}=a;if(kL(b)||await this.isValidPairingTopic(b),!kZ(g,!0)){let{message:a}=kH("MISSING_OR_INVALID",`connect() relays: ${g}`);throw Error(a)}if(!kL(c)&&0!==kK(c)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(c,"requiredNamespaces")}if(kL(d)||0===kK(d)||this.validateNamespaces(d,"optionalNamespaces"),kL(e)||this.validateSessionProps(e,"sessionProperties"),!kL(f)){this.validateSessionProps(f,"scopedProperties");let a=Object.keys(c||{}).concat(Object.keys(d||{}));if(!Object.keys(f).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(f)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),oH(this,"validateNamespaces",(a,b)=>{let c=kW(a,"connect()",b);if(c)throw Error(c.message)}),oH(this,"isValidApprove",async a=>{if(!k_(a))throw Error(kH("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=kX(c,"approve()");if(h)throw Error(h.message);let i=k7(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!kM(d,!0)){let{message:a}=kH("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(kL(e)||this.validateSessionProps(e,"sessionProperties"),!kL(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),oH(this,"isValidReject",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!k0(c)){let{message:a}=kH("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),oH(this,"isValidSessionSettleRequest",a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:b,controller:c,namespaces:d,expiry:e}=a;if(!kY(b)){let{message:a}=kH("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let f=kT(c,"onSessionSettleRequest()");if(f)throw Error(f.message);let g=kX(d,"onSessionSettleRequest()");if(g)throw Error(g.message);if(gk(e)){let{message:a}=kH("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),oH(this,"isValidUpdate",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=kX(c,"update()");if(e)throw Error(e.message);let f=k7(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),oH(this,"isValidExtend",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),oH(this,"isValidRequest",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:b,request:c,chainId:d,expiry:e}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let{namespaces:f}=this.client.session.get(b);if(!k4(f,d)){let{message:a}=kH("MISSING_OR_INVALID",`request() chainId: ${d}`);throw Error(a)}if(!k1(c)){let{message:a}=kH("MISSING_OR_INVALID",`request() ${JSON.stringify(c)}`);throw Error(a)}if(!k5(f,d,c.method)){let{message:a}=kH("MISSING_OR_INVALID",`request() method: ${c.method}`);throw Error(a)}if(e&&!k9(e,os)){let{message:a}=kH("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${os.min} and ${os.max}`);throw Error(a)}}),oH(this,"isValidRespond",async a=>{var b;if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(!k2(d)){let{message:a}=kH("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}}),oH(this,"isValidPing",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),oH(this,"isValidEmit",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:b,event:c,chainId:d}=a;await this.isValidSessionTopic(b);let{namespaces:e}=this.client.session.get(b);if(!k4(e,d)){let{message:a}=kH("MISSING_OR_INVALID",`emit() chainId: ${d}`);throw Error(a)}if(!k3(c)||!k6(e,d,c.name)){let{message:a}=kH("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(c)}`);throw Error(a)}}),oH(this,"isValidDisconnect",async a=>{if(!k_(a)){let{message:b}=kH("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),oH(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!kM(c,!1))throw Error("uri is required parameter");if(!kM(d,!1))throw Error("domain is required parameter");if(!kM(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>fN(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=fN(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),oH(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||mf,validation:"UNKNOWN",origin:e.url||""}};try{if(f===l0){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),oH(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=kH("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),oH(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),oH(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),oH(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=kH("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),oH(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===l0&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),oH(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),oH(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=gp(a,"topic")||"",c=decodeURIComponent(gp(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:l0}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),oH(this,"registerLinkModeListeners",async()=>{var b;if(gr()||f0()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),oH(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn("Error getting TVF params",a)}return g}),oH(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),oH(this,"extractTxHashesFromResult",(a,b)=>{var c;try{if(!b)return[];let d=a.method,e=ov[d];if("sui_signTransaction"===d)return[hW(b.transactionBytes)];if("near_signTransaction"===d)return[hX(b)];if("near_signTransactions"===d)return b.map(a=>hX(a));if("xrpl_signTransactionFor"===d||"xrpl_signTransaction"===d)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===d)return[lh({transaction:a.params.transactionPayload,signature:b.signature})];if("algo_signTxn"===d)return kJ(b)?b.map(a=>hY(a)):[hY(b)];if("cosmos_signDirect"===d)return[h$(b)];if("string"==typeof b)return[b];let f=b[e.key];if(kJ(f))return"solana_signAllTransactions"===d?f.map(a=>hV(a)):f;if("string"==typeof f)return[f]}catch(a){this.client.logger.warn("Error extracting tx hashes from result",a)}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn("processPendingMessageEvents failed",a)}}isInitialized(){if(!this.initialized){let{message:a}=kH("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(lT,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(oy)?this.client.auth.authKeys.get(oy):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===l0?j0:j_});lE(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:j6(c)})):lF(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e}),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(me,async a=>{let{topic:b,id:c}=gi(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,kH("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,kH("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(l7,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(l8,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!kM(a,!1)){let{message:b}=kH("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=kH("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(gk(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=kH("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!kM(a,!1)){let{message:b}=kH("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=kH("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(gk(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=kH("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=kH("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(kM(a,!1)){let{message:b}=kH("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=kH("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if(!k$(a)){let{message:b}=kH("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=kH("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(gk(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=kH("EXPIRED",`proposal id: ${a}`);throw Error(b)}}}class oJ extends nS{constructor(a,b){super(a,b,"proposal",on),this.core=a,this.logger=b}}class oK extends nS{constructor(a,b){super(a,b,"session",on),this.core=a,this.logger=b}}class oL extends nS{constructor(a,b){super(a,b,"request",on,a=>a.id),this.core=a,this.logger=b}}class oM extends nS{constructor(a,b){super(a,b,"authKeys",ox,()=>oy),this.core=a,this.logger=b}}class oN extends nS{constructor(a,b){super(a,b,"pairingTopics",ox),this.core=a,this.logger=b}}class oO extends nS{constructor(a,b){super(a,b,"requests",ox,a=>a.id),this.core=a,this.logger=b}}var oP=Object.defineProperty,oQ=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?oP(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class oR{constructor(a,b){this.core=a,this.logger=b,oQ(this,"authKeys"),oQ(this,"pairingTopics"),oQ(this,"requests"),this.authKeys=new oM(this.core,this.logger),this.pairingTopics=new oN(this.core,this.logger),this.requests=new oO(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var oS=Object.defineProperty,oT=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?oS(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class oU extends aB{constructor(a){super(a),oT(this,"protocol","wc"),oT(this,"version",2),oT(this,"name",om),oT(this,"metadata"),oT(this,"core"),oT(this,"logger"),oT(this,"events",new m.EventEmitter),oT(this,"engine"),oT(this,"session"),oT(this,"proposal"),oT(this,"pendingRequest"),oT(this,"auth"),oT(this,"signConfig"),oT(this,"on",(a,b)=>this.events.on(a,b)),oT(this,"once",(a,b)=>this.events.once(a,b)),oT(this,"off",(a,b)=>this.events.off(a,b)),oT(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),oT(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),oT(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),oT(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),oT(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||om,this.metadata=f6(a?.metadata),this.signConfig=a?.signConfig;const b="u">typeof a?.logger&&"string"!=typeof a?.logger?a.logger:(0,ak.default)(ag({level:a?.logger||"error"}));this.core=a?.core||new ol(a),this.logger=ai(b,this.name),this.session=new oK(this.core,this.logger),this.proposal=new oJ(this.core,this.logger),this.pendingRequest=new oL(this.core,this.logger),this.engine=new oI(this),this.auth=new oR(this.core,this.logger)}static async init(a){let b=new oU(a);return await b.initialize(),b}get context(){return ah(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}a.s(["SignClient",()=>oU,"default",()=>oU],136554)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__715510f1._.js.map