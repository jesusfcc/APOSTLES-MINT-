{"version":3,"sources":["../../../../node_modules/thirdweb/src/storage/upload/web-node.ts"],"sourcesContent":["import type { ThirdwebClient } from \"../../client/client.js\";\nimport { getThirdwebDomains } from \"../../utils/domains.js\";\nimport { getClientFetch } from \"../../utils/fetch.js\";\nimport { IS_TEST } from \"../../utils/process.js\";\nimport { addToMockStorage } from \"../mock.js\";\nimport type { UploadableFile, UploadOptions } from \"./types.js\";\n\nexport async function uploadBatch<const TFiles extends UploadableFile[]>(\n  client: ThirdwebClient,\n  form: FormData,\n  fileNames: string[],\n  options?: UploadOptions<TFiles>,\n) {\n  if (IS_TEST) {\n    return addToMockStorage(form);\n  }\n\n  const headers: HeadersInit = {};\n\n  const res = await getClientFetch(client)(\n    `https://${getThirdwebDomains().storage}/ipfs/upload`,\n    {\n      body: form,\n      headers,\n      method: \"POST\",\n      requestTimeoutMs:\n        client.config?.storage?.fetch?.requestTimeoutMs || 120000,\n      // force auth token usage for storage uploads\n      useAuthToken: true,\n    },\n  );\n\n  if (!res.ok) {\n    if (res.status === 401) {\n      throw new Error(\n        \"Unauthorized - You don't have permission to use this service.\",\n      );\n    }\n    if (res.status === 402) {\n      throw new Error(\n        \"You have reached your storage limit. Please add a valid payment method to continue using the service.\",\n      );\n    }\n    if (res.status === 403) {\n      throw new Error(\n        \"Forbidden - You don't have permission to use this service.\",\n      );\n    }\n    throw new Error(\n      `Failed to upload files to IPFS - ${res.status} - ${res.statusText}`,\n    );\n  }\n\n  const body = await res.json();\n\n  const cid = body.IpfsHash;\n  if (!cid) {\n    throw new Error(\"Failed to upload files to IPFS - Bad CID\");\n  }\n\n  if (options?.uploadWithoutDirectory) {\n    return [`ipfs://${cid}`];\n  }\n  return fileNames.map((name) => `ipfs://${cid}/${name}`);\n}\n"],"names":[],"mappings":"wCACA,IAAA,EAAmC,CAA5B,CAAqD,CAAA,AAAnD,CAAmD,QAC5D,CAD2D,CAAC,AAC7B,CAAxB,CAA+C,CAA7C,AAA6C,CAAA,GAD3B,AAC0B,CAAC,CADzB,GAE7B,EAAwB,CAFW,AAE5B,CAAyC,AAAC,CAAxC,AADc,AAC0B,CAAA,CADxB,KACT,CADe,CAE/B,AADkB,EAC4B,CAAvC,CAAuC,CAArC,AAAqC,CAAA,AADtB,QAIjB,KAAK,EAHa,EAAE,MAGL,AAHW,EAI/B,CAAsB,CACtB,CAAc,CACd,CAAmB,CACnB,CAA+B,EAE/B,AAN+B,CAHY,EASvC,EAAA,OAAO,CACT,CADW,CAAC,IACZ,CAAA,EAAO,EAAA,gBAAA,AAAgB,EAAC,GAK1B,CAL8B,CAAC,CAAC,CAK1B,EAAM,CAAH,KAAG,CAAA,EAAM,EAAA,cAAA,AAAc,EAAC,GAC/B,CAAA,EADqC,CAAC,KACtC,EAAA,CAAA,EAAW,EAAA,kBAAA,AAAkB,EAAE,EAAC,OAAO,CAAA,YAAA,CAAc,CACrD,CACE,IAAI,CAAE,EACN,EADU,KACH,CANkB,CAAA,CAAE,CAAC,AAO5B,MAAM,CAAE,MAAM,CACd,gBAAgB,CACd,EAAO,IAAD,EAAO,EAAE,OAAO,EAAE,KAAK,EAAE,gBAAgB,EAAI,KAErD,CAF2D,WAE/C,EAAE,EACf,CACF,CAFqB,AAEpB,AAEF,GAAI,CAAC,EAAI,CAAD,CAAG,CAAE,CAAC,AACZ,GAAmB,GAAG,EAAE,CAApB,AAAqB,EAAjB,CAAD,KAAO,CACZ,MAAM,AAAI,KAAK,CACb,+DAA+D,CAChE,CAAC,AAEJ,GAAmB,GAAG,EAAE,CAApB,AAAqB,EAAjB,CAAD,KAAO,CACZ,MAAM,AAAI,KAAK,CACb,uGAAuG,CACxG,CAEH,AAFI,GAEe,GAAG,EAAE,CAApB,AAAqB,EAAjB,CAAD,KAAO,CACZ,MAAM,AAAI,KAAK,CACb,4DAA4D,CAC7D,AAEH,CAFI,MAEM,AAAJ,KAAS,CACb,CAAA,iCAAA,EAAoC,EAAI,CAAD,KAAO,CAAA,GAAA,EAAM,EAAI,CAAD,SAAW,CAAA,CAAE,CACrE,AACH,CADI,AACH,AAID,IAAM,EAAM,CAFC,AAEJ,GAAO,GAFG,EAAI,CAAD,GAAK,EAAA,CAAE,CAAC,AAEb,QAAQ,CAAC,AAC1B,GAAI,CAAC,EACH,CADM,EAAE,CAAC,EACH,AAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC,OAG9D,AAAI,GAAS,IAAF,kBAAwB,CAC1B,CAD4B,AAC3B,CAD4B,AAC5B,OAAA,EAAU,EAAG,CAAA,AAAE,CAAC,CAAC,AAEpB,EAAU,GAAG,CAAC,AAAC,GAAN,AAAe,CAAL,AAAK,EAAH,KAAG,EAAU,EAAG,CAAA,EAAI,EAAI,CAAE,CAAF,AAAG,AACzD,CAD0D,AACzD"}