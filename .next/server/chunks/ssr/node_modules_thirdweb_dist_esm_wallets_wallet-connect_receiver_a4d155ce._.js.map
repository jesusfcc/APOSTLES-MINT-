{"version":3,"sources":["../../../../node_modules/thirdweb/src/wallets/wallet-connect/receiver/session-request.ts"],"sourcesContent":["import type { ThirdwebClient } from \"../../../client/client.js\";\nimport type { Hex } from \"../../../utils/encoding/hex.js\";\nimport type { Wallet } from \"../../interfaces/wallet.js\";\nimport { handleSendRawTransactionRequest } from \"./request-handlers/send-raw-transaction.js\";\nimport { handleSendTransactionRequest } from \"./request-handlers/send-transaction.js\";\n// Due to some edge cases, we can't import these handlers dynamically\nimport { handleSignRequest } from \"./request-handlers/sign.js\";\nimport { handleSignTransactionRequest } from \"./request-handlers/sign-transaction.js\";\nimport { handleSignTypedDataRequest } from \"./request-handlers/sign-typed-data.js\";\nimport type {\n  WalletConnectAddEthereumChainRequestParams,\n  WalletConnectClient,\n  WalletConnectRawTransactionRequestParams,\n  WalletConnectRequestError,\n  WalletConnectRequestHandlers,\n  WalletConnectSessionRequestEvent,\n  WalletConnectSignRequestPrams,\n  WalletConnectSignTypedDataRequestParams,\n  WalletConnectSwitchEthereumChainRequestParams,\n  WalletConnectTransactionRequestParams,\n} from \"./types.js\";\nimport { parseEip155ChainId } from \"./utils.js\";\n\n/**\n * @internal\n */\nexport async function fulfillRequest(options: {\n  wallet: Wallet;\n  walletConnectClient: WalletConnectClient;\n  event: WalletConnectSessionRequestEvent;\n  thirdwebClient: ThirdwebClient;\n  handlers?: WalletConnectRequestHandlers;\n}) {\n  const {\n    wallet,\n    walletConnectClient,\n    thirdwebClient,\n    event: {\n      topic,\n      id,\n      params: { chainId: rawChainId, request },\n    },\n    handlers,\n  } = options;\n\n  const account = wallet.getAccount();\n  if (!account) {\n    throw new Error(\"No account connected to provided wallet\");\n  }\n\n  let result: WalletConnectRequestError | Hex;\n  try {\n    switch (request.method) {\n      case \"personal_sign\": {\n        if (handlers?.personal_sign) {\n          result = await handlers.personal_sign({\n            account,\n            params: request.params as WalletConnectSignRequestPrams,\n          });\n        } else {\n          result = await handleSignRequest({\n            account,\n            params: request.params as WalletConnectSignRequestPrams,\n          });\n        }\n        break;\n      }\n      case \"eth_sign\": {\n        if (handlers?.eth_sign) {\n          result = await handlers.eth_sign({\n            account,\n            params: request.params as WalletConnectSignRequestPrams,\n          });\n        } else {\n          result = await handleSignRequest({\n            account,\n            params: request.params as WalletConnectSignRequestPrams,\n          });\n        }\n        break;\n      }\n      case \"eth_signTypedData\": {\n        if (handlers?.eth_signTypedData) {\n          result = await handlers.eth_signTypedData({\n            account,\n            params: request.params as WalletConnectSignTypedDataRequestParams,\n          });\n        } else {\n          result = await handleSignTypedDataRequest({\n            account,\n            params: request.params as WalletConnectSignTypedDataRequestParams,\n          });\n        }\n        break;\n      }\n      case \"eth_signTypedData_v4\": {\n        if (handlers?.eth_signTypedData_v4) {\n          result = await handlers.eth_signTypedData_v4({\n            account,\n            params: request.params as WalletConnectSignTypedDataRequestParams,\n          });\n        } else {\n          result = await handleSignTypedDataRequest({\n            account,\n            params: request.params as WalletConnectSignTypedDataRequestParams,\n          });\n        }\n        break;\n      }\n      case \"eth_signTransaction\": {\n        if (handlers?.eth_signTransaction) {\n          result = await handlers.eth_signTransaction({\n            account,\n            params: request.params as WalletConnectTransactionRequestParams,\n          });\n        } else {\n          result = await handleSignTransactionRequest({\n            account,\n            params: request.params as WalletConnectTransactionRequestParams,\n          });\n        }\n        break;\n      }\n      case \"eth_sendTransaction\": {\n        const chainId = parseEip155ChainId(rawChainId);\n        if (handlers?.eth_sendTransaction) {\n          result = await handlers.eth_sendTransaction({\n            account,\n            chainId,\n            params: request.params as WalletConnectTransactionRequestParams,\n          });\n        } else {\n          result = await handleSendTransactionRequest({\n            account,\n            chainId,\n            params: request.params as WalletConnectTransactionRequestParams,\n            thirdwebClient,\n          });\n        }\n        break;\n      }\n      case \"eth_sendRawTransaction\": {\n        const chainId = parseEip155ChainId(rawChainId);\n        if (handlers?.eth_sendRawTransaction) {\n          result = await handlers.eth_sendRawTransaction({\n            account,\n            chainId,\n            params: request.params as WalletConnectRawTransactionRequestParams,\n          });\n        } else {\n          result = await handleSendRawTransactionRequest({\n            account,\n            chainId,\n            params: request.params as WalletConnectRawTransactionRequestParams,\n          });\n        }\n        break;\n      }\n      case \"wallet_addEthereumChain\": {\n        if (handlers?.wallet_addEthereumChain) {\n          result = await handlers.wallet_addEthereumChain({\n            params:\n              request.params as WalletConnectAddEthereumChainRequestParams,\n            wallet,\n          });\n        } else {\n          throw new Error(\n            \"Unsupported request method: wallet_addEthereumChain\",\n          );\n        }\n        break;\n      }\n      case \"wallet_switchEthereumChain\": {\n        if (handlers?.wallet_switchEthereumChain) {\n          result = await handlers.wallet_switchEthereumChain({\n            params:\n              request.params as WalletConnectSwitchEthereumChainRequestParams,\n            wallet,\n          });\n        } else {\n          const { handleSwitchChain } = await import(\n            \"./request-handlers/switch-chain.js\"\n          );\n\n          result = await handleSwitchChain({\n            params:\n              request.params as WalletConnectSwitchEthereumChainRequestParams,\n            wallet,\n          });\n        }\n        break;\n      }\n      default: {\n        const potentialHandler = handlers?.[request.method];\n        if (potentialHandler) {\n          result = await potentialHandler({\n            account,\n            chainId: parseEip155ChainId(rawChainId),\n            params: request.params,\n          });\n        } else {\n          throw new Error(`Unsupported request method: ${request.method}`);\n        }\n      }\n    }\n  } catch (error: unknown) {\n    result = {\n      code:\n        typeof error === \"object\" && error !== null && \"code\" in error\n          ? (error as { code: number }).code\n          : 500,\n      message:\n        typeof error === \"object\" && error !== null && \"message\" in error\n          ? (error as { message: string }).message\n          : \"Unknown error\",\n    };\n  }\n\n  walletConnectClient.respond({\n    response: {\n      id,\n      jsonrpc: \"2.0\",\n      result,\n    },\n    topic,\n  });\n}\n"],"names":[],"mappings":"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"}