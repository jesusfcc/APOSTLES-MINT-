{"version":3,"sources":["../../../../node_modules/thirdweb/src/utils/random.ts","../../../../node_modules/thirdweb/src/storage/mock.ts","../../../../node_modules/thirdweb/src/storage/upload/web-node.ts"],"sourcesContent":["import { uint8ArrayToHex } from \"./encoding/hex.js\";\n\n/**\n * @internal\n */\nexport function randomBytesHex(length = 32) {\n  return uint8ArrayToHex(randomBytesBuffer(length));\n}\n\n/**\n * @internal\n */\nexport function randomBytesBuffer(length = 32) {\n  return globalThis.crypto.getRandomValues(new Uint8Array(length));\n}\n","import { randomBytesHex } from \"../utils/random.js\";\n\nconst mockStorage = new Map<string, unknown>();\n\n/**\n * Extracts file contents from FormData and stores it as JSON\n * @returns The storage key with filename if present\n */\nexport async function addToMockStorage(value: FormData): Promise<string[]> {\n  const key = randomBytesHex();\n\n  // Get the first file from FormData\n  const files = value.getAll(\"file\") as File[];\n  if (!files) {\n    throw new Error(\"No file found in FormData\");\n  }\n\n  // Read file contents\n  return Promise.all(\n    files.map(async (file) => {\n      const text = await file.text();\n      let data: unknown;\n\n      try {\n        // Parse the contents as JSON\n        data = JSON.parse(text);\n      } catch {\n        throw new Error(\"File contents must be valid JSON\");\n      }\n\n      // If file has a name, return key/filename format\n      const filename =\n        \"name\" in file && file.name ? file.name.replace(\"files/\", \"\") : \"\";\n\n      //   console.log(\"mockStorage upload\", key, data, filename);\n\n      const hash = `${key}${filename ? `/${filename}` : \"\"}`;\n      mockStorage.set(hash, data);\n      return `ipfs://${hash}`;\n    }),\n  );\n}\n\n/**\n * Retrieves parsed JSON data from storage\n * @returns The parsed data object or undefined if not found\n */\nexport function getFromMockStorage(key: string): unknown {\n  const data = mockStorage.get(key);\n  //   console.log(\"mockStorage get\", key, data);\n  return data;\n}\n","import type { ThirdwebClient } from \"../../client/client.js\";\nimport { getThirdwebDomains } from \"../../utils/domains.js\";\nimport { getClientFetch } from \"../../utils/fetch.js\";\nimport { IS_TEST } from \"../../utils/process.js\";\nimport { addToMockStorage } from \"../mock.js\";\nimport type { UploadableFile, UploadOptions } from \"./types.js\";\n\nexport async function uploadBatch<const TFiles extends UploadableFile[]>(\n  client: ThirdwebClient,\n  form: FormData,\n  fileNames: string[],\n  options?: UploadOptions<TFiles>,\n) {\n  if (IS_TEST) {\n    return addToMockStorage(form);\n  }\n\n  const headers: HeadersInit = {};\n\n  const res = await getClientFetch(client)(\n    `https://${getThirdwebDomains().storage}/ipfs/upload`,\n    {\n      body: form,\n      headers,\n      method: \"POST\",\n      requestTimeoutMs:\n        client.config?.storage?.fetch?.requestTimeoutMs || 120000,\n      // force auth token usage for storage uploads\n      useAuthToken: true,\n    },\n  );\n\n  if (!res.ok) {\n    if (res.status === 401) {\n      throw new Error(\n        \"Unauthorized - You don't have permission to use this service.\",\n      );\n    }\n    if (res.status === 402) {\n      throw new Error(\n        \"You have reached your storage limit. Please add a valid payment method to continue using the service.\",\n      );\n    }\n    if (res.status === 403) {\n      throw new Error(\n        \"Forbidden - You don't have permission to use this service.\",\n      );\n    }\n    throw new Error(\n      `Failed to upload files to IPFS - ${res.status} - ${res.statusText}`,\n    );\n  }\n\n  const body = await res.json();\n\n  const cid = body.IpfsHash;\n  if (!cid) {\n    throw new Error(\"Failed to upload files to IPFS - Bad CID\");\n  }\n\n  if (options?.uploadWithoutDirectory) {\n    return [`ipfs://${cid}`];\n  }\n  return fileNames.map((name) => `ipfs://${cid}/${name}`);\n}\n"],"names":[],"mappings":"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"}