module.exports=[91154,a=>{"use strict";a.s(["connectSmartAccount",()=>a2,"disconnectSmartAccount",()=>a3,"getEntrypointFromFactory",()=>a7],36241);var b=a.i(71892),c=a.i(71932),d=a.i(38181),e=a.i(28961),f=a.i(63408);let g=[{name:"owner",type:"address"},{name:"spender",type:"address"}],h=[{type:"uint256"}];async function i(a){return(0,f.readContract)({contract:a.contract,method:["0xdd62ed3e",g,h],params:[a.owner,a.spender]})}var j=a.i(4163),k=a.i(13894);function l(a){let b;return()=>(b||(b=a()),b)}let m=[{name:"spender",type:"address"},{name:"value",type:"uint256"}],n=[{type:"bool"}];var o=a.i(8281),p=a.i(72683);let q=[{name:"signer",type:"address"}],r=[{components:[{name:"signer",type:"address"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"startTimestamp",type:"uint128"},{name:"endTimestamp",type:"uint128"}],name:"permissions",type:"tuple"}];async function s(a){return(0,f.readContract)({contract:a.contract,method:["0xf15d424e",q,r],params:[a.signer]})}let t=[{components:[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],name:"req",type:"tuple"},{name:"signature",type:"bytes"}],u=[];var v=a.i(13811);function w(){return new Date(Date.now()+31536e7)}function x(a){return(0,v.toBigInt)(Math.floor(a.getTime()/1e3))}var y=a.i(58826);let z=[{name:"signer",type:"address"},{name:"isAdmin",type:"uint8"},{name:"approvedTargets",type:"address[]"},{name:"nativeTokenLimitPerTransaction",type:"uint256"},{name:"permissionStartTimestamp",type:"uint128"},{name:"permissionEndTimestamp",type:"uint128"},{name:"reqValidityStartTimestamp",type:"uint128"},{name:"reqValidityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];async function A(a){let{account:b,contract:c,req:d}=a,e=await b.signTypedData({domain:{chainId:c.chain.id,name:"Account",verifyingContract:c.address,version:"1"},message:d,primaryType:"SignerPermissionRequest",types:{SignerPermissionRequest:z}});return{req:d,signature:e}}async function B(a){let{target:b,permissions:c}=a;return{approvedTargets:"*"===c.approvedTargets?[o.ZERO_ADDRESS]:c.approvedTargets,isAdmin:0,nativeTokenLimitPerTransaction:(0,j.toWei)(c.nativeTokenLimitPerTransaction?.toString()||"0"),permissionEndTimestamp:x(c.permissionEndTimestamp||w()),permissionStartTimestamp:x(c.permissionStartTimestamp||new Date(0)),reqValidityEndTimestamp:x(w()),reqValidityStartTimestamp:0n,signer:b,uid:await (0,y.randomBytesHex)()}}async function C(a){var b,c;let{accountContract:d,sessionKeyAddress:e,newPermissions:f}=a;if(!await (0,p.isContractDeployed)(d))return!0;let g=await s({contract:d,signer:e});return!!(g.endTimestamp&&g.endTimestamp<Math.floor(Date.now()/1e3)||(b=g.approvedTargets,!("*"===(c=f.approvedTargets)&&1===b.length&&b[0]===o.ZERO_ADDRESS||"*"!==c&&c.map(a=>a.toLowerCase()).every(a=>b.map(a=>a.toLowerCase()).includes(a))))||(0,j.toWei)(f.nativeTokenLimitPerTransaction?.toString()??"0")>g.nativeTokenLimitPerTransaction)}var D=a.i(63600),E=a.i(62713),F=a.i(30379),G=a.i(70529),H=a.i(53868),I=a.i(48302),J=a.i(77259);let K=2n**96n-1n;var L=a.i(84929),M=a.i(72694),N=a.i(76705),O=a.i(40302),P=a.i(66167),Q=a.i(52868),R=a.i(13166);let S=R.toSignatureHash;var T=a.i(12432),U=a.i(66323),V=a.i(56800),W=a.i(49601);let X="/docs/contract/decodeEventLog";var Y=a.i(32444),Z=a.i(85228);class $ extends Z.BaseError{constructor(a){super(`Filter type "${a}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}var _=a.i(62029),aa=a.i(48894),ab=a.i(30944);let ac="/docs/contract/encodeEventTopics";function ad({param:a,value:b}){if("string"===a.type||"bytes"===a.type)return(0,Q.keccak256)((0,P.toBytes)(b));if("tuple"===a.type||a.type.match(/^(.*)\[(\d+)?\]$/))throw new $(a.type);return(0,_.encodeAbiParameters)([a],[b])}function ae(a){let b,{signature:c}=a;return{abiEvent:b=c&&"object"==typeof c&&"type"in c&&"event"===c.type?c:(0,Y.parseAbiItem)(c),hash:(0,R.toSignatureHash)(b),topics:function(a){let{abi:b,eventName:c,args:d}=a,e=b[0];if(c){let a=function(a){let b,{abi:c,args:d=[],name:e}=a,f=(0,aa.isHex)(e,{strict:!1}),g=c.filter(a=>f?"function"===a.type?(0,ab.toFunctionSelector)(a)===e:"event"===a.type&&S(a)===e:"name"in a&&a.name===e);if(0!==g.length){if(1===g.length)return g[0];for(let a of g){if("inputs"in a){if(!d||0===d.length){if(!a.inputs||0===a.inputs.length)return a;continue}if(a.inputs&&0!==a.inputs.length&&a.inputs.length===d.length&&d.every((b,c)=>{let d="inputs"in a&&a.inputs[c];return!!d&&function a(b,c){let d=typeof b,e=c.type;switch(e){case"address":return(0,O.isAddress)(b,{strict:!1});case"bool":return"boolean"===d;case"function":case"string":return"string"===d;default:if("tuple"===e&&"components"in c)return Object.values(c.components).every((c,d)=>a(Object.values(b)[d],c));if(/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(e))return"number"===d||"bigint"===d;if(/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(e))return"string"===d||b instanceof Uint8Array;if(/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(e))return Array.isArray(b)&&b.every(b=>a(b,{...c,type:e.replace(/(\[[0-9]{0,}\])$/,"")}));return!1}}(b,d)})){if(b&&"inputs"in b&&b.inputs){let c=function a(b,c,d){for(let e in b){let f=b[e],g=c[e];if("tuple"===f.type&&"tuple"===g.type&&"components"in f&&"components"in g)return a(f.components,g.components,d[e]);let h=[f.type,g.type];if(h.includes("address")&&h.includes("bytes20")||(h.includes("address")&&h.includes("string")||h.includes("address")&&h.includes("bytes"))&&(0,O.isAddress)(d[e],{strict:!1}))return h}}(a.inputs,b.inputs,d);if(c)throw new M.AbiItemAmbiguityError({abiItem:a,type:c[0]},{abiItem:b,type:c[1]})}b=a}}}return b||g[0]}}({abi:b,name:c});if(!a)throw new M.AbiEventNotFoundError(c,{docsPath:ac});e=a}if("event"!==e.type)throw new M.AbiEventNotFoundError(void 0,{docsPath:ac});let f=S((0,W.formatAbiItem)(e)),g=[];if(d&&"inputs"in e){let a=e.inputs?.filter(a=>"indexed"in a&&a.indexed),b=Array.isArray(d)?d:Object.values(d).length>0?a?.map(a=>d[a.name])??[]:[];b.length>0&&(g=a?.map((a,c)=>Array.isArray(b[c])?b[c].map((d,e)=>ad({param:a,value:b[c][e]})):void 0!==b[c]&&null!==b[c]?ad({param:a,value:b[c]}):null)??[])}return[f,...g]}({abi:[b],args:a.filters})}}var af=a.i(7014),ag=a.i(17218),ah=a.i(80167),ai=a.i(78950),aj=a.i(26654);function ak(a){return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,null==b||(0,aj.isHex)(b)?b:(0,af.toHex)(b)]))}async function al(a){return as({...a,operation:"eth_sendUserOperation",params:[ak(a.userOp),a.options.entrypointAddress??ai.ENTRYPOINT_ADDRESS_v0_6]})}async function am(a,b){let c=await as({...a,operation:"eth_estimateUserOperationGas",params:[ak(a.userOp),a.options.entrypointAddress??ai.ENTRYPOINT_ADDRESS_v0_6,b??{}]});return{callGasLimit:(0,af.hexToBigInt)(c.callGasLimit)+ai.MANAGED_ACCOUNT_GAS_BUFFER,paymasterPostOpGasLimit:void 0!==c.paymasterPostOpGasLimit?(0,af.hexToBigInt)(c.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:void 0!==c.paymasterVerificationGasLimit?(0,af.hexToBigInt)(c.paymasterVerificationGasLimit):void 0,preVerificationGas:(0,af.hexToBigInt)(c.preVerificationGas),verificationGas:void 0!==c.verificationGas?(0,af.hexToBigInt)(c.verificationGas):void 0,verificationGasLimit:(0,af.hexToBigInt)(c.verificationGasLimit)}}async function an(a){let b=await as({...a,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxFeePerGas:(0,af.hexToBigInt)(b.maxFeePerGas),maxPriorityFeePerGas:(0,af.hexToBigInt)(b.maxPriorityFeePerGas)}}async function ao(a){let b=await ap(a);if(b){if(!1===b.success){let a=function(a){let{logs:b,events:c,strict:d}=a;return function(a){let{abi:b,args:c,logs:d,strict:e=!0}=a,f=(()=>{if(a.eventName)return Array.isArray(a.eventName)?a.eventName:[a.eventName]})();return d.map(a=>{try{let d=b.find(b=>"event"===b.type&&a.topics[0]===S(b));if(!d)return null;let g=function(a){let{abi:b,data:c,strict:d,topics:e}=a,f=d??!0,[g,...h]=e;if(!g)throw new M.AbiEventSignatureEmptyTopicsError({docsPath:X});let i=b.find(a=>"event"===a.type&&g===S((0,W.formatAbiItem)(a)));if(!(i&&"name"in i)||"event"!==i.type)throw new M.AbiEventSignatureNotFoundError(g,{docsPath:X});let{name:j,inputs:k}=i,l=k?.some(a=>!("name"in a&&a.name)),m=l?[]:{},n=k.map((a,b)=>[a,b]).filter(([a])=>"indexed"in a&&a.indexed);for(let a=0;a<n.length;a++){let[b,c]=n[a],d=h[a];if(!d)throw new M.DecodeLogTopicsMismatch({abiItem:i,param:b});m[l?c:b.name||c]=function({param:a,value:b}){return"string"===a.type||"bytes"===a.type||"tuple"===a.type||a.type.match(/^(.*)\[(\d+)?\]$/)?b:((0,V.decodeAbiParameters)([a],b)||[])[0]}({param:b,value:d})}let o=k.filter(a=>!("indexed"in a&&a.indexed));if(o.length>0){if(c&&"0x"!==c)try{let a=(0,V.decodeAbiParameters)(o,c);if(a)if(l)for(let b=0;b<k.length;b++)m[b]=m[b]??a.shift();else for(let b=0;b<o.length;b++)m[o[b].name]=a[b]}catch(a){if(f){if(a instanceof M.AbiDecodingDataSizeTooSmallError||a instanceof T.PositionOutOfBoundsError)throw new M.DecodeLogDataMismatch({abiItem:i,data:c,params:o,size:(0,U.size)(c)});throw a}}else if(f)throw new M.DecodeLogDataMismatch({abiItem:i,data:"0x",params:o,size:0})}return{eventName:j,args:Object.values(m).length>0?m:void 0}}({...a,abi:[d],strict:e});if(f&&!f.includes(g.eventName)||!function(a){let{args:b,inputs:c,matchArgs:d}=a;if(!d)return!0;if(!b)return!1;function e(a,b,c){try{if("address"===a.type){if(!(0,O.isAddress)(b,{strict:!1}))throw new N.InvalidAddressError({address:b});if(!(0,O.isAddress)(c,{strict:!1}))throw new N.InvalidAddressError({address:c});return b.toLowerCase()===c.toLowerCase()}if("string"===a.type||"bytes"===a.type)return(0,Q.keccak256)((0,P.toBytes)(b))===c;return b===c}catch{return!1}}return Array.isArray(b)&&Array.isArray(d)?d.every((a,d)=>{if(null==a)return!0;let f=c[d];return!!f&&(Array.isArray(a)?a:[a]).some(a=>e(f,a,b[d]))}):!("object"!=typeof b||Array.isArray(b)||"object"!=typeof d||Array.isArray(d))&&Object.entries(d).every(([a,d])=>{if(null==d)return!0;let f=c.find(b=>b.name===a);return!!f&&(Array.isArray(d)?d:[d]).some(c=>e(f,c,b[a]))})}({args:g.args,inputs:d.inputs,matchArgs:c}))return null;return{...g,...a}}catch(d){let b,c;if(d instanceof M.AbiEventSignatureNotFoundError)return null;if(d instanceof M.DecodeLogDataMismatch||d instanceof M.DecodeLogTopicsMismatch){if(e)return null;b=d.abiItem.name,c=d.abiItem.inputs?.some(a=>!("name"in a&&a.name))}return{...a,args:c?[]:{},eventName:b}}}).filter(Boolean)}({abi:c.map(a=>a.abiEvent),logs:b,strict:d})}({events:[function(a={}){return ae({filters:a,signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}(),function(a={}){return ae({filters:a,signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)"})}()],logs:b.logs}),c=a[0]?.args?.revertReason;if(!c)throw Error(`UserOp failed at txHash: ${b.receipt.transactionHash}`);let d=(0,L.decodeErrorResult)({data:c});throw Error(`UserOp failed with reason: '${d.args.join(",")}' at txHash: ${b.receipt.transactionHash}`)}return b.receipt}}async function ap(a){let b=await as({operation:"eth_getUserOperationReceipt",options:a,params:[a.userOpHash]});if(b)return function(a){let{receipt:b}=a,c={...b,blockNumber:b.blockNumber?BigInt(b.blockNumber):null,contractAddress:b.contractAddress?b.contractAddress:null,cumulativeGasUsed:b.cumulativeGasUsed?BigInt(b.cumulativeGasUsed):null,effectiveGasPrice:b.effectiveGasPrice?BigInt(b.effectiveGasPrice):null,gasUsed:b.gasUsed?BigInt(b.gasUsed):null,logs:b.logs,status:b.status,to:b.to?b.to:null,transactionHash:b.transactionHash,transactionIndex:b.transactionIndex,type:b.type};return b.blobGasPrice&&(c.blobGasPrice=BigInt(b.blobGasPrice)),b.blobGasUsed&&(c.blobGasUsed=BigInt(b.blobGasUsed)),{...a,actualGasCost:BigInt(a.actualGasCost),actualGasUsed:BigInt(a.actualGasUsed),nonce:BigInt(a.nonce),receipt:c,userOpHash:a.userOpHash}}(b)}async function aq(a){let b=await as({operation:"zk_paymasterData",options:a.options,params:[a.transaction]});return{paymaster:b.paymaster,paymasterInput:b.paymasterInput}}async function ar(a){return{transactionHash:(await as({operation:"zk_broadcastTransaction",options:a.options,params:[{...a.transaction,signedTransaction:a.signedTransaction}]})).transactionHash}}async function as(a){let{options:b,operation:c,params:d}=a,e=b.bundlerUrl??(0,ai.getDefaultBundlerUrl)(b.chain),f=(0,ag.getClientFetch)(b.client),g=await f(e,{useAuthToken:!0,body:(0,ah.stringify)({id:1,jsonrpc:"2.0",method:c,params:d}),headers:{"Content-Type":"application/json"},method:"POST"}),h=await g.json();if(!g.ok||h.error){let a=h.error||g.statusText;"object"==typeof a&&(a=(0,ah.stringify)(a));let b=h.code||"UNKNOWN";throw Error(`${c} error: ${a}
Status: ${g.status}
Code: ${b}`)}return h.result}var at=a.i(19151),au=a.i(74392),av=a.i(29664);let aw=[{name:"sender",type:"address"},{name:"key",type:"uint192"}],ax=[{name:"nonce",type:"uint256"}];async function ay(a){return(0,f.readContract)({contract:a.contract,method:["0x35567e1a",aw,ax],params:[a.sender,a.key]})}let az=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"callGasLimit",type:"uint256"},{name:"verificationGasLimit",type:"uint256"},{name:"preVerificationGas",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],aA=[{type:"bytes32"}];async function aB(a){return(0,f.readContract)({contract:a.contract,method:["0xa6193531",az,aA],params:[a.userOp]})}let aC=[{components:[{name:"sender",type:"address"},{name:"nonce",type:"uint256"},{name:"initCode",type:"bytes"},{name:"callData",type:"bytes"},{name:"accountGasLimits",type:"bytes32"},{name:"preVerificationGas",type:"uint256"},{name:"gasFees",type:"bytes32"},{name:"paymasterAndData",type:"bytes"},{name:"signature",type:"bytes"}],name:"userOp",type:"tuple"}],aD=[{type:"bytes32"}];async function aE(a){return(0,f.readContract)({contract:a.contract,method:["0x22cdde4c",aC,aD],params:[a.userOp]})}var aF=a.i(33847),aG=a.i(27492),aH=a.i(64352),aI=a.i(31059),aJ=a.i(94801),aK=a.i(95313),aL=a.i(21570);async function aM(a){let{userOp:b,paymasterOverride:c,client:d,chain:e,entrypointAddress:f}=a;if(c)return c(b);let g=f??ai.ENTRYPOINT_ADDRESS_v0_6,h=(0,ai.getDefaultBundlerUrl)(e),i={id:1,jsonrpc:"2.0",method:"pm_sponsorUserOperation",params:[ak(b),g]},j=(0,ag.getClientFetch)(d),k=await j(h,{body:(0,ah.stringify)(i),headers:{"Content-Type":"application/json"},method:"POST"});if(!k.ok){let a=await k.text()||k.statusText;throw Error(`Paymaster error: ${k.status} - ${a}`)}let l=await k.json();if(l.result)return"string"==typeof l.result?{paymasterAndData:l.result}:(l.result.reason&&console.warn(`Paymaster policy rejected this transaction with reason: ${l.result.reason} ${l.result.policyId?`(policyId: ${l.result.policyId})`:""}`),{callGasLimit:l.result.callGasLimit?(0,af.hexToBigInt)(l.result.callGasLimit):void 0,paymaster:l.result.paymaster,paymasterAndData:l.result.paymasterAndData,paymasterData:l.result.paymasterData,paymasterPostOpGasLimit:l.result.paymasterPostOpGasLimit?(0,af.hexToBigInt)(l.result.paymasterPostOpGasLimit):void 0,paymasterVerificationGasLimit:l.result.paymasterVerificationGasLimit?(0,af.hexToBigInt)(l.result.paymasterVerificationGasLimit):void 0,preVerificationGas:l.result.preVerificationGas?(0,af.hexToBigInt)(l.result.preVerificationGas):void 0,verificationGasLimit:l.result.verificationGasLimit?(0,af.hexToBigInt)(l.result.verificationGasLimit):void 0});let m=l.error?.message||l.error||k.statusText||"unknown error";throw Error(`Paymaster error from ${h}: ${m}`)}let aN=new Set,aO=a=>`${a.chain.id}:${a.address}`,aP=a=>{aN.add(aO(a))},aQ=a=>{aN.delete(aO(a))},aR=a=>aN.has(aO(a));async function aS(a){let b=a.timeoutMs||12e4,c=a.intervalMs||1e3,d=Date.now()+b;for(;Date.now()<d;){let b=await ao(a);if(b)return b;await new Promise(a=>setTimeout(a,c))}throw Error(`Timeout waiting for userOp to be mined on chain ${a.chain.id} with UserOp hash: ${a.userOpHash}`)}async function aT(a){let{transaction:b,accountContract:c,factoryContract:d,adminAddress:e,overrides:f,sponsorGas:g,waitForDeployment:h=!0,isDeployedOverride:i}=a,j=b.chain,k=b.client,l={bundlerUrl:f?.bundlerUrl,chain:j,client:k,entrypointAddress:f?.entrypointAddress},m=(0,ai.getEntryPointVersion)(a.overrides?.entrypointAddress||ai.ENTRYPOINT_ADDRESS_v0_6),[n,o,q,r,s]=await Promise.all(["boolean"==typeof i?i:(0,p.isContractDeployed)(c).then(a=>a||aR(c)),(0,aG.encode)(b),(0,I.resolvePromisedValue)(b.gas),aU({bundlerOptions:l,chain:j,client:k,executeTx:b}),a$({accountContract:c,chain:j,client:k,entrypointAddress:f?.entrypointAddress,getNonceOverride:f?.getAccountNonce})]),{maxFeePerGas:t,maxPriorityFeePerGas:u}=r;return"v0.7"===m?aV({accountContract:c,adminAddress:e,bundlerOptions:l,callData:o,callGasLimit:q,factoryContract:d,isDeployed:n,maxFeePerGas:t,maxPriorityFeePerGas:u,nonce:s,overrides:f,sponsorGas:g,waitForDeployment:h}):aW({accountContract:c,adminAddress:e,bundlerOptions:l,callData:o,callGasLimit:q,factoryContract:d,isDeployed:n,maxFeePerGas:t,maxPriorityFeePerGas:u,nonce:s,overrides:f,sponsorGas:g,waitForDeployment:h})}async function aU(a){let{executeTx:b,bundlerOptions:c,chain:d,client:e}=a,{maxFeePerGas:f,maxPriorityFeePerGas:g}=b,h=c?.bundlerUrl??(0,ai.getDefaultBundlerUrl)(d);if((0,ag.isThirdwebUrl)(h)){let a=await an({options:c});f=a.maxFeePerGas,g=a.maxPriorityFeePerGas}else{let[a,b]=await Promise.all([(0,I.resolvePromisedValue)(f),(0,I.resolvePromisedValue)(g)]);if(a&&b)f=a,g=b;else{let c=await (0,aF.getDefaultGasOverrides)(e,d);g=b??c.maxPriorityFeePerGas??0n,f=a??c.maxFeePerGas??0n}}return{maxFeePerGas:f,maxPriorityFeePerGas:g}}async function aV(a){let b,c,{bundlerOptions:d,isDeployed:e,factoryContract:f,accountContract:g,adminAddress:h,sponsorGas:i,overrides:j,nonce:k,callData:l,callGasLimit:m,maxFeePerGas:n,maxPriorityFeePerGas:o,waitForDeployment:p}=a,{chain:q,client:r}=d;e?(c="0x",p&&await a_(g)):(b=f.address,c=await (0,aG.encode)((0,at.prepareCreateAccount)({accountSalt:j?.accountSalt,adminAddress:h,createAccountOverride:j?.createAccount,factoryContract:f})),p&&aP(g));let s={callData:l,callGasLimit:m??0n,factory:b,factoryData:c,maxFeePerGas:n,maxPriorityFeePerGas:o,nonce:k,paymaster:void 0,paymasterData:"0x",paymasterPostOpGasLimit:0n,paymasterVerificationGasLimit:0n,preVerificationGas:0n,sender:g.address,signature:ai.DUMMY_SIGNATURE,verificationGasLimit:0n};if(i){let a=await aM({chain:q,client:r,entrypointAddress:j?.entrypointAddress,paymasterOverride:j?.paymaster,userOp:s});if(a.paymaster&&a.paymasterData&&(s.paymaster=a.paymaster,s.paymasterData=a.paymasterData),a.callGasLimit&&a.verificationGasLimit&&a.preVerificationGas&&a.paymasterPostOpGasLimit&&a.paymasterVerificationGasLimit)s.callGasLimit=a.callGasLimit,s.verificationGasLimit=a.verificationGasLimit,s.preVerificationGas=a.preVerificationGas,s.paymasterPostOpGasLimit=a.paymasterPostOpGasLimit,s.paymasterVerificationGasLimit=a.paymasterVerificationGasLimit;else{let a=j?.tokenPaymaster?{[j.tokenPaymaster.tokenAddress]:{stateDiff:{[(0,aJ.keccak256)((0,aH.encodeAbiParameters)([{type:"address"},{type:"uint256"}],[g.address,j.tokenPaymaster.balanceStorageSlot]))]:(0,af.toHex)(au.maxUint96,{size:32})}}}:void 0,b=await am({options:d,userOp:s},a);s.callGasLimit=b.callGasLimit,s.verificationGasLimit=b.verificationGasLimit,s.preVerificationGas=b.preVerificationGas,s.paymasterPostOpGasLimit=j?.tokenPaymaster?500000n:b.paymasterPostOpGasLimit||0n,s.paymasterVerificationGasLimit=b.paymasterVerificationGasLimit||0n;let c=await aM({chain:q,client:r,entrypointAddress:j?.entrypointAddress,paymasterOverride:j?.paymaster,userOp:s});c.paymaster&&c.paymasterData&&(s.paymaster=c.paymaster,s.paymasterData=c.paymasterData)}}else{let a=await am({options:d,userOp:s});s.callGasLimit=a.callGasLimit,s.verificationGasLimit=a.verificationGasLimit,s.preVerificationGas=a.preVerificationGas,s.paymasterPostOpGasLimit=a.paymasterPostOpGasLimit||0n,s.paymasterVerificationGasLimit=a.paymasterVerificationGasLimit||0n}return{...s,signature:"0x"}}async function aW(a){let b,{bundlerOptions:c,isDeployed:d,factoryContract:e,accountContract:f,adminAddress:g,sponsorGas:h,overrides:i,nonce:j,callData:k,callGasLimit:l,maxFeePerGas:m,maxPriorityFeePerGas:n,waitForDeployment:o}=a,{chain:p,client:q}=c;d?(b="0x",o&&await a_(f)):(b=await aZ({accountSalt:i?.accountSalt,adminAddress:g,createAccountOverride:i?.createAccount,factoryContract:e}),o&&aP(f));let r={callData:k,callGasLimit:l??0n,initCode:b,maxFeePerGas:m,maxPriorityFeePerGas:n,nonce:j,paymasterAndData:"0x",preVerificationGas:0n,sender:f.address,signature:ai.DUMMY_SIGNATURE,verificationGasLimit:0n};if(h){let a=await aM({chain:p,client:q,entrypointAddress:i?.entrypointAddress,paymasterOverride:i?.paymaster,userOp:r}),b="paymasterAndData"in a?a.paymasterAndData:"0x";if(b&&"0x"!==b&&(r.paymasterAndData=b),a.callGasLimit&&a.verificationGasLimit&&a.preVerificationGas)r.callGasLimit=a.callGasLimit,r.verificationGasLimit=a.verificationGasLimit,r.preVerificationGas=a.preVerificationGas;else{let a=await am({options:c,userOp:r});if(r.callGasLimit=a.callGasLimit,r.verificationGasLimit=a.verificationGasLimit,r.preVerificationGas=a.preVerificationGas,b&&"0x"!==b){let a=await aM({chain:p,client:q,entrypointAddress:i?.entrypointAddress,paymasterOverride:i?.paymaster,userOp:r}),b="paymasterAndData"in a?a.paymasterAndData:"0x";b&&"0x"!==b&&(r.paymasterAndData=b)}}}else{let a=await am({options:c,userOp:r});r.callGasLimit=a.callGasLimit,r.verificationGasLimit=a.verificationGasLimit,r.preVerificationGas=a.preVerificationGas}return{...r,signature:"0x"}}async function aX(a){let{userOp:b,chain:c,entrypointAddress:d,adminAccount:e}=a,f=await aY({chain:c,client:a.client,entrypointAddress:d,userOp:b});if(e.signMessage){let a=await e.signMessage({chainId:c.id,message:{raw:(0,aI.hexToBytes)(f)},originalMessage:(0,ah.stringify)(b)});return{...b,signature:a}}throw Error("signMessage not implemented in signingAccount")}async function aY(a){let b,{userOp:c,chain:d,entrypointAddress:f}=a;if("v0.7"===(0,ai.getEntryPointVersion)(f||ai.ENTRYPOINT_ADDRESS_v0_6)){let g={accountGasLimits:(0,av.concat)([(0,aK.pad)((0,aL.toHex)(BigInt(c.verificationGasLimit)),{size:16}),(0,aK.pad)((0,aL.toHex)(BigInt(c.callGasLimit)),{size:16})]),callData:c.callData,gasFees:(0,av.concat)([(0,aK.pad)((0,aL.toHex)(BigInt(c.maxPriorityFeePerGas)),{size:16}),(0,aK.pad)((0,aL.toHex)(BigInt(c.maxFeePerGas)),{size:16})]),initCode:c.factory?(0,av.concat)([c.factory,c.factoryData||"0x"]):"0x",nonce:BigInt(c.nonce),paymasterAndData:c.paymaster?(0,av.concat)([c.paymaster,(0,aK.pad)((0,aL.toHex)(BigInt(c.paymasterVerificationGasLimit||0)),{size:16}),(0,aK.pad)((0,aL.toHex)(BigInt(c.paymasterPostOpGasLimit||0)),{size:16}),c.paymasterData||"0x"]):"0x",preVerificationGas:BigInt(c.preVerificationGas),sender:c.sender,signature:c.signature};b=await aE({contract:(0,e.getContract)({address:f||ai.ENTRYPOINT_ADDRESS_v0_7,chain:d,client:a.client}),userOp:g})}else b=await aB({contract:(0,e.getContract)({address:f||ai.ENTRYPOINT_ADDRESS_v0_6,chain:d,client:a.client}),userOp:c});return b}async function aZ(a){let{factoryContract:b,adminAddress:c,accountSalt:d,createAccountOverride:e}=a,f=(0,at.prepareCreateAccount)({accountSalt:d,adminAddress:c,createAccountOverride:e,factoryContract:b});return(0,av.concat)([b.address,await (0,aG.encode)(f)])}async function a$(a){let b,c,d,f,g,h,{accountContract:i,chain:j,client:k,entrypointAddress:l,getNonceOverride:m}=a;return m?m(i):await ay({contract:(0,e.getContract)({address:l||ai.ENTRYPOINT_ADDRESS_v0_6,chain:j,client:k}),key:(b=BigInt(Math.floor(0x100000000*Math.random())),c=BigInt(Math.floor(0x100000000*Math.random())),d=BigInt(Math.floor(0x100000000*Math.random())),f=BigInt(Math.floor(0x100000000*Math.random())),g=BigInt(Math.floor(0x100000000*Math.random())),h=BigInt(Math.floor(0x100000000*Math.random())),b<<BigInt(160)|c<<BigInt(128)|d<<BigInt(96)|f<<BigInt(64)|g<<BigInt(32)|h),sender:i.address})}async function a_(a){let b=Date.now();for(;aR(a);){if(Date.now()-b>6e4)throw aQ(a),Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(a=>setTimeout(a,500))}}let a0=new WeakMap,a1=new WeakMap;async function a2(b,f){let{personalAccount:g,client:h}=b;if(!g)throw Error("No personal account provided for smart account connection");let i=f.chain,j="gasless"in f?f.gasless:f.sponsorGas;if(await (0,H.isZkSyncChain)(i))return[function(b){let{creationOptions:e,connectionOptions:f,chain:g}=b,h={address:(0,G.getAddress)(f.personalAccount.address),onTransactionRequested:async a=>f.personalAccount.onTransactionRequested?.(a),async sendTransaction(a){let i={chain:(0,d.getCachedChain)(a.chainId),client:f.client,data:a.data,eip712:a.eip712,to:a.to??void 0,value:a.value??0n},j=await (0,F.populateEip712Transaction)({account:h,transaction:i});if(b.sponsorGas&&!j.paymaster){let a=await aq({options:{bundlerUrl:e.overrides?.bundlerUrl,chain:g,client:f.client,entrypointAddress:e.overrides?.entrypointAddress},transaction:j});j={...j,...a}}let k=await (0,F.signEip712Transaction)({account:h,chainId:g.id,eip712Transaction:j}),l=await ar({options:{bundlerUrl:e.overrides?.bundlerUrl,chain:g,client:f.client,entrypointAddress:e.overrides?.entrypointAddress},signedTransaction:k,transaction:j});return(0,c.trackTransaction)({chainId:g.id,client:f.client,contractAddress:a.to??void 0,transactionHash:l.transactionHash,walletAddress:h.address,walletType:"smart"}),{chain:g,client:f.client,transactionHash:l.transactionHash}},signMessage:async({message:a})=>f.personalAccount.signMessage({message:a}),async signTypedData(a){let b,c=(b=a.domain,b?.chainId!==void 0&&J.validate(b.chainId)&&(a.domain={...a.domain,chainId:J.toNumber(a.domain.chainId)}),a);return f.personalAccount.signTypedData(c)},sendCalls:async b=>{let{inAppWalletSendCalls:c}=await a.A(98782),d=b.calls[0];if(!d)throw Error("No calls to send");let e=d.client,f=d.chain||b.chain,g=await c({account:h,calls:b.calls,chain:f});return{chain:f,client:e,id:g}},getCallsStatus:async b=>{let{inAppWalletGetCallsStatus:c}=await a.A(98782);return c(b)},getCapabilities:async a=>({[a.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:b.sponsorGas??!1}}})};return h}({chain:i,connectionOptions:b,creationOptions:f,sponsorGas:j}),i];if(f.factoryAddress&&!f.overrides?.entrypointAddress){let a=await a7(f.factoryAddress,h,i);a&&(f.overrides={...f.overrides,entrypointAddress:a})}f.overrides?.tokenPaymaster&&!f.overrides?.entrypointAddress&&(f.overrides={...f.overrides,entrypointAddress:ai.ENTRYPOINT_ADDRESS_v0_7});let m=f.factoryAddress??(0,ai.getDefaultAccountFactory)(f.overrides?.entrypointAddress),n=(0,e.getContract)({address:m,chain:i,client:h}),o=await (0,at.predictAddress)({accountAddress:f.overrides?.accountAddress,accountSalt:f.overrides?.accountSalt,adminAddress:g.address,factoryContract:n,predictAddressOverride:f.overrides?.predictAddress}).then(a=>a).catch(a=>{throw Error(`Failed to get account address with factory contract ${n.address} on chain ID ${i.id}: ${a?.message||"unknown error"}`,{cause:a})}),p=(0,e.getContract)({address:o,chain:i,client:h}),q=await a4({...f,accountContract:p,chain:i,client:h,factoryContract:n,personalAccount:g,sponsorGas:j});if(a0.set(g,q),a1.set(q,g),f.sessionKey&&await C({accountContract:p,newPermissions:f.sessionKey.permissions,sessionKeyAddress:f.sessionKey.address})){let a=function(a){var b;let c,{contract:d,sessionKeyAddress:e,account:f,permissions:g}=a;return b={async asyncParams(){let{req:a,signature:b}=await A({account:f,contract:d,req:await B({permissions:g,target:e})});return{req:a,signature:b}},contract:d},c=l(async()=>"asyncParams"in b?await b.asyncParams():b),(0,k.prepareContractCall)({accessList:async()=>(await c()).overrides?.accessList,authorizationList:async()=>(await c()).overrides?.authorizationList,contract:b.contract,erc20Value:async()=>(await c()).overrides?.erc20Value,extraGas:async()=>(await c()).overrides?.extraGas,gas:async()=>(await c()).overrides?.gas,gasPrice:async()=>(await c()).overrides?.gasPrice,maxFeePerGas:async()=>(await c()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await c()).overrides?.maxPriorityFeePerGas,method:["0x5892e236",t,u],nonce:async()=>(await c()).overrides?.nonce,params:async()=>{let a=await c();return[a.req,a.signature]},value:async()=>(await c()).overrides?.value})}({account:g,contract:p,permissions:f.sessionKey.permissions,sessionKeyAddress:f.sessionKey.address});await (0,D.sendTransaction)({account:q,transaction:a})}return[q,i]}async function a3(a){let b=a1.get(a);b&&(a0.delete(b),a1.delete(a))}async function a4(b){let f=b.overrides?.tokenPaymaster;if(f&&"v0.7"!==(0,ai.getEntryPointVersion)(b.overrides?.entrypointAddress||ai.ENTRYPOINT_ADDRESS_v0_6))throw Error("Token paymaster is only supported for entrypoint version v0.7");let g=b.sponsorGas,h=b.accountContract,i={address:(0,G.getAddress)(h.address),onTransactionRequested:async a=>b.personalAccount.onTransactionRequested?.(a),async sendBatchTransaction(a){let e=(0,at.prepareBatchExecute)({accountContract:h,executeBatchOverride:b.overrides?.executeBatch,transactions:a});if(0===a.length)throw Error("No transactions to send");let f=a[0];if(!f)throw Error("No transactions to send");let g=(0,d.getCachedChain)(f.chainId),i=await a6({executeTx:e,options:{...b,accountContract:h,chain:g}});return(0,c.trackTransaction)({chainId:g.id,client:b.client,contractAddress:a[0]?.to??void 0,transactionHash:i.transactionHash,walletAddress:b.accountContract.address,walletType:"smart"}),i},async sendTransaction(a){let g;if(f){await a5({accountContract:h,erc20Paymaster:f,options:b});let a=async()=>({paymaster:f.paymasterAddress,paymasterData:"0x"});g=b.overrides?.paymaster||a}else g=b.overrides?.paymaster;a.chainId!==h.chain.id&&(h=(0,e.getContract)({address:i.address,chain:(0,d.getCachedChain)(a.chainId),client:b.client}));let j=(0,at.prepareExecute)({accountContract:h,executeOverride:b.overrides?.execute,transaction:a}),k=(0,d.getCachedChain)(a.chainId),l=await a6({executeTx:j,options:{...b,accountContract:h,chain:k,overrides:{...b.overrides,paymaster:g}}});return(0,c.trackTransaction)({chainId:k.id,client:b.client,contractAddress:a.to??void 0,transactionHash:l.transactionHash,walletAddress:b.accountContract.address,walletType:"smart"}),l},async signMessage({message:c}){if(b.overrides?.signMessage)return b.overrides.signMessage({accountContract:h,adminAccount:b.personalAccount,factoryContract:b.factoryContract,message:c});let{smartAccountSignMessage:d}=await a.A(4671);return d({accountContract:h,factoryContract:b.factoryContract,message:c,options:b})},async signTypedData(c){if(b.overrides?.signTypedData)return b.overrides.signTypedData({accountContract:h,adminAccount:b.personalAccount,factoryContract:b.factoryContract,typedData:c});let{smartAccountSignTypedData:d}=await a.A(4671);return d({accountContract:h,factoryContract:b.factoryContract,options:b,typedData:c})},sendCalls:async b=>{let{inAppWalletSendCalls:c}=await a.A(98782),d=b.calls[0];if(!d)throw Error("No calls to send");let e=d.client,f=d.chain||b.chain,g=await c({account:i,calls:b.calls,chain:f});return{chain:f,client:e,id:g}},getCallsStatus:async b=>{let{inAppWalletGetCallsStatus:c}=await a.A(98782);return c(b)},getCapabilities:async a=>({[a.chainId??1]:{atomic:{status:"supported"},paymasterService:{supported:g??!1}}})};return i}async function a5(b){var c,d;let f,{accountContract:g,erc20Paymaster:h,options:o}=b,p=h.tokenAddress,q=(0,e.getContract)({address:p,chain:g.chain,client:g.client});if(await i({contract:q,owner:g.address,spender:h.paymasterAddress})>0n)return;let r=(d={asyncParams:async()=>{let b;if("amount"in c){let{decimals:d}=await a.A(1552),e=await d(c).catch(()=>18);b=(0,j.toUnits)(c.amount.toString(),e)}else b=c.amountWei;return{overrides:{erc20Value:{amountWei:b,tokenAddress:c.contract.address},...c.overrides},spender:c.spender,value:b}},contract:(c={amountWei:K-1n,contract:q,spender:h.paymasterAddress}).contract},f=l(async()=>"asyncParams"in d?await d.asyncParams():d),(0,k.prepareContractCall)({accessList:async()=>(await f()).overrides?.accessList,authorizationList:async()=>(await f()).overrides?.authorizationList,contract:d.contract,erc20Value:async()=>(await f()).overrides?.erc20Value,extraGas:async()=>(await f()).overrides?.extraGas,gas:async()=>(await f()).overrides?.gas,gasPrice:async()=>(await f()).overrides?.gasPrice,maxFeePerGas:async()=>(await f()).overrides?.maxFeePerGas,maxPriorityFeePerGas:async()=>(await f()).overrides?.maxPriorityFeePerGas,method:["0x095ea7b3",m,n],nonce:async()=>(await f()).overrides?.nonce,params:async()=>{let a=await f();return[a.spender,a.value]},value:async()=>(await f()).overrides?.value})),s=await (0,E.toSerializableTransaction)({from:g.address,transaction:r}),t=(0,at.prepareExecute)({accountContract:g,executeOverride:o.overrides?.execute,transaction:s});await a6({executeTx:t,options:{...o,overrides:{...o.overrides,tokenPaymaster:void 0}}})}async function a6(a){let{executeTx:d,options:e}=a;try{let a=await aT({accountContract:e.accountContract,adminAddress:e.personalAccount.address,factoryContract:e.factoryContract,overrides:e.overrides,sponsorGas:e.sponsorGas,transaction:d}),b=await aX({adminAccount:e.personalAccount,chain:e.chain,client:e.client,entrypointAddress:e.overrides?.entrypointAddress,userOp:a}),f={bundlerUrl:e.overrides?.bundlerUrl,chain:e.chain,client:e.client,entrypointAddress:e.overrides?.entrypointAddress},g=await al({options:f,userOp:b}),h=await aS({...f,userOpHash:g});return(0,c.trackTransaction)({chainId:e.chain.id,client:e.client,contractAddress:await (0,I.resolvePromisedValue)(d.to??void 0),transactionHash:h.transactionHash,walletAddress:e.accountContract.address,walletType:"smart"}),{chain:e.chain,client:e.client,transactionHash:h.transactionHash}}catch(a){throw(0,b.isInsufficientFundsError)(a)&&(0,c.trackInsufficientFundsError)({chainId:e.chain.id,client:e.client,contractAddress:await (0,I.resolvePromisedValue)(d.to??void 0),error:a,transactionValue:await (0,I.resolvePromisedValue)(d.value),walletAddress:e.accountContract.address}),a}finally{aQ(e.accountContract)}}async function a7(a,b,c){let d=(0,e.getContract)({address:a,chain:c,client:b});try{return await (0,f.readContract)({contract:d,method:"function entrypoint() public view returns (address)"})}catch{return}}a.i(36241);var a8=a.i(8140);a.s(["connectSmartAccount",()=>a2,"disconnectSmartAccount",()=>a3,"getEntrypointFromFactory",()=>a7,"isSmartWallet",()=>a8.isSmartWallet],91154)}];

//# sourceMappingURL=node_modules_thirdweb_dist_esm_wallets_smart_index_250bec9d.js.map