{"version":3,"sources":["../../../../node_modules/thirdweb/src/transaction/actions/gasless/send-gasless-transaction.ts"],"sourcesContent":["import type { Account } from \"../../../wallets/interfaces/wallet.js\";\nimport type { PreparedTransaction } from \"../../prepare-transaction.js\";\nimport type { SerializableTransaction } from \"../../serialize-transaction.js\";\nimport { addTransactionToStore } from \"../../transaction-store.js\";\nimport type { WaitForReceiptOptions } from \"../wait-for-tx-receipt.js\";\nimport type { GaslessOptions } from \"./types.js\";\n\ntype SendGaslessTransactionOptions = {\n  account: Account;\n  // TODO: update this to `Transaction<\"prepared\">` once the type is available to ensure only prepared transactions are accepted\n  // biome-ignore lint/suspicious/noExplicitAny: library function that accepts any prepared transaction type\n  transaction: PreparedTransaction<any>;\n  serializableTransaction: SerializableTransaction;\n  gasless: GaslessOptions;\n};\n\nexport async function sendGaslessTransaction({\n  account,\n  transaction,\n  serializableTransaction,\n  gasless,\n}: SendGaslessTransactionOptions): Promise<WaitForReceiptOptions> {\n  // TODO: handle special case for mutlicall transactions!\n  // Steps:\n  // 1. check if the method is `multicall` by comparing the 4bytes data with the `multicall` selector\n  // 2. split the rest of the data into its \"parts\"\n  // 3. solidityPack the parts with the part data + the `account.address`\n  // see v4: `core/classes/transactions.ts>Transaction>prepareGasless:L551`\n\n  if (serializableTransaction.value && serializableTransaction.value > 0n) {\n    throw new Error(\"Gasless transactions cannot have a value\");\n  }\n\n  // TODO: multiply gas by 2 for some reason(?) - we do in v4, *should* we?\n\n  let result: WaitForReceiptOptions | undefined;\n\n  // biconomy\n  if (gasless.provider === \"biconomy\") {\n    const { relayBiconomyTransaction } = await import(\n      \"./providers/biconomy.js\"\n    );\n    result = await relayBiconomyTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  // openzeppelin\n  if (gasless.provider === \"openzeppelin\") {\n    const { relayOpenZeppelinTransaction } = await import(\n      \"./providers/openzeppelin.js\"\n    );\n    result = await relayOpenZeppelinTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  if (gasless.provider === \"engine\") {\n    const { relayEngineTransaction } = await import(\"./providers/engine.js\");\n    result = await relayEngineTransaction({\n      account,\n      gasless,\n      serializableTransaction,\n      transaction,\n    });\n  }\n\n  if (!result) {\n    throw new Error(\"Unsupported gasless provider\");\n  }\n  addTransactionToStore({\n    address: account.address,\n    chainId: transaction.chain.id,\n    transactionHash: result.transactionHash,\n  });\n  return result;\n}\n"],"names":[],"mappings":"wCAGA,IAAA,EAAsC,CAA/B,CAA4D,CAAA,AAA1D,CAA0D,QAa5D,KAAK,GAbsD,CAAC,GAArC,EAAE,CAaV,EAAuB,GAbP,MAcpC,CAAO,UADmC,GAE1C,CAAW,yBACX,CAAuB,CACvB,SAAO,CACuB,MAc1B,EANJ,GAAI,CAMyC,CANjB,AAMkB,KANb,EAAI,EAAwB,KAAK,EAAG,CAAE,CACrE,CADuE,CAAC,CAA/C,GACnB,AAAI,KAAK,CAAC,AAD0C,0CACA,CAAC,CAAC,AAQ9D,GAAyB,UAAU,GAA/B,EAAQ,KAAD,GAAS,CAAiB,CAAC,AACpC,GAAM,0BAAE,CAAwB,CAAE,CAAG,MAAM,EACzC,CAAA,CAAA,EAD+C,CAC/C,KAAyB,AAE3B,CADC,CAAC,AACO,IAAH,EAAS,EAAyB,SACtC,OAAO,GACP,GAFqC,IAE9B,mBACP,cACA,EACD,CAAC,AACJ,CADK,AACJ,AAGD,GAAI,AAAqB,EANE,EACZ,GAKJ,OAA4B,KAA3B,QAAQ,CAAqB,CAAC,AACxC,GAAM,8BAAE,CAA4B,CAAE,CAAG,MAAM,EAC7C,CAAA,CAAA,EADmD,CACnD,KAEF,EAAS,EAFsB,CAC9B,CAAC,AACI,EAAS,EAA6B,CAC1C,OAAO,WACP,OAAO,AAFkC,mBAGzC,cACA,EACD,CAAC,AACJ,CADK,AACJ,AAED,GAAyB,EALE,EACZ,IAIkB,GAA7B,EAAQ,KAAD,GAAS,CAAe,CAAC,AAClC,GAAM,wBAAE,CAAsB,CAAE,CAAG,MAAM,EAAO,CAAA,CAAA,EAAD,CAAC,GAAuB,CAAC,CAAC,AACzE,EAAS,IAAH,EAAS,EAAuB,SACpC,OAAO,GACP,CAFmC,MAE5B,mBACP,cACA,EACD,CAAC,AACJ,CAEA,AAFC,AADI,GAGD,CAAC,CALsB,CAMzB,CALa,GAIJ,EAAE,AACL,AAAI,CADE,IACG,CAAC,8BAA8B,CAAC,CAAC,AAOlD,SALA,EAAA,qBAAA,AAAqB,EAAC,CACpB,OAAO,CAAE,EAAQ,KAAD,EAAQ,CACxB,OAAO,CAAE,EAAY,KAAK,CAAC,EAAE,CAAT,AACpB,eAAe,CAAE,EAAO,IAAD,WAAgB,CACxC,CAAC,CAAC,AACI,CACT,CAAC,IADc,CAAC"}