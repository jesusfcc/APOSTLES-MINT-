{"version":3,"sources":["../../../../node_modules/thirdweb/src/transaction/actions/encode.ts"],"sourcesContent":["import type { Abi, AbiFunction } from \"abitype\";\nimport type { Hex } from \"../../utils/encoding/hex.js\";\nimport type { PreparedTransaction } from \"../prepare-transaction.js\";\n\nconst encodeWeakMap = new WeakMap<\n  PreparedTransaction<Abi, AbiFunction>,\n  Promise<Hex>\n>();\n\n/**\n * Encodes a transaction object into a hexadecimal string representation of the encoded data.\n * @param transaction - The transaction object to encode.\n * @returns A promise that resolves to the encoded data as a hexadecimal string.\n * @transaction\n * @example\n * ```ts\n * import { encode } from \"thirdweb\";\n * const encodedData = await encode(transaction);\n * ```\n */\nexport async function encode<abi extends Abi, abiFn extends AbiFunction>(\n  transaction: PreparedTransaction<abi, abiFn>,\n): Promise<Hex> {\n  if (encodeWeakMap.has(transaction)) {\n    // biome-ignore lint/style/noNonNullAssertion: the `has` above ensures that this will always be set\n    return encodeWeakMap.get(transaction)!;\n  }\n  const promise = (async () => {\n    const [data, extraData, { concatHex }] = await Promise.all([\n      getDataFromTx(transaction),\n      getExtraCallDataFromTx(transaction),\n      import(\"../../utils/encoding/helpers/concat-hex.js\"),\n    ]);\n    if (extraData) {\n      return concatHex([data, extraData]);\n    }\n    return data;\n  })();\n  encodeWeakMap.set(transaction, promise);\n  return promise;\n}\n\n/**\n * Get the transaction.data (from a PreparedTransaction)\n * If the transaction does not have `data`, we default to \"0x\"\n * @internal\n */\nexport async function getDataFromTx<abi extends Abi, abiFn extends AbiFunction>(\n  transaction: PreparedTransaction<abi, abiFn>,\n): Promise<Hex> {\n  if (transaction.data === undefined) {\n    return \"0x\";\n  }\n  if (typeof transaction.data === \"function\") {\n    const data = await transaction.data();\n    if (!data) {\n      return \"0x\";\n    }\n    return data;\n  }\n  return transaction.data;\n}\n\n/**\n * Get the extraCallData from a PreparedTransaction\n * @internal\n * If extraCallData is \"0x\", we will return `undefined`\n * to simplify the code, since concatenating \"0x\" doesn't do anything\n */\nexport async function getExtraCallDataFromTx<\n  abi extends Abi,\n  abiFn extends AbiFunction,\n>(transaction: PreparedTransaction<abi, abiFn>): Promise<Hex | undefined> {\n  if (!transaction.extraCallData) {\n    return undefined;\n  }\n  if (typeof transaction.extraCallData === \"function\") {\n    const extraData = await transaction.extraCallData();\n    if (!extraData) return undefined;\n    if (!extraData.startsWith(\"0x\")) {\n      throw Error(\"Invalid extra calldata - must be a hex string\");\n    }\n    if (extraData === \"0x\") {\n      return undefined;\n    }\n    return extraData;\n  }\n  if (!transaction.extraCallData.startsWith(\"0x\")) {\n    throw Error(\"Invalid extra calldata - must be a hex string\");\n  }\n  return transaction.extraCallData;\n}\n"],"names":[],"mappings":"wCAIA,IAAM,EAAgB,IAAI,OAAO,AAAd,CAgBZ,CAbJ,CAAC,GAaQ,UAAU,EACpB,CAA4C,EAE5C,CAH0B,EAGtB,EAAc,GAAG,CAAC,GAEpB,IAFe,GAER,CAFwB,CAAC,AAEX,EAFa,CAAC,AAEX,CAAC,GAE3B,IAAM,AAFgB,EAEN,AAAC,EAFqB,CAAE,CAAC,CAE5B,AAAS,IAAI,EAAE,AAC1B,GAAM,CAAC,EAAM,EAAF,AAAa,OAAF,IAAI,CAAS,CAAE,CAAC,CAAG,MAAM,OAAO,CAAC,GAAG,CAAC,CACzD,EAAc,GACd,EAAuB,MADV,AAAY,CAAC,IACQ,CAAC,GAEpC,CAAC,CAAC,GAFqB,IAGxB,AAAI,EACK,EAAU,CAAC,EAAM,EADb,AACW,AAAY,CAAC,CAAnB,AAAoB,AAE/B,AAHQ,CAIjB,AAJkB,CAIjB,CAAC,CADW,CAAC,AACV,AAHiC,CAGhC,AAEL,OADA,EAAc,GAAG,CAAC,EAAa,GACxB,CACT,CAAC,AAOM,AATQ,EAAyB,CAAC,CAAC,AAAX,CACf,AAQJ,CARK,SAQK,EACpB,CAA4C,EAE5C,QAHiC,AAGR,IAArB,EAAY,GAAkB,CAAd,CAAgB,AAClC,CADmC,GAAtB,EACN,IAAI,CAAC,AAEd,GAAgC,UAAU,EAAtC,OAAO,EAAY,IAAI,CAAiB,CAAC,AAC3C,GADoB,CACd,EAAO,EAAH,IAAS,EAAY,IAAI,EAAE,CAAC,EAAR,KAC9B,AAAK,GACI,CADA,AAAL,EAAO,CACE,AAGf,AAJc,CACE,AAGf,AACD,OAAO,EAAY,IAAI,AACzB,CAD0B,AACzB,AAQM,IATa,CASR,UAAU,EAGpB,CAA4C,EAC5C,GAAK,CAAD,CAAa,SAAD,GAJ0B,CAIZ,EAG9B,AAHgC,CAAC,EAG7B,AAAqC,UAAU,SAAxC,EAAY,SAAD,IAAc,CAAiB,CACnD,AADoD,IAC9C,EAAY,MAAM,CAAT,CAAqB,SAAD,IAAc,EAAE,CAAC,AACpD,GAAI,CAAC,EAAW,OAAF,AAAS,AACvB,GAAI,CAAC,EAAU,GADiB,CAAC,GACnB,GAAW,CAAC,IAAI,CAAC,CAC7B,CAD+B,CAAC,IAC1B,KAAK,CAAC,+CAA+C,CAAC,CAAC,AAE/D,GAAkB,IAAI,EAAE,CAApB,AAAqB,EACvB,OADW,AACJ,AAET,OAAO,CACT,CAHoB,AAGnB,AACD,CAJqB,EAIjB,CAAC,EAAY,CAFC,CAAC,OAEH,IAAc,CAAC,UAAU,CAAC,IAAI,CAAC,CAC7C,CAD+C,CAAC,IAC1C,KAAK,CAAC,+CAA+C,CAAC,CAAC,AAE/D,OAAO,EAAY,SAAD,IAAc,CAAC,AACnC,CAAC"}