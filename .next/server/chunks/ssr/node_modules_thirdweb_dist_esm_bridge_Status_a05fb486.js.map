{"version":3,"sources":["../../../../node_modules/thirdweb/src/bridge/Status.ts"],"sourcesContent":["import type { Hex as ox__Hex } from \"ox\";\nimport type { Chain } from \"../chains/types.js\";\nimport type { ThirdwebClient } from \"../client/client.js\";\nimport { getThirdwebBaseUrl } from \"../utils/domains.js\";\nimport { getClientFetch } from \"../utils/fetch.js\";\nimport { ApiError } from \"./types/Errors.js\";\nimport type { Status } from \"./types/Status.js\";\n\n/**\n * Retrieves a Bridge quote for the provided sell intent. The quote will specify the expected `destinationAmount` that will be received in exchange for the specified `originAmount`, which is specified with the `sellAmountWei` option.\n *\n * The returned status will include both the origin and destination transactions and any finalized amounts for the route.\n *\n * @example\n * ```typescript\n * import { Bridge } from \"thirdweb\";\n *\n * const status = await Bridge.status({\n *   transactionHash: \"0xe199ef82a0b6215221536e18ec512813c1aa10b4f5ed0d4dfdfcd703578da56d\",\n *   chainId: 8453,\n *   client: thirdwebClient,\n * });\n * ```\n *\n * If the transaction is complete, a response might look like:\n * ```typescript\n * {\n *   status: 'COMPLETED',\n *   originAmount: 200000000000000n,\n *   destinationAmount: 188625148000000n,\n *   originChainId: 8453,\n *   destinationChainId: 2741,\n *   originTokenAddress: '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE',\n *   destinationTokenAddress: '0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE',\n *   transactions: [\n *     {\n *       chainId: 8453,\n *       transactionHash: '0xe199ef82a0b6215221536e18ec512813c1aa10b4f5ed0d4dfdfcd703578da56d'\n *     },\n *     {\n *       chainId: 2741,\n *       transactionHash: '0xa70a82f42330f54be95a542e1fcfe6ed2dd9f07fb8c82ae67afb4342319f7433'\n *     }\n *   ],\n *   purchaseData: {\n *     foo: \"bar\"\n *   }\n * }\n * ```\n *\n * If the origin transaction hasn't been mined yet, a response might look like:\n * ```typescript\n * {\n *   status: \"NOT_FOUND\",\n * }\n * ```\n * This is to allow you to poll for the status without catching an error. Be sure your transaction hash and chain are correct though, as this could also represent a legitimate 404 if the transaction doesn't exist.\n *\n * If the transaction is still pending, a response might look like:\n * ```typescript\n * {\n *   status: \"PENDING\",\n *   originAmount: 1000000000000000000n,\n *   originChainId: 466,\n *   destinationChainId: 1,\n *   originTokenAddress: \"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE\",\n *   destinationTokenAddress: \"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE\",\n *   transactions: [\n *     {\n *       transactionHash: \"0xe199ef82a0b6215221536e18ec512813c1aa10b4f5ed0d4dfdfcd703578da56d\",\n *       chainId: 466,\n *     }\n *   ]\n * }\n * ```\n *\n * If the transaction failed, a response might look like:\n * ```typescript\n * {\n *   status: \"FAILED\",\n *   transactions: [\n *     {\n *       transactionHash: \"0xe199ef82a0b6215221536e18ec512813c1aa10b4f5ed0d4dfdfcd703578da56d\",\n *       chainId: 466,\n *     }\n *   ]\n * }\n * ```\n *\n * This status is for a **single origin transaction only**. If your route involves multiple transactions, you'll need to get the status for each of them individually.\n *\n * If sending multiple dependent sequential transactions, wait until `status` returns `COMPLETED` before sending the next transaction.\n *\n * You can access this function's input and output types with `status.Options` and `status.Result`, respectively.\n *\n * @param options - The options for the quote.\n * @param options.transactionHash - The hash of the origin transaction to get the bridge status for.\n * @param options.chainId - The chain ID of the origin token.\n * @param options.transactionId - The transaction ID received from the `prepare` request.\n * @param options.client - Your thirdweb client.\n *\n * @returns A promise that resolves to a status object for the transaction.\n *\n * @throws Will throw an error if there is an issue fetching the status.\n * @bridge\n * @beta\n */\nexport async function status(options: status.Options): Promise<status.Result> {\n  const { transactionHash, client, transactionId } = options;\n  const chainId = \"chainId\" in options ? options.chainId : options.chain.id;\n\n  const clientFetch = getClientFetch(client);\n  const url = new URL(`${getThirdwebBaseUrl(\"bridge\")}/v1/status`);\n  url.searchParams.set(\"transactionHash\", transactionHash);\n  url.searchParams.set(\"chainId\", chainId.toString());\n  if (transactionId) {\n    url.searchParams.set(\"transactionId\", transactionId);\n  }\n\n  const response = await clientFetch(url.toString());\n  if (!response.ok) {\n    const errorJson = await response.json();\n    throw new ApiError({\n      code: errorJson.code || \"UNKNOWN_ERROR\",\n      correlationId: errorJson.correlationId || undefined,\n      message: errorJson.message || response.statusText,\n      statusCode: response.status,\n    });\n  }\n\n  const { data }: { data: Status } = await response.json();\n  if (data.status === \"FAILED\") {\n    return {\n      paymentId: data.paymentId,\n      status: \"FAILED\",\n      transactions: data.transactions,\n    };\n  }\n\n  if (data.status === \"PENDING\") {\n    return {\n      destinationChainId: data.destinationChainId,\n      destinationToken: data.destinationToken,\n      destinationTokenAddress: data.destinationTokenAddress,\n      originAmount: BigInt(data.originAmount),\n      originChainId: data.originChainId,\n      originToken: data.originToken,\n      originTokenAddress: data.originTokenAddress,\n      paymentId: data.paymentId,\n      purchaseData: data.purchaseData,\n      receiver: data.receiver,\n      sender: data.sender,\n      status: \"PENDING\",\n      transactions: data.transactions,\n    };\n  }\n\n  if (data.status === \"NOT_FOUND\") {\n    return {\n      paymentId: data.paymentId,\n      status: \"NOT_FOUND\",\n      transactions: [],\n    };\n  }\n\n  return {\n    destinationAmount: BigInt(data.destinationAmount),\n    destinationChainId: data.destinationChainId,\n    destinationToken: data.destinationToken,\n    destinationTokenAddress: data.destinationTokenAddress,\n    originAmount: BigInt(data.originAmount),\n    originChainId: data.originChainId,\n    originToken: data.originToken,\n    originTokenAddress: data.originTokenAddress,\n    paymentId: data.paymentId,\n    purchaseData: data.purchaseData,\n    receiver: data.receiver,\n    sender: data.sender,\n    status: \"COMPLETED\",\n    transactions: data.transactions,\n  };\n}\n\n/**\n * Namespace containing types for the status function.\n * @namespace status\n * @bridge\n */\nexport declare namespace status {\n  /**\n   * Options for checking transaction status.\n   * Can specify either chainId or chain object.\n   * @interface Options\n   * @bridge\n   */\n  type Options =\n    | {\n        /** The transaction hash to check status for */\n        transactionHash: ox__Hex.Hex;\n        /** The chain ID where the transaction occurred */\n        chainId: number;\n        /** The transaction ID received from the `prepare` request */\n        transactionId?: string;\n        /** Your thirdweb client */\n        client: ThirdwebClient;\n      }\n    | {\n        /** The transaction hash to check status for */\n        transactionHash: ox__Hex.Hex;\n        /** The chain object where the transaction occurred */\n        chain: Chain;\n        /** The transaction ID received from the `prepare` request */\n        transactionId?: string;\n        /** Your thirdweb client */\n        client: ThirdwebClient;\n      };\n\n  /**\n   * Result returned from checking transaction status.\n   * Contains the current status and transaction details.\n   * @interface Result\n   * @bridge\n   */\n  type Result = Status;\n}\n"],"names":[],"mappings":"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"}