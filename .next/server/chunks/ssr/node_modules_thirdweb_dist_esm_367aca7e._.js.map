{"version":3,"sources":["../../../../node_modules/thirdweb/src/transaction/actions/send-batch-transaction.ts","../../../../node_modules/thirdweb/src/wallets/in-app/core/eip5792/in-app-wallet-calls.ts","../../../../node_modules/thirdweb/src/transaction/actions/send-and-confirm-transaction.ts"],"sourcesContent":["import { resolvePromisedValue } from \"../../utils/promise/resolve-promised-value.js\";\nimport type {\n  Account,\n  SendTransactionOption,\n} from \"../../wallets/interfaces/wallet.js\";\nimport { encode } from \"./encode.js\";\nimport type { SendTransactionOptions } from \"./send-transaction.js\";\nimport type { WaitForReceiptOptions } from \"./wait-for-tx-receipt.js\";\n\nexport type SendBatchTransactionOptions = {\n  transactions: SendTransactionOptions[\"transaction\"][];\n  account: Account;\n};\n\n/**\n * Sends a batch transaction using the provided options.\n * @param options - The options for sending the batch transaction.\n * @returns A promise that resolves to the options for waiting for the receipt of the first transaction in the batch.\n * @throws An error if the account is not connected, there are no transactions to send, or the account does not implement sendBatchTransaction.\n * @transaction\n * @example\n * ```ts\n * import { sendBatchTransaction } from \"thirdweb\";\n *\n * const waitForReceiptOptions = await sendBatchTransaction({\n *  account,\n *  transactions\n * });\n * ```\n */\nexport async function sendBatchTransaction(\n  options: SendBatchTransactionOptions,\n): Promise<WaitForReceiptOptions> {\n  const { account, transactions } = options;\n  if (!account) {\n    throw new Error(\"not connected\");\n  }\n  if (transactions.length === 0) {\n    throw new Error(\"No transactions to send\");\n  }\n  const firstTx = transactions[0];\n  if (!firstTx) {\n    throw new Error(\"No transactions to send\");\n  }\n  if (account.sendBatchTransaction) {\n    const serializedTxs: SendTransactionOption[] = await Promise.all(\n      transactions.map(async (tx) => {\n        // no need to estimate gas for these, gas will be estimated on the entire batch\n        const [data, to, accessList, value] = await Promise.all([\n          encode(tx),\n          resolvePromisedValue(tx.to),\n          resolvePromisedValue(tx.accessList),\n          resolvePromisedValue(tx.value),\n        ]);\n        const serializedTx: SendTransactionOption = {\n          accessList,\n          chainId: tx.chain.id,\n          data,\n          to,\n          value,\n        };\n        return serializedTx;\n      }),\n    );\n    const result = await account.sendBatchTransaction(serializedTxs);\n    return {\n      ...result,\n      chain: firstTx.chain,\n      client: firstTx.client,\n    };\n  }\n  throw new Error(\"Account doesn't implement sendBatchTransaction\");\n}\n","import type { Chain } from \"../../../../chains/types.js\";\nimport type { ThirdwebClient } from \"../../../../client/client.js\";\nimport { eth_getTransactionReceipt } from \"../../../../rpc/actions/eth_getTransactionReceipt.js\";\nimport { getRpcClient } from \"../../../../rpc/rpc.js\";\nimport { sendAndConfirmTransaction } from \"../../../../transaction/actions/send-and-confirm-transaction.js\";\nimport { sendBatchTransaction } from \"../../../../transaction/actions/send-batch-transaction.js\";\nimport type { SendTransactionOptions } from \"../../../../transaction/actions/send-transaction.js\";\nimport { LruMap } from \"../../../../utils/caching/lru.js\";\nimport type { Hex } from \"../../../../utils/encoding/hex.js\";\nimport { randomBytesHex } from \"../../../../utils/random.js\";\nimport type { PreparedSendCall } from \"../../../eip5792/send-calls.js\";\nimport type {\n  GetCallsStatusResponse,\n  WalletCallReceipt,\n} from \"../../../eip5792/types.js\";\nimport type { Account } from \"../../../interfaces/wallet.js\";\n\nconst bundlesToTransactions = new LruMap<Hex[]>(1000);\n\n/**\n * @internal\n */\nexport async function inAppWalletSendCalls(args: {\n  account: Account;\n  calls: PreparedSendCall[];\n  chain: Chain;\n}): Promise<string> {\n  const { account, calls } = args;\n\n  const transactions: SendTransactionOptions[\"transaction\"][] = calls.map(\n    (call) => ({\n      ...call,\n      chain: args.chain,\n    }),\n  );\n\n  const hashes: Hex[] = [];\n  const id = randomBytesHex(65);\n  bundlesToTransactions.set(id, hashes);\n  if (account.sendBatchTransaction) {\n    const receipt = await sendBatchTransaction({\n      account,\n      transactions,\n    });\n    hashes.push(receipt.transactionHash);\n    bundlesToTransactions.set(id, hashes);\n  } else {\n    for (const tx of transactions) {\n      const receipt = await sendAndConfirmTransaction({\n        account,\n        transaction: tx,\n      });\n      hashes.push(receipt.transactionHash);\n      bundlesToTransactions.set(id, hashes);\n    }\n  }\n\n  return id;\n}\n\n/**\n * @internal\n */\nexport async function inAppWalletGetCallsStatus(args: {\n  chain: Chain;\n  client: ThirdwebClient;\n  id: string;\n}): Promise<GetCallsStatusResponse> {\n  const { chain, client, id } = args;\n\n  const bundle = bundlesToTransactions.get(id);\n  if (!bundle) {\n    throw new Error(\"Failed to get calls status, unknown bundle id\");\n  }\n\n  const request = getRpcClient({ chain, client });\n  let status: \"pending\" | \"success\" | \"failure\" = \"success\";\n  const receipts: (WalletCallReceipt<bigint, \"success\" | \"reverted\"> | null)[] =\n    await Promise.all(\n      bundle.map((hash) =>\n        eth_getTransactionReceipt(request, { hash })\n          .then((receipt) => ({\n            blockHash: receipt.blockHash,\n            blockNumber: receipt.blockNumber,\n            gasUsed: receipt.gasUsed,\n            logs: receipt.logs.map((l) => ({\n              address: l.address,\n              data: l.data,\n              topics: l.topics,\n            })),\n            status: receipt.status,\n            transactionHash: receipt.transactionHash,\n          }))\n          .catch(() => {\n            status = \"pending\";\n            return null; // Return null if there's an error to filter out later\n          }),\n      ),\n    );\n\n  return {\n    atomic: false,\n    chainId: chain.id,\n    id,\n    receipts: receipts.filter((r) => r !== null),\n    status,\n    statusCode: 200,\n    version: \"2.0.0\",\n  };\n}\n","import type { TransactionReceipt } from \"../types.js\";\nimport {\n  type SendTransactionOptions,\n  sendTransaction,\n} from \"./send-transaction.js\";\nimport { waitForReceipt } from \"./wait-for-tx-receipt.js\";\n\n/**\n * Sends a transaction using the provided wallet.\n * @param options - The options for sending the transaction.\n * @returns A promise that resolves to the confirmed transaction receipt.\n * @throws An error if the wallet is not connected.\n * @transaction\n * @example\n *\n * ### Basic usage\n * ```ts\n * import { sendAndConfirmTransaction } from \"thirdweb\";\n *\n * const transactionReceipt = await sendAndConfirmTransaction({\n *  account,\n *  transaction\n * });\n * ```\n *\n * ### Gasless usage with [thirdweb Engine](https://portal.thirdweb.com/engine)\n * ```ts\n * const transactionReceipt = await sendAndConfirmTransaction({\n *  account,\n *  transaction,\n *  gasless: {\n *    provider: \"engine\",\n *    relayerUrl: \"https://thirdweb.engine-***.thirdweb.com/relayer/***\",\n *    relayerForwarderAddress: \"0x...\",\n *  }\n * });\n * ```\n *\n * ### Gasless usage with OpenZeppelin\n * ```ts\n * const transactionReceipt = await sendAndConfirmTransaction({\n *  account,\n *  transaction,\n *  gasless: {\n *    provider: \"openzeppelin\",\n *    relayerUrl: \"https://...\",\n *    relayerForwarderAddress: \"0x...\",\n *  }\n * });\n * ```\n */\nexport async function sendAndConfirmTransaction(\n  options: SendTransactionOptions,\n): Promise<TransactionReceipt> {\n  const submittedTx = await sendTransaction(options);\n  return waitForReceipt(submittedTx);\n}\n"],"names":[],"mappings":"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","ignoreList":[1,2]}