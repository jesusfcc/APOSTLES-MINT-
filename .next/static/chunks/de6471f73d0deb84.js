(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,548645,e=>{"use strict";var t=e.i(576656);let a=new Map,i={getItem:async e=>a.get(e)??null,removeItem:async e=>{a.delete(e)},setItem:async(e,t)=>{a.set(e,t)}};var n=e.i(438633),r=e.i(234667);async function s({authToken:e,client:a,ecosystem:i}){let n=(0,r.getClientFetch)(a,i),s=await n(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/accounts`,{headers:{Authorization:`Bearer embedded-wallet-token:${e}`,"Content-Type":"application/json"},method:"GET"});if(!s.ok){let e=await s.text().catch(()=>"Unknown error");throw Error(`Failed to get user info: ${e}`)}return await s.json()}var o=e.i(772935);let l=(0,t.getThirdwebBaseUrl)("inAppWallet"),c=`${l}/`,d=`${c}api/2023-10-20`,h=`${d}/embedded-wallet/validate-custom-jwt`,u=`${d}/embedded-wallet/validate-custom-auth-endpoint`,g=(e,t)=>t instanceof Error?`${e}: ${t.message}`:`${e}: ${(0,o.stringify)(t)}`;async function p(e){let t=(0,r.getClientFetch)(e.client,e.ecosystem),a=await t(u,{body:(0,o.stringify)({developerClientId:e.client.clientId,payload:e.payload}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok){let e=await a.json();throw Error(`Custom auth endpoint authentication error: ${e.message}`)}try{let{verifiedToken:e}=await a.json();return{storedToken:e}}catch(e){throw Error(g("Malformed response from post auth_endpoint authentication",e))}}var w=e.i(864377);async function m(e){let t=(0,r.getClientFetch)(e.client,e.ecosystem),a=(0,w.getLoginUrl)({authOption:"backend",client:e.client,ecosystem:e.ecosystem}),i=await t(`${a}`,{body:(0,o.stringify)({walletSecret:e.walletSecret}),headers:{"Content-Type":"application/json"},method:"POST"});if(!i.ok){let e=await i.text();throw Error(`Failed to generate backend account: ${e}`)}return await i.json()}var y=e.i(393460),f=e.i(79455);async function b(e){let t=await e.storage.getGuestSessionId();t||(t=(0,f.randomBytesHex)(32),e.storage.saveGuestSessionId(t));let a=(0,r.getClientFetch)(e.client,e.ecosystem),i=(0,w.getLoginCallbackUrl)({authOption:"guest",client:e.client,ecosystem:e.ecosystem}),n=await a(`${i}`,{body:(0,o.stringify)({sessionId:t}),headers:{"Content-Type":"application/json"},method:"POST"});if(!n.ok){let e=await n.text();throw Error(`Failed to generate guest account: ${n.status} ${n.statusText} ${e}`)}return await n.json()}async function v(e){let t=(0,r.getClientFetch)(e.client,e.ecosystem),a=await t(h,{body:(0,o.stringify)({developerClientId:e.client.clientId,jwt:e.jwt}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok){let e=await a.json();throw Error(`JWT authentication error: ${e.message}`)}try{let{verifiedToken:e}=await a.json();return{storedToken:e}}catch(e){throw Error(g("Malformed response from post jwt authentication",e))}}async function I({client:e,ecosystem:a,tokenToLink:i,storage:n}){let s=(0,r.getClientFetch)(e,a),l=(0,t.getThirdwebBaseUrl)("inAppWallet"),c=await n.getAuthCookie();if(!c)throw Error("Failed to link account, no user logged in");let d={Authorization:`Bearer iaw-auth-token:${c}`,"Content-Type":"application/json"},h=await s(`${l}/api/2024-05-05/account/connect`,{body:(0,o.stringify)({accountAuthTokenToConnect:i}),headers:d,method:"POST"});if(!h.ok)throw Error((await h.json()).message||"Failed to link account.");let{linkedAccounts:u}=await h.json();return u??[]}async function k({client:e,ecosystem:a,profileToUnlink:i,allowAccountDeletion:n=!1,storage:s}){let l=(0,r.getClientFetch)(e,a),c=(0,t.getThirdwebBaseUrl)("inAppWallet"),d=await s.getAuthCookie();if(!d)throw Error("Failed to unlink account, no user logged in");let h={Authorization:`Bearer iaw-auth-token:${d}`,"Content-Type":"application/json"},u=await l(`${c}/api/2024-05-05/account/disconnect`,{body:(0,o.stringify)({allowAccountDeletion:n,details:i.details,type:i.type}),headers:h,method:"POST"});if(!u.ok)throw Error((await u.json()).message||"Failed to unlink account.");let{linkedAccounts:g}=await u.json();return g??[]}async function T({client:e,ecosystem:a,storage:i}){let n=(0,r.getClientFetch)(e,a),s=(0,t.getThirdwebBaseUrl)("inAppWallet"),o=await i.getAuthCookie();if(!o)throw Error("Failed to get linked accounts, no user logged in");let l={Authorization:`Bearer iaw-auth-token:${o}`,"Content-Type":"application/json"},c=await n(`${s}/api/2024-05-05/accounts`,{headers:l,method:"GET"});if(!c.ok)throw Error((await c.json()).message||"Failed to get linked accounts.");let{linkedAccounts:d}=await c.json();return d??[]}function C(){return`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function S(e,a){return`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/2024-05-05/login/passkey?type=${e}${a?`&username=${a}`:""}`}async function L(e){var t;if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let a=(0,r.getClientFetch)(e.client,e.ecosystem),i=e.username??(t=e.ecosystem,`${t?.id??"wallet"}-${new Date().toISOString()}`),n=await a(S("sign-up",i)),s=await n.json();if(!s.challenge)throw Error("No challenge received");let l=s.challenge,c=await e.passkeyClient.register({challenge:l,name:i,rp:e.rp}),d={};e.ecosystem?.partnerId&&(d["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(d["x-ecosystem-id"]=e.ecosystem.id);let h=await a(C(),{body:(0,o.stringify)({authenticatorData:c.authenticatorData,clientData:c.clientData,credential:{algorithm:c.credential.algorithm,publicKey:c.credential.publicKey},credentialId:c.credentialId,origin:c.origin,rpId:e.rp.id,serverVerificationId:s.serverVerificationId,type:"sign-up",username:i}),headers:{"Content-Type":"application/json",...d},method:"POST"}),u=await h.json();if(!u||!u.storedToken)throw Error(`Error verifying passkey: ${u.message??"unknown error"}`);return await e.storage?.savePasskeyCredentialId(c.credentialId),u}async function P(e){if(!e.passkeyClient.isAvailable())throw Error("Passkeys are not available on this device");let t=(0,r.getClientFetch)(e.client,e.ecosystem),[a,i]=await Promise.all([t(S("sign-in")).then(e=>e.json()),e.storage?.getPasskeyCredentialId()]);if(!a.challenge)throw Error("No challenge received");let n=a.challenge,s=await e.passkeyClient.authenticate({challenge:n,credentialId:i??void 0,rp:e.rp}),l={};e.ecosystem?.partnerId&&(l["x-ecosystem-partner-id"]=e.ecosystem.partnerId),e.ecosystem?.id&&(l["x-ecosystem-id"]=e.ecosystem.id);let c=await t(C(),{body:(0,o.stringify)({authenticatorData:s.authenticatorData,clientData:s.clientData,credentialId:s.credentialId,origin:s.origin,rpId:e.rp.id,serverVerificationId:a.serverVerificationId,signature:s.signature,type:"sign-in"}),headers:{"Content-Type":"application/json",...l},method:"POST"}),d=await c.json();if(!d||!d.storedToken)throw Error(`Error verifying passkey: ${d.message??"unknown error"}`);return await e.storage?.savePasskeyCredentialId(s.credentialId),d}var A=e.i(771412),W=e.i(315428);let O=["xyz.abs"];async function E(e){let{wallet:t,client:a,ecosystem:i,chain:n}=e,s=O.includes(t.id)&&n||(0,W.getCachedChain)(1),l=t.getAccount()||await t.connect({chain:s,client:a}),c=(0,r.getClientFetch)(a,i),d=await (async()=>{let t=(0,w.getLoginUrl)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await c(`${t}&address=${l.address}&chainId=${s.id}`);if(!a.ok)throw Error("Failed to generate SIWE login payload");return await a.json()})(),{signature:h}=await (0,A.signLoginPayload)({account:l,payload:d});return await (async()=>{let t=(0,w.getLoginCallbackUrl)({authOption:"wallet",client:e.client,ecosystem:e.ecosystem}),a=await c(`${t}&signature=${h}&payload=${encodeURIComponent(d)}`,{body:(0,o.stringify)({payload:d,signature:h}),headers:{"Content-Type":"application/json"},method:"POST"});if(!a.ok)throw Error("Failed to verify SIWE signature");return await a.json()})()}var j=e.i(675107),$=e.i(108803),x=e.i(921492),F=e.i(738290),B=e.i(406356),U=e.i(342733),D=e.i(803702),N=e.i(594951);async function z({client:e,payload:a,storage:i}){let n=await i.getAuthCookie(),s=i.ecosystem,l=(0,r.getClientFetch)(e,s);if(!n)throw Error("No auth token found when signing message");let c={address:a.address,chainId:a.chainId,nonce:Number(a.nonce)},d=await l(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-authorization`,{body:(0,o.stringify)(c),headers:{Authorization:`Bearer embedded-wallet-token:${n}`,"Content-Type":"application/json","x-thirdweb-client-id":e.clientId},method:"POST"});if(!d.ok)throw Error(`Failed to sign message - ${d.status} ${d.statusText}`);return await d.json()}async function M({client:e,payload:{message:a,isRaw:i,originalMessage:n,chainId:s},storage:l}){let c=await l.getAuthCookie(),d=l.ecosystem,h=(0,r.getClientFetch)(e,d);if(!c)throw Error("No auth token found when signing message");let u=await h(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-message`,{body:(0,o.stringify)({messagePayload:{chainId:s,isRaw:i,message:a,originalMessage:n}}),headers:{Authorization:`Bearer embedded-wallet-token:${c}`,"Content-Type":"application/json","x-thirdweb-client-id":e.clientId},method:"POST"});if(!u.ok)throw Error(`Failed to sign message - ${u.status} ${u.statusText}`);return await u.json()}async function G({client:e,payload:a,storage:i}){let n=await i.getAuthCookie(),s=i.ecosystem,l=(0,r.getClientFetch)(e,s);if(!n)throw Error("No auth token found when signing transaction");let c=await l(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-transaction`,{body:(0,o.stringify)({transactionPayload:a}),headers:{Authorization:`Bearer embedded-wallet-token:${n}`,"Content-Type":"application/json","x-thirdweb-client-id":e.clientId},method:"POST"});if(!c.ok)throw Error(`Failed to sign transaction - ${c.status} ${c.statusText}`);return(await c.json()).signature}async function Q({client:e,payload:a,storage:i}){let n=await i.getAuthCookie(),s=i.ecosystem,l=(0,r.getClientFetch)(e,s);if(!n)throw Error("No auth token found when signing typed data");let c=await l(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/sign-typed-data`,{body:(0,o.stringify)({...a}),headers:{Authorization:`Bearer embedded-wallet-token:${n}`,"Content-Type":"application/json","x-thirdweb-client-id":e.clientId},method:"POST"});if(!c.ok)throw Error(`Failed to sign typed data - ${c.status} ${c.statusText}`);return await c.json()}class R{constructor({client:e,ecosystem:t,address:a,storage:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"address",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.address=a,this.localStorage=i}async postWalletSetUp(e){await this.localStorage.saveAuthCookie(e.storedToken.cookieString)}async getUserWalletStatus(){let e=await this.localStorage.getAuthCookie();if(!e)return{status:"Logged Out"};let t=await s({authToken:e,client:this.client,ecosystem:this.ecosystem});if(!t)return{status:"Logged Out"};let a=t.wallets[0],i={email:t.linkedAccounts.find(e=>void 0!==e.details.email)?.details.email,phoneNumber:t.linkedAccounts.find(e=>void 0!==e.details.phone)?.details.phone,recoveryShareManagement:"ENCLAVE",userWalletId:t.id||""};return a?{account:await this.getAccount(),authDetails:i,status:"Logged In, Wallet Initialized",walletAddress:a.address}:{authDetails:i,status:"Logged In, Wallet Uninitialized"}}async getAccount(){let t=this.client,a=this.localStorage,i=this.address,n=this.ecosystem,r=async i=>{let n=(0,F.getRpcClient)({chain:(0,W.getCachedChain)(i.chainId),client:t}),r={chainId:(0,D.toHex)(i.chainId),data:i.data,gas:_(i.gas),nonce:_(i.nonce)||(0,D.toHex)(await e.A(612417).then(({eth_getTransactionCount:e})=>e(n,{address:(0,B.getAddress)(this.address),blockTag:"pending"}))),to:i.to?(0,B.getAddress)(i.to):void 0,value:_(i.value)};return i.authorizationList&&i.authorizationList.length>0?(r.type=4,r.authorizationList=i.authorizationList,r.maxFeePerGas=_(i.maxFeePerGas),r.maxPriorityFeePerGas=_(i.maxPriorityFeePerGas)):_(i.maxFeePerGas)?(r.maxFeePerGas=_(i.maxFeePerGas),r.maxPriorityFeePerGas=_(i.maxPriorityFeePerGas),r.type=2):(r.gasPrice=_(i.gasPrice),r.type=0),G({client:t,payload:r,storage:a})},s={address:(0,B.getAddress)(i),async sendTransaction(e){let a=(0,F.getRpcClient)({chain:(0,W.getCachedChain)(e.chainId),client:t}),s=await r(e),o=await (0,x.eth_sendRawTransaction)(a,s);return(0,$.trackTransaction)({chainId:e.chainId,client:t,contractAddress:e.to??void 0,ecosystem:n,gasPrice:e.gasPrice,transactionHash:o,walletAddress:i,walletType:"inApp"}),{transactionHash:o}},async signAuthorization(e){let i=await z({client:t,payload:e,storage:a});return{address:(0,B.getAddress)(i.address),chainId:Number.parseInt(i.chainId),nonce:BigInt(i.nonce),r:BigInt(i.r),s:BigInt(i.s),yParity:Number.parseInt(i.yParity)}},async signMessage({message:e,originalMessage:i,chainId:n}){let r="string"==typeof e?{chainId:n,isRaw:!1,message:e,originalMessage:i}:{chainId:n,isRaw:!0,message:"string"==typeof e.raw?e.raw:(0,j.bytesToHex)(e.raw),originalMessage:i},{signature:s}=await M({client:t,payload:r,storage:a});return s},async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return r({chainId:e.chainId,...e})},async signTypedData(e){let i=(0,N.parseTypedData)(e),{signature:n}=await Q({client:t,payload:i,storage:a});return n},sendCalls:async t=>{let{inAppWalletSendCalls:a}=await e.A(88719),i=t.calls[0];if(!i)throw Error("No calls to send");let n=i.client,r=i.chain||t.chain,o=await a({account:s,calls:t.calls,chain:r});return{chain:r,client:n,id:o}},getCallsStatus:async t=>{let{inAppWalletGetCallsStatus:a}=await e.A(88719);return a(t)},getCapabilities:async e=>({[e.chainId??1]:{atomic:{status:"unsupported"},paymasterService:{supported:!1}}})};return s}}function _(e){return void 0===e||(0,U.isHex)(e)?e:(0,D.toHex)(e)}var q=e.i(415749),V=e.i(149544);let H={backgroundColor:"transparent",border:"none",colorScheme:"light",display:"none",height:"100%",pointerEvents:"all",position:"fixed",right:"0px",top:"0px",width:"100%",zIndex:"2147483646"},J=new Map;class K{constructor({link:e,baseUrl:t,iframeId:a,container:i,onIframeInitialize:n,localStorage:r,clientId:s,ecosystem:o}){if(Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.localStorage=r,this.clientId=s,this.ecosystem=o,this.iframeBaseUrl=t,"undefined"==typeof document)return;i=i??document.body;let l=document.getElementById(a);const c=new URL(e);if(!l||l.src!==c.href){l=document.createElement("iframe");const e={...H};Object.assign(l.style,e),l.setAttribute("id",a),l.setAttribute("fetchpriority","high"),i.appendChild(l),l.src=c.href;const t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!l)return void console.warn("thirdweb iFrame not found");this.onIframeLoadHandler(l,n)()}};window.addEventListener("message",t)}this.iframe=l}async onIframeLoadedInitVariables(){return{authCookie:await this.localStorage.getAuthCookie(),clientId:this.clientId,deviceShareStored:await this.localStorage.getDeviceShare(),ecosystemId:this.ecosystem?.id,partnerId:this.ecosystem?.partnerId,walletUserId:await this.localStorage.getWalletUserId()}}onIframeLoadHandler(e,t){return async()=>{let a=new MessageChannel,i=new Promise((i,n)=>{a.port1.onmessage=r=>{let{data:s}=r;a.port1.close(),s.success||n(Error(s.error)),J.set(e.src,!0),t&&t(),i(!0)}});e?.contentWindow?.postMessage({data:await this.onIframeLoadedInitVariables(),eventType:"initIframe"},this.iframeBaseUrl,[a.port2]),await i}}async call({procedureName:e,params:t,showIframe:a=!1}){if(!this.iframe)throw Error("Iframe not found. You are likely calling this from the backend where the DOM is not available.");for(;!J.get(this.iframe.src);)await (0,V.sleep)(1e3*this.POLLING_INTERVAL_SECONDS);a&&(this.iframe.style.display="block",await (0,V.sleep)(5));let i=new MessageChannel,n=new Promise((e,t)=>{i.port1.onmessage=async n=>{let{data:r}=n;i.port1.close(),a&&(await (0,V.sleep)(100),this.iframe&&(this.iframe.style.display="none")),r.success?e(r.data):t(Error(r.error))}});return this.iframe.contentWindow?.postMessage({data:{...t,...await this.onIframeLoadedInitVariables()},eventType:e},this.iframeBaseUrl,[i.port2]),n}destroy(){this.iframe&&J.delete(this.iframe.src)}}class Y extends K{constructor({clientId:e,baseUrl:t,ecosystem:a}){super({baseUrl:t,clientId:e,container:"undefined"==typeof document?void 0:document.body,ecosystem:a,iframeId:X+(a?.id||""),link:function({clientId:e,baseUrl:t,path:a,ecosystem:i,queryParams:n}){let r=new URL(`${a}`,t);if(n)for(let e of Object.keys(n))r.searchParams.set(e,n[e]?.toString()||"");return r.searchParams.set("clientId",e),i?.partnerId!==void 0&&r.searchParams.set("partnerId",i.partnerId),i?.id!==void 0&&r.searchParams.set("ecosystemId",i.id),r}({baseUrl:t,clientId:e,ecosystem:a,path:q.IN_APP_WALLET_PATH}).href,localStorage:new y.ClientScopedStorage({clientId:e,ecosystem:a,storage:n.webLocalStorage})}),this.clientId=e,this.ecosystem=a}}let X="thirdweb-in-app-wallet-iframe";async function Z({client:e,ecosystem:a,authToken:i}){let n=(0,r.getClientFetch)(e,a),s=await n(`${(0,t.getThirdwebBaseUrl)("inAppWallet")}/api/v1/enclave-wallet/generate`,{headers:{Authorization:`Bearer embedded-wallet-token:${i}`,"Content-Type":"application/json","x-thirdweb-client-id":e.clientId},method:"POST"});if(!s.ok)throw Error(`Failed to generate wallet - ${s.status} ${s.statusText}`);let{wallet:o}=await s.json();return o}class ee{constructor({baseUrl:e,querier:t,preLogin:a,postLogin:i,client:n,ecosystem:r}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=a,this.postLogin=i,this.client=n,this.ecosystem=r}async sendEmailLoginOtp({email:e}){return await this.LoginQuerier.call({params:{email:e},procedureName:"sendThirdwebEmailLoginOtp"})}async sendSmsLoginOtp({phoneNumber:e}){return await this.LoginQuerier.call({params:{phoneNumber:e},procedureName:"sendThirdwebSmsLoginOtp"})}}class et extends ee{async authenticateWithModal(){return this.LoginQuerier.call({params:void 0,procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithModal(){await this.preLogin();let e=await this.authenticateWithModal();return this.postLogin(e)}async authenticateWithIframe({email:e}){return this.LoginQuerier.call({params:{email:e},procedureName:"loginWithThirdwebModal",showIframe:!0})}async loginWithIframe({email:e}){await this.preLogin();let t=await this.authenticateWithIframe({email:e});return this.postLogin(t)}async authenticateWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom jwt auth");return this.LoginQuerier.call({params:{encryptionKey:e,jwt:t},procedureName:"loginWithCustomJwt"})}async loginWithCustomJwt({encryptionKey:e,jwt:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom jwt auth");await this.preLogin();let a=await this.authenticateWithCustomJwt({encryptionKey:e,jwt:t});return this.postLogin(a)}async authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t}){return this.LoginQuerier.call({params:{encryptionKey:e,payload:t},procedureName:"loginWithCustomAuthEndpoint"})}async loginWithCustomAuthEndpoint({encryptionKey:e,payload:t}){if(!e||0===e.length)throw Error("Encryption key is required for custom auth");await this.preLogin();let a=await this.authenticateWithCustomAuthEndpoint({encryptionKey:e,payload:t});return this.postLogin(a)}async authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({params:{email:e,otp:t,recoveryCode:a},procedureName:"verifyThirdwebEmailLoginOtp"})}async loginWithEmailOtp({email:e,otp:t,recoveryCode:a}){let i=await this.authenticateWithEmailOtp({email:e,otp:t,recoveryCode:a});return this.postLogin(i)}async authenticateWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){return this.LoginQuerier.call({params:{otp:t,phoneNumber:e,recoveryCode:a},procedureName:"verifyThirdwebSmsLoginOtp"})}async loginWithSmsOtp({phoneNumber:e,otp:t,recoveryCode:a}){let i=await this.authenticateWithSmsOtp({otp:t,phoneNumber:e,recoveryCode:a});return this.postLogin(i)}}class ea{constructor({client:e,querier:t,onAuthSuccess:a,ecosystem:i,baseUrl:n,localStorage:r}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=i,this.AuthQuerier=t,this.localStorage=r,this.onAuthSuccess=a,this.BaseLogin=new et({baseUrl:n,client:e,ecosystem:i,postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},querier:t})}async preLogin(){await this.logout()}async postLogin({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(e.cookieString),await this.onAuthSuccess({storedToken:e,walletDetails:t})}async loginWithAuthToken(e,t){"Backend"!==e.storedToken.authProvider&&await this.preLogin();let a=await s({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});if(!a)throw Error("Cannot login, no user found for auth token");if(a.wallets.length>0&&a.wallets[0]?.type==="enclave")return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:a.wallets[0].address}});if(0===a.wallets.length){let t=await Z({authToken:e.storedToken.cookieString,client:this.client,ecosystem:this.ecosystem});return this.postLogin({storedToken:e.storedToken,walletDetails:{walletAddress:t.address}})}let i=await this.AuthQuerier.call({params:{recoveryCode:t,storedToken:e.storedToken},procedureName:"loginWithStoredTokenDetails"});return this.postLogin(i)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async authenticateWithModal(){return this.BaseLogin.authenticateWithModal()}async loginWithIframe(e){return this.BaseLogin.loginWithIframe(e)}async authenticateWithIframe(e){return this.BaseLogin.authenticateWithIframe(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async authenticateWithCustomJwt(e){return this.BaseLogin.authenticateWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async authenticateWithCustomAuthEndpoint(e){return this.BaseLogin.authenticateWithCustomAuthEndpoint(e)}async sendEmailLoginOtp({email:e}){return this.BaseLogin.sendEmailLoginOtp({email:e})}async sendSmsLoginOtp({phoneNumber:e}){return this.BaseLogin.sendSmsLoginOtp({phoneNumber:e})}async loginWithEmailOtp(e){return await this.preLogin(),this.BaseLogin.loginWithEmailOtp(e)}async authenticateWithEmailOtp(e){return this.BaseLogin.authenticateWithEmailOtp(e)}async loginWithSmsOtp(e){return await this.preLogin(),this.BaseLogin.loginWithSmsOtp(e)}async authenticateWithSmsOtp(e){return this.BaseLogin.authenticateWithSmsOtp(e)}async logout(){let e=await this.localStorage.removeAuthCookie(),t=await this.localStorage.removeWalletUserId();return{success:e||t}}}var ei=e.i(970468);let en=async e=>{let{client:t,ecosystem:a}=e,i=(0,w.getLoginUrl)({authOption:e.strategy,client:t,ecosystem:a}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);let r=(()=>{switch(e.strategy){case"email":return{email:e.email};case"phone":return{phone:e.phoneNumber}}})(),s=await fetch(i,{body:(0,o.stringify)(r),headers:n,method:"POST"});if(!s.ok)throw Error("Failed to send verification code");return await s.json()},er=async e=>{let{client:t,ecosystem:a}=e,i=(0,w.getLoginCallbackUrl)({authOption:e.strategy,client:e.client,ecosystem:e.ecosystem}),n={"Content-Type":"application/json","x-client-id":t.clientId};a?.id&&(n["x-ecosystem-id"]=a.id),a?.partnerId&&(n["x-ecosystem-partner-id"]=a.partnerId);let r=(()=>{switch(e.strategy){case"email":return{code:e.verificationCode,email:e.email};case"phone":return{code:e.verificationCode,phone:e.phoneNumber}}})(),s=await fetch(i,{body:(0,o.stringify)(r),headers:n,method:"POST"});if(!s.ok)throw Error("Failed to verify verification code");return await s.json()};class es{constructor({client:e,ecosystem:t,querier:a,localStorage:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=a,this.localStorage=i}async postWalletSetUp(e){e.deviceShareStored&&await this.localStorage.saveDeviceShare(e.deviceShareStored,e.storedToken.authDetails.userWalletId)}async getUserWalletStatus(){let e=await this.walletManagerQuerier.call({params:void 0,procedureName:"getUserStatus"});return"Logged In, Wallet Initialized"===e.status?{status:"Logged In, Wallet Initialized",...e.user,account:await this.getAccount()}:"Logged In, New Device"===e.status?{status:"Logged In, New Device",...e.user}:"Logged In, Wallet Uninitialized"===e.status?{status:"Logged In, Wallet Uninitialized",...e.user}:{status:e.status}}async getAccount(){let e=this.walletManagerQuerier,a=this.client,i=this.ecosystem?.partnerId,{address:n}=await e.call({params:void 0,procedureName:"getAddress"}),r=async a=>{let n={chainId:a.chainId,data:a.data,gasLimit:a.gas,nonce:a.nonce,to:a.to??void 0,value:a.value};a.maxFeePerGas?(n.accessList=a.accessList,n.maxFeePerGas=a.maxFeePerGas,n.maxPriorityFeePerGas=a.maxPriorityFeePerGas,n.type=2):(n.gasPrice=a.gasPrice,n.type=0);let r=(0,t.getThirdwebDomains)().rpc,{signedTransaction:s}=await e.call({params:{chainId:a.chainId,partnerId:i,rpcEndpoint:`https://${a.chainId}.${r}`,transaction:n},procedureName:"signTransaction"});return s};return{address:(0,B.getAddress)(n),async sendTransaction(e){let t=(0,F.getRpcClient)({chain:(0,W.getCachedChain)(e.chainId),client:a}),i=await r(e),s=await (0,x.eth_sendRawTransaction)(t,i);return(0,$.trackTransaction)({chainId:e.chainId,client:a,contractAddress:e.to??void 0,gasPrice:e.gasPrice,transactionHash:s,walletAddress:n,walletType:"inApp"}),{transactionHash:s}},async signMessage({message:t}){let a="string"==typeof t?t:t.raw instanceof Uint8Array?t.raw:(0,D.hexToString)(t.raw),{signedMessage:n}=await e.call({params:{chainId:1,message:a,partnerId:i},procedureName:"signMessage"});return n},async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return r({...e,chainId:e.chainId})},async signTypedData(a){let n=(0,N.parseTypedData)(a);n.types?.EIP712Domain&&(n.types.EIP712Domain=void 0);let r=n.domain,s=r?.chainId,o={...r?.verifyingContract?{verifyingContract:r?.verifyingContract}:{},name:r?.name,version:r?.version};s&&(o.chainId=s);let l=(0,t.getThirdwebDomains)().rpc,{signedTypedData:c}=await e.call({params:{chainId:Number.parseInt(BigInt(s||1).toString()),domain:o,message:n.message,partnerId:i,rpcEndpoint:`https://${s}.${l}`,types:n.types},procedureName:"signTypedDataV4"});return c}}}}class eo{isClientIdLegacyPaper(e){return!!(e.indexOf("-")>0)&&36===e.length}constructor({client:e,onAuthSuccess:a,ecosystem:r,passkeyDomain:s,storage:o}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"storage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passkeyDomain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");const l=(0,t.getThirdwebBaseUrl)("inAppWallet");this.client=e,this.ecosystem=r,this.passkeyDomain=s,this.storage=new y.ClientScopedStorage({clientId:e.clientId,ecosystem:r,storage:o??("undefined"!=typeof window&&window.localStorage?n.webLocalStorage:i)}),this.querier=new Y({baseUrl:l,clientId:e.clientId,ecosystem:r}),this.auth=new ea({baseUrl:l,client:e,ecosystem:r,localStorage:this.storage,onAuthSuccess:async e=>{if(a?.(e),"sharded"===e.storedToken.authDetails.walletType&&(await this.querier.call({params:{storedToken:e.storedToken},procedureName:"migrateFromShardToEnclave"})||console.warn("Failed to migrate from sharded to enclave wallet, continuing with sharded wallet")),this.wallet=await this.initializeWallet(e.storedToken.cookieString),!this.wallet)throw Error("Failed to initialize wallet");let t="deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:void 0;return await this.wallet.postWalletSetUp({deviceShareStored:t,storedToken:e.storedToken}),this.wallet instanceof es&&await this.querier.call({params:{authCookie:e.storedToken.cookieString,clientId:this.client.clientId,deviceShareStored:"deviceShareStored"in e.walletDetails?e.walletDetails.deviceShareStored:null,ecosystemId:r?.id,partnerId:r?.partnerId,walletUserId:e.storedToken.authDetails.userWalletId},procedureName:"initIframe"}),{user:{account:await this.wallet.getAccount(),authDetails:e.storedToken.authDetails,status:"Logged In, Wallet Initialized",walletAddress:e.walletDetails.walletAddress}}},querier:this.querier})}async initializeWallet(e){let t=await this.storage.getAuthCookie();if(!e&&null===t)throw Error("No auth token provided and no stored auth token found to initialize the wallet");let a=await s({authToken:e||t,client:this.client,ecosystem:this.ecosystem});if(!a)throw Error("Cannot initialize wallet, no user logged in");if(0===a.wallets.length)throw Error("Cannot initialize wallet, this user does not have a wallet generated yet");return a.wallets[0]?.type==="enclave"?new R({address:a.wallets[0].address,client:this.client,ecosystem:this.ecosystem,storage:this.storage}):new es({client:this.client,ecosystem:this.ecosystem,localStorage:this.storage,querier:this.querier})}async getUser(){if(!this.wallet){let e=await this.storage.getAuthCookie();if(!e)return{status:"Logged Out"};this.wallet=await this.initializeWallet(e)}if(!this.wallet)throw Error("Wallet not initialized");return await this.wallet.getUserWalletStatus()}getAccount(){if(!this.wallet)throw Error("Wallet not initialized");return this.wallet.getAccount()}async preAuthenticate(e){return en({...e,client:this.client,ecosystem:this.ecosystem})}async authenticateWithRedirect(e,t,a){return(0,ei.loginWithOauthRedirect)({authOption:e,client:this.client,ecosystem:this.ecosystem,mode:t,redirectUrl:a})}async loginWithAuthToken(e,t){return this.auth.loginWithAuthToken(e,t)}async authenticate(e){let t=e.strategy;switch(t){case"email":case"phone":return er({...e,client:this.client,ecosystem:this.ecosystem});case"auth_endpoint":return p({client:this.client,ecosystem:this.ecosystem,payload:e.payload});case"jwt":return v({client:this.client,ecosystem:this.ecosystem,jwt:e.jwt});case"passkey":return this.passkeyAuth(e);case"iframe_email_verification":return this.auth.authenticateWithIframe({email:e.email});case"iframe":return this.auth.authenticateWithModal();case"apple":case"facebook":case"google":case"telegram":case"github":case"twitch":case"farcaster":case"line":case"x":case"tiktok":case"epic":case"steam":case"coinbase":case"discord":return(0,ei.loginWithOauth)({authOption:t,client:this.client,closeOpenedWindow:e.closeOpenedWindow,ecosystem:this.ecosystem,openedWindow:e.openedWindow});case"guest":return b({client:this.client,ecosystem:this.ecosystem,storage:this.storage});case"backend":return m({client:this.client,ecosystem:this.ecosystem,walletSecret:e.walletSecret});case"wallet":return E({client:this.client,ecosystem:this.ecosystem,wallet:e.wallet,chain:e.chain})}}async connect(e){let t=e.strategy;switch(t){case"auth_endpoint":case"jwt":{let t=await this.authenticate(e);return await this.loginWithAuthToken(t,e.encryptionKey)}case"iframe_email_verification":return this.auth.loginWithIframe({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{let t=await this.passkeyAuth(e);return this.loginWithAuthToken(t)}case"backend":case"phone":case"email":case"wallet":case"apple":case"facebook":case"google":case"farcaster":case"telegram":case"github":case"line":case"x":case"tiktok":case"epic":case"guest":case"coinbase":case"twitch":case"steam":case"discord":{let t=await this.authenticate(e);return await this.auth.loginWithAuthToken(t)}default:var a=t;throw Error((void 0)??`Invalid param: ${a}`)}}async logout(){return await this.auth.logout()}async passkeyAuth(t){let{PasskeyWebClient:a}=await e.A(587156),{passkeyName:i,storeLastUsedPasskey:n=!0}=t,r=new a,s=this.storage;return"sign-up"===t.type?L({client:this.client,ecosystem:this.ecosystem,passkeyClient:r,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:n?s:void 0,username:i}):P({client:this.client,ecosystem:this.ecosystem,passkeyClient:r,rp:{id:this.passkeyDomain??window.location.hostname,name:this.passkeyDomain??window.document.title},storage:n?s:void 0})}async linkProfile(e){let{storedToken:t}=await this.authenticate(e);return await I({client:e.client,ecosystem:e.ecosystem||this.ecosystem,storage:this.storage,tokenToLink:t.cookieString})}async unlinkProfile(e,t){return await k({allowAccountDeletion:t,client:this.client,ecosystem:this.ecosystem,profileToUnlink:e,storage:this.storage})}async getProfiles(){return T({client:this.client,ecosystem:this.ecosystem,storage:this.storage})}}e.s(["InAppWebConnector",()=>eo],548645)}]);