(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,281982,a=>{"use strict";var e=a.i(612838),t=a.i(772935),r=a.i(687322),n=a.i(906603);async function s({account:a,serializableTransaction:t,transaction:n,gasless:s}){let d=(0,e.getContract)({address:s.relayerForwarderAddress,chain:n.chain,client:n.client}),c=await (0,r.readContract)({contract:d,method:"function getNonce(address) view returns (uint256)",params:[a.address]}),[l,u]=await (async()=>{if(!t.to)throw Error("engine transactions must have a 'to' address");if(!t.gas)throw Error("engine transactions must have a 'gas' value");if(!t.data)throw Error("engine transactions must have a 'data' value");if(s.experimentalChainlessSupport){let e={chainid:BigInt(n.chain.id),data:t.data,from:a.address,gas:t.gas,nonce:c,to:t.to,value:0n};return[await a.signTypedData({domain:{name:"GSNv2 Forwarder",verifyingContract:d.address,version:"0.0.1"},message:e,primaryType:"ForwardRequest",types:{ForwardRequest:o}}),e]}let e={data:t.data,from:a.address,gas:t.gas,nonce:c,to:t.to,value:0n};return[await a.signTypedData({domain:{chainId:n.chain.id,name:s.domainName??"GSNv2 Forwarder",verifyingContract:d.address,version:s.domainVersion??"0.0.1"},message:e,primaryType:"ForwardRequest",types:{ForwardRequest:i}}),e]})();return{message:u,messageType:"forward",signature:l}}let i=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"}],o=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"},{name:"chainid",type:"uint256"}];async function d(a){let{message:e,messageType:r,signature:n}=await s(a),i=await fetch(a.gasless.relayerUrl,{body:(0,t.stringify)({forwarderAddress:a.gasless.relayerForwarderAddress,request:e,signature:n,type:r}),headers:{"Content-Type":"application/json"},method:"POST"});if(!i.ok)throw Error(`Failed to send transaction: ${await i.text()}`);let o=await i.json();if(!o.result)throw Error(`Relay transaction failed: ${o.message}`);let d=o.result.queueId,l=Date.now()+6e4;for(;Date.now()<l;){let e=await c({options:a,queueId:d});if(e)return{chain:a.transaction.chain,client:a.transaction.client,transactionHash:e.transactionHash};await new Promise(a=>setTimeout(a,1e3))}throw Error("Failed to find relayed transaction after 60000ms")}async function c(a){let{options:e,queueId:t}=a,r=e.gasless.relayerUrl.split("/relayer/")[0],s=await fetch(`${r}/transaction/status/${t}`,{method:"GET"}),i=await s.json();if(!s.ok)return null;let o=i.result;if(!o)return null;switch(o.status){case"errored":throw Error(`Transaction errored with reason: ${o.errorMessage}`);case"cancelled":throw Error("Transaction execution cancelled.");case"mined":return await (0,n.waitForReceipt)({chain:e.transaction.chain,client:e.transaction.client,transactionHash:o.transactionHash});default:return null}}a.s(["prepareEngineTransaction",()=>s,"relayEngineTransaction",()=>d])}]);